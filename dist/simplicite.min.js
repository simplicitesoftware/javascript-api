(()=>{var be=Object.create;var re=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Fe=Object.prototype.hasOwnProperty;var G=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Pe=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ce(e))!Fe.call(r,n)&&n!==t&&re(r,n,{get:()=>e[n],enumerable:!(i=Ue(e,n))||i.enumerable});return r};var $e=(r,e,t)=>(t=r!=null?be(Ae(r)):{},Pe(e||!r||!r.__esModule?re(t,"default",{value:r,enumerable:!0}):t,r));var oe=G(Y=>{"use strict";Y.byteLength=Le;Y.toByteArray=ke;Y.fromByteArray=je;var R=[],I=[],Ne=typeof Uint8Array<"u"?Uint8Array:Array,v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(F=0,ne=v.length;F<ne;++F)R[F]=v[F],I[v.charCodeAt(F)]=F;var F,ne;I[45]=62;I[95]=63;function se(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var i=t===e?0:4-t%4;return[t,i]}function Le(r){var e=se(r),t=e[0],i=e[1];return(t+i)*3/4-i}function De(r,e,t){return(e+t)*3/4-t}function ke(r){var e,t=se(r),i=t[0],n=t[1],s=new Ne(De(r,i,n)),o=0,h=n>0?i-4:i,c;for(c=0;c<h;c+=4)e=I[r.charCodeAt(c)]<<18|I[r.charCodeAt(c+1)]<<12|I[r.charCodeAt(c+2)]<<6|I[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=I[r.charCodeAt(c)]<<2|I[r.charCodeAt(c+1)]>>4,s[o++]=e&255),n===1&&(e=I[r.charCodeAt(c)]<<10|I[r.charCodeAt(c+1)]<<4|I[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Me(r){return R[r>>18&63]+R[r>>12&63]+R[r>>6&63]+R[r&63]}function He(r,e,t){for(var i,n=[],s=e;s<t;s+=3)i=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),n.push(Me(i));return n.join("")}function je(r){for(var e,t=r.length,i=t%3,n=[],s=16383,o=0,h=t-i;o<h;o+=s)n.push(He(r,o,o+s>h?h:o+s));return i===1?(e=r[t-1],n.push(R[e>>2]+R[e<<4&63]+"==")):i===2&&(e=(r[t-2]<<8)+r[t-1],n.push(R[e>>10]+R[e>>4&63]+R[e<<2&63]+"=")),n.join("")}});var he=G(W=>{W.read=function(r,e,t,i,n){var s,o,h=n*8-i-1,c=(1<<h)-1,u=c>>1,a=-7,l=t?n-1:0,p=t?-1:1,g=r[e+l];for(l+=p,s=g&(1<<-a)-1,g>>=-a,a+=h;a>0;s=s*256+r[e+l],l+=p,a-=8);for(o=s&(1<<-a)-1,s>>=-a,a+=i;a>0;o=o*256+r[e+l],l+=p,a-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-u}return(g?-1:1)*o*Math.pow(2,s-i)};W.write=function(r,e,t,i,n,s){var o,h,c,u=s*8-n-1,a=(1<<u)-1,l=a>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=i?0:s-1,m=i?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,o=a):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+l>=1?e+=p/c:e+=p*Math.pow(2,1-l),e*c>=2&&(o++,c/=2),o+l>=a?(h=0,o=a):o+l>=1?(h=(e*c-1)*Math.pow(2,n),o=o+l):(h=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;r[t+g]=h&255,g+=m,h/=256,n-=8);for(o=o<<n|h,u+=n;u>0;r[t+g]=o&255,g+=m,o/=256,u-=8);r[t+g-m]|=U*128}});var Be=G(M=>{"use strict";var K=oe(),D=he(),ae=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;M.Buffer=f;M.SlowBuffer=ve;M.INSPECT_MAX_BYTES=50;var V=2147483647;M.kMaxLength=V;f.TYPED_ARRAY_SUPPORT=qe();!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function qe(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function b(r){if(r>V)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Q(r)}return fe(r,e,t)}f.poolSize=8192;function fe(r,e,t){if(typeof r=="string")return Ve(r,e);if(ArrayBuffer.isView(r))return Xe(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(B(r,ArrayBuffer)||r&&B(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(B(r,SharedArrayBuffer)||r&&B(r.buffer,SharedArrayBuffer)))return z(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let i=r.valueOf&&r.valueOf();if(i!=null&&i!==r)return f.from(i,e,t);let n=Ge(r);if(n)return n;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return fe(r,e,t)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function pe(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function Ye(r,e,t){return pe(r),r<=0?b(r):e!==void 0?typeof t=="string"?b(r).fill(e,t):b(r).fill(e):b(r)}f.alloc=function(r,e,t){return Ye(r,e,t)};function Q(r){return pe(r),b(r<0?0:ee(r)|0)}f.allocUnsafe=function(r){return Q(r)};f.allocUnsafeSlow=function(r){return Q(r)};function Ve(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=de(r,e)|0,i=b(t),n=i.write(r,e);return n!==t&&(i=i.slice(0,n)),i}function J(r){let e=r.length<0?0:ee(r.length)|0,t=b(e);for(let i=0;i<e;i+=1)t[i]=r[i]&255;return t}function Xe(r){if(B(r,Uint8Array)){let e=new Uint8Array(r);return z(e.buffer,e.byteOffset,e.byteLength)}return J(r)}function z(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let i;return e===void 0&&t===void 0?i=new Uint8Array(r):t===void 0?i=new Uint8Array(r,e):i=new Uint8Array(r,e,t),Object.setPrototypeOf(i,f.prototype),i}function Ge(r){if(f.isBuffer(r)){let e=ee(r.length)|0,t=b(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||ie(r.length)?b(0):J(r);if(r.type==="Buffer"&&Array.isArray(r.data))return J(r.data)}function ee(r){if(r>=V)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+V.toString(16)+" bytes");return r|0}function ve(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,t){if(B(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),B(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,n=t.length;for(let s=0,o=Math.min(i,n);s<o;++s)if(e[s]!==t[s]){i=e[s],n=t[s];break}return i<n?-1:n<i?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);let i;if(t===void 0)for(t=0,i=0;i<e.length;++i)t+=e[i].length;let n=f.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){let o=e[i];if(B(o,Uint8Array))s+o.length>n.length?(f.isBuffer(o)||(o=f.from(o)),o.copy(n,s)):Uint8Array.prototype.set.call(n,o,s);else if(f.isBuffer(o))o.copy(n,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return n};function de(r,e){if(f.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||B(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,i=arguments.length>2&&arguments[2]===!0;if(!i&&t===0)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Z(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return Re(r).length;default:if(n)return i?-1:Z(r).length;e=(""+e).toLowerCase(),n=!0}}f.byteLength=de;function We(r,e,t){let i=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return nt(this,e,t);case"utf8":case"utf-8":return me(this,e,t);case"ascii":return it(this,e,t);case"latin1":case"binary":return rt(this,e,t);case"base64":return et(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,e,t);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),i=!0}}f.prototype._isBuffer=!0;function P(r,e,t){let i=r[e];r[e]=r[t],r[t]=i}f.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)P(this,t,t+1);return this};f.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)P(this,t,t+3),P(this,t+1,t+2);return this};f.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)P(this,t,t+7),P(this,t+1,t+6),P(this,t+2,t+5),P(this,t+3,t+4);return this};f.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?me(this,0,e):We.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){let e="",t=M.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};ae&&(f.prototype[ae]=f.prototype.inspect);f.prototype.compare=function(e,t,i,n,s){if(B(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),i===void 0&&(i=e?e.length:0),n===void 0&&(n=0),s===void 0&&(s=this.length),t<0||i>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=i)return 0;if(n>=s)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,n>>>=0,s>>>=0,this===e)return 0;let o=s-n,h=i-t,c=Math.min(o,h),u=this.slice(n,s),a=e.slice(t,i);for(let l=0;l<c;++l)if(u[l]!==a[l]){o=u[l],h=a[l];break}return o<h?-1:h<o?1:0};function ge(r,e,t,i,n){if(r.length===0)return-1;if(typeof t=="string"?(i=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,ie(t)&&(t=n?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(n)return-1;t=r.length-1}else if(t<0)if(n)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,i)),f.isBuffer(e))return e.length===0?-1:ue(r,e,t,i,n);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?n?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):ue(r,[e],t,i,n);throw new TypeError("val must be string, number or Buffer")}function ue(r,e,t,i,n){let s=1,o=r.length,h=e.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,h/=2,t/=2}function c(a,l){return s===1?a[l]:a.readUInt16BE(l*s)}let u;if(n){let a=-1;for(u=t;u<o;u++)if(c(r,u)===c(e,a===-1?0:u-a)){if(a===-1&&(a=u),u-a+1===h)return a*s}else a!==-1&&(u-=u-a),a=-1}else for(t+h>o&&(t=o-h),u=t;u>=0;u--){let a=!0;for(let l=0;l<h;l++)if(c(r,u+l)!==c(e,l)){a=!1;break}if(a)return u}return-1}f.prototype.includes=function(e,t,i){return this.indexOf(e,t,i)!==-1};f.prototype.indexOf=function(e,t,i){return ge(this,e,t,i,!0)};f.prototype.lastIndexOf=function(e,t,i){return ge(this,e,t,i,!1)};function Ke(r,e,t,i){t=Number(t)||0;let n=r.length-t;i?(i=Number(i),i>n&&(i=n)):i=n;let s=e.length;i>s/2&&(i=s/2);let o;for(o=0;o<i;++o){let h=parseInt(e.substr(o*2,2),16);if(ie(h))return o;r[t+o]=h}return o}function Je(r,e,t,i){return X(Z(e,r.length-t),r,t,i)}function ze(r,e,t,i){return X(ut(e),r,t,i)}function Ze(r,e,t,i){return X(Re(e),r,t,i)}function Qe(r,e,t,i){return X(ct(e,r.length-t),r,t,i)}f.prototype.write=function(e,t,i,n){if(t===void 0)n="utf8",i=this.length,t=0;else if(i===void 0&&typeof t=="string")n=t,i=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(i)?(i=i>>>0,n===void 0&&(n="utf8")):(n=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((i===void 0||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return Ke(this,e,t,i);case"utf8":case"utf-8":return Je(this,e,t,i);case"ascii":case"latin1":case"binary":return ze(this,e,t,i);case"base64":return Ze(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qe(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function et(r,e,t){return e===0&&t===r.length?K.fromByteArray(r):K.fromByteArray(r.slice(e,t))}function me(r,e,t){t=Math.min(r.length,t);let i=[],n=e;for(;n<t;){let s=r[n],o=null,h=s>239?4:s>223?3:s>191?2:1;if(n+h<=t){let c,u,a,l;switch(h){case 1:s<128&&(o=s);break;case 2:c=r[n+1],(c&192)===128&&(l=(s&31)<<6|c&63,l>127&&(o=l));break;case 3:c=r[n+1],u=r[n+2],(c&192)===128&&(u&192)===128&&(l=(s&15)<<12|(c&63)<<6|u&63,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:c=r[n+1],u=r[n+2],a=r[n+3],(c&192)===128&&(u&192)===128&&(a&192)===128&&(l=(s&15)<<18|(c&63)<<12|(u&63)<<6|a&63,l>65535&&l<1114112&&(o=l))}}o===null?(o=65533,h=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|o&1023),i.push(o),n+=h}return tt(i)}var ce=4096;function tt(r){let e=r.length;if(e<=ce)return String.fromCharCode.apply(String,r);let t="",i=0;for(;i<e;)t+=String.fromCharCode.apply(String,r.slice(i,i+=ce));return t}function it(r,e,t){let i="";t=Math.min(r.length,t);for(let n=e;n<t;++n)i+=String.fromCharCode(r[n]&127);return i}function rt(r,e,t){let i="";t=Math.min(r.length,t);for(let n=e;n<t;++n)i+=String.fromCharCode(r[n]);return i}function nt(r,e,t){let i=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>i)&&(t=i);let n="";for(let s=e;s<t;++s)n+=lt[r[s]];return n}function st(r,e,t){let i=r.slice(e,t),n="";for(let s=0;s<i.length-1;s+=2)n+=String.fromCharCode(i[s]+i[s+1]*256);return n}f.prototype.slice=function(e,t){let i=this.length;e=~~e,t=t===void 0?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,f.prototype),n};function E(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||E(e,t,this.length);let n=this[e],s=1,o=0;for(;++o<t&&(s*=256);)n+=this[e+o]*s;return n};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||E(e,t,this.length);let n=this[e+--t],s=1;for(;t>0&&(s*=256);)n+=this[e+--t]*s;return n};f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||E(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||E(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||E(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||E(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readBigUInt64LE=C(function(e){e=e>>>0,k(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&H(e,this.length-8);let n=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+i*2**24;return BigInt(n)+(BigInt(s)<<BigInt(32))});f.prototype.readBigUInt64BE=C(function(e){e=e>>>0,k(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&H(e,this.length-8);let n=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i;return(BigInt(n)<<BigInt(32))+BigInt(s)});f.prototype.readIntLE=function(e,t,i){e=e>>>0,t=t>>>0,i||E(e,t,this.length);let n=this[e],s=1,o=0;for(;++o<t&&(s*=256);)n+=this[e+o]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*t)),n};f.prototype.readIntBE=function(e,t,i){e=e>>>0,t=t>>>0,i||E(e,t,this.length);let n=t,s=1,o=this[e+--n];for(;n>0&&(s*=256);)o+=this[e+--n]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};f.prototype.readInt8=function(e,t){return e=e>>>0,t||E(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,t){e=e>>>0,t||E(e,2,this.length);let i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i};f.prototype.readInt16BE=function(e,t){e=e>>>0,t||E(e,2,this.length);let i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i};f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readBigInt64LE=C(function(e){e=e>>>0,k(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&H(e,this.length-8);let n=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(i<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});f.prototype.readBigInt64BE=C(function(e){e=e>>>0,k(e,"offset");let t=this[e],i=this[e+7];(t===void 0||i===void 0)&&H(e,this.length-8);let n=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+i)});f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||E(e,4,this.length),D.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||E(e,4,this.length),D.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||E(e,8,this.length),D.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||E(e,8,this.length),D.read(this,e,!1,52,8)};function T(r,e,t,i,n,s){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(t+i>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){let h=Math.pow(2,8*i)-1;T(this,e,t,i,h,0)}let s=1,o=0;for(this[t]=e&255;++o<i&&(s*=256);)this[t+o]=e/s&255;return t+i};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,i=i>>>0,!n){let h=Math.pow(2,8*i)-1;T(this,e,t,i,h,0)}let s=i-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+i};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,1,255,0),this[t]=e&255,t+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function ye(r,e,t,i,n){Ie(e,i,n,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function Ee(r,e,t,i,n){Ie(e,i,n,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}f.prototype.writeBigUInt64LE=C(function(e,t=0){return ye(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeBigUInt64BE=C(function(e,t=0){return Ee(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){let c=Math.pow(2,8*i-1);T(this,e,t,i,c-1,-c)}let s=0,o=1,h=0;for(this[t]=e&255;++s<i&&(o*=256);)e<0&&h===0&&this[t+s-1]!==0&&(h=1),this[t+s]=(e/o>>0)-h&255;return t+i};f.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t=t>>>0,!n){let c=Math.pow(2,8*i-1);T(this,e,t,i,c-1,-c)}let s=i-1,o=1,h=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&h===0&&this[t+s+1]!==0&&(h=1),this[t+s]=(e/o>>0)-h&255;return t+i};f.prototype.writeInt8=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};f.prototype.writeInt16LE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeInt16BE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeInt32LE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};f.prototype.writeInt32BE=function(e,t,i){return e=+e,t=t>>>0,i||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};f.prototype.writeBigInt64LE=C(function(e,t=0){return ye(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});f.prototype.writeBigInt64BE=C(function(e,t=0){return Ee(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function we(r,e,t,i,n,s){if(t+i>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function xe(r,e,t,i,n){return e=+e,t=t>>>0,n||we(r,e,t,4,34028234663852886e22,-34028234663852886e22),D.write(r,e,t,i,23,4),t+4}f.prototype.writeFloatLE=function(e,t,i){return xe(this,e,t,!0,i)};f.prototype.writeFloatBE=function(e,t,i){return xe(this,e,t,!1,i)};function Te(r,e,t,i,n){return e=+e,t=t>>>0,n||we(r,e,t,8,17976931348623157e292,-17976931348623157e292),D.write(r,e,t,i,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,i){return Te(this,e,t,!0,i)};f.prototype.writeDoubleBE=function(e,t,i){return Te(this,e,t,!1,i)};f.prototype.copy=function(e,t,i,n){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),!n&&n!==0&&(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);let s=n-i;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),s};f.prototype.fill=function(e,t,i,n){if(typeof e=="string"){if(typeof t=="string"?(n=t,t=0,i=this.length):typeof i=="string"&&(n=i,i=this.length),n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(e.length===1){let o=e.charCodeAt(0);(n==="utf8"&&o<128||n==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t=t>>>0,i=i===void 0?this.length:i>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<i;++s)this[s]=e;else{let o=f.isBuffer(e)?e:f.from(e,n),h=o.length;if(h===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<i-t;++s)this[s+t]=o[s%h]}return this};var L={};function te(r,e,t){L[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(n){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:n,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);te("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);te("ERR_OUT_OF_RANGE",function(r,e,t){let i=`The value of "${r}" is out of range.`,n=t;return Number.isInteger(t)&&Math.abs(t)>2**32?n=le(String(t)):typeof t=="bigint"&&(n=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(n=le(n)),n+="n"),i+=` It must be ${e}. Received ${n}`,i},RangeError);function le(r){let e="",t=r.length,i=r[0]==="-"?1:0;for(;t>=i+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function ot(r,e,t){k(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&H(e,r.length-(t+1))}function Ie(r,e,t,i,n,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",h;throw s>3?e===0||e===BigInt(0)?h=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:h=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:h=`>= ${e}${o} and <= ${t}${o}`,new L.ERR_OUT_OF_RANGE("value",h,r)}ot(i,n,s)}function k(r,e){if(typeof r!="number")throw new L.ERR_INVALID_ARG_TYPE(e,"number",r)}function H(r,e,t){throw Math.floor(r)!==r?(k(r,t),new L.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new L.ERR_BUFFER_OUT_OF_BOUNDS:new L.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var ht=/[^+/0-9A-Za-z-_]/g;function at(r){if(r=r.split("=")[0],r=r.trim().replace(ht,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Z(r,e){e=e||1/0;let t,i=r.length,n=null,s=[];for(let o=0;o<i;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!n){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),n=t;continue}t=(n-55296<<10|t-56320)+65536}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function ut(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function ct(r,e){let t,i,n,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),i=t>>8,n=t%256,s.push(n),s.push(i);return s}function Re(r){return K.toByteArray(at(r))}function X(r,e,t,i){let n;for(n=0;n<i&&!(n+t>=e.length||n>=r.length);++n)e[n+t]=r[n];return n}function B(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function ie(r){return r!==r}var lt=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let i=t*16;for(let n=0;n<16;++n)e[i+n]=r[t]+r[n]}return e}();function C(r){return typeof BigInt>"u"?ft:r}function ft(){throw new Error("BigInt not supported")}});var w={MODULE_VERSION:"3.1.4",DEFAULT_ROW_ID_NAME:"row_id",DEFAULT_ROW_ID:"0",CONTEXT_NONE:0,CONTEXT_SEARCH:1,CONTEXT_LIST:2,CONTEXT_CREATE:3,CONTEXT_COPY:4,CONTEXT_UPDATE:5,CONTEXT_DELETE:6,CONTEXT_GRAPH:7,CONTEXT_CROSSTAB:8,CONTEXT_PRINTTMPL:9,CONTEXT_UPDATEALL:10,CONTEXT_REFSELECT:11,CONTEXT_DATAMAPSELECT:12,CONTEXT_PREVALIDATE:13,CONTEXT_POSTVALIDATE:14,CONTEXT_STATETRANSITION:15,CONTEXT_EXPORT:16,CONTEXT_IMPORT:17,CONTEXT_ASSOCIATE:18,CONTEXT_PANELLIST:19,CONTEXT_ACTION:20,CONTEXT_AGENDA:21,CONTEXT_PLACEMAP:22,TYPE_ID:0,TYPE_INT:1,TYPE_FLOAT:2,TYPE_STRING:3,TYPE_DATE:4,TYPE_DATETIME:5,TYPE_TIME:6,TYPE_ENUM:7,TYPE_BOOLEAN:8,TYPE_PASSWORD:9,TYPE_URL:10,TYPE_HTML:11,TYPE_EMAIL:12,TYPE_LONG_STRING:13,TYPE_ENUM_MULTI:14,TYPE_REGEXP:15,TYPE_DOC:17,TYPE_FLOAT_EMPTY:18,TYPE_EXTFILE:19,TYPE_IMAGE:20,TYPE_NOTEPAD:21,TYPE_PHONENUM:22,TYPE_COLOR:23,TYPE_OBJECT:24,TYPE_GEOCOORDS:25,TYPE_BIGDECIMAL:26,TYPES:["ID","integer","decimal","string","date","datetime","time","enum","boolean","password","url","html","email","text","multienum","regexp","undefined","document","simpledecimal","extfile","picture","notepad","phonenum","color","object","geocoords","bigdecimal"],VIS_NOT:0,VIS_HIDDEN:0,VIS_LIST:1,VIS_FORM:2,VIS_BOTH:3,SEARCH_NONE:0,SEARCH_MONO:1,SEARCH_MULTI_CHECK:2,SEARCH_MULTI_LIST:3,SEARCH_PERIOD:4,TRUE:"1",FALSE:"0",ERRLEVEL_FATAL:1,ERRLEVEL_ERROR:2,ERRLEVEL_WARNING:3,ENDPOINT_API:"api",ENDPOINT_UI:"ui",ENDPOINT_UIPUBLIC:"uipublic",RESOURCE_TYPE_IMAGE:"IMG",RESOURCE_TYPE_ICON:"ICO",RESOURCE_TYPE_STYLESHEET:"CSS",RESOURCE_TYPE_JAVASCRIPT:"JS",DEFAULT_AUTH_HEADER:"authorization",SIMPLICITE_AUTH_HEADER:"x-simplicite-authorization",UI_AUTH_TOKEN_STORAGE_KEY:"_authToken",UI_AJAX_KEY_STORAGE_KEY:"_ajaxKey"};var Oe=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function h(a){try{u(i.next(a))}catch(l){o(l)}}function c(a){try{u(i.throw(a))}catch(l){o(l)}}function u(a){a.done?s(a.value):n(a.value).then(h,c)}u((i=i.apply(r,e||[])).next())})},x=class{constructor(e){this.getMimeType=this.getMIMEType,this.setMimeType=this.setMIMEType,this.getFileName=this.getName,this.getFilename=this.getName,this.setFileName=this.setName,this.setFilename=this.setName,Object.assign(this,typeof e=="string"?{name:e}:e||{}),this.filename&&!this.name&&(this.name=this.filename,this.filename=void 0)}getId(){return this.id}getMIMEType(){return this.mime}setMIMEType(e){return this.mime=e,this}getName(){return this.name}setName(e){return this.name=e,this}cleanContent(e){return e.startsWith("data:")?e.replace(/data:.*;base64,/,""):e}getContent(){return this.content}getThumbnail(){return this.thumbnail}getBuffer(e){return Buffer.from(e,"base64")}getContentAsArrayBuffer(){return this.getBuffer(this.content).buffer}getThumbnailAsArrayBuffer(){return this.getBuffer(this.thumbnail||"").buffer}getContentAsText(){return this.getBuffer(this.content).toString("utf-8")}setContent(e){return this.content=this.cleanContent(e),this}setContentFromText(e){return this.content=Buffer.from(e,"utf-8").toString("base64"),this}getDataURL(e){if(this.content)return"data:"+this.mime+";base64,"+(e&&this.thumbnail?this.thumbnail:this.content)}load(e){return Oe(this,void 0,void 0,function*(){return new Promise((t,i)=>{try{if(e){this.name=e.name,this.mime=e.type;let n=new FileReader;n.onload=()=>{this.content=n.result?this.cleanContent(n.result):"",t(this)},n.readAsDataURL(e)}else this.content="",t(this)}catch(n){i(n)}})})}getValue(){return{id:this.id,name:this.filename&&!this.name?this.filename:this.name,mime:this.mime,content:this.content,thumbnail:this.thumbnail}}};var A=class{constructor(e){this.getLogin=this.getUsername,this.getFirstName=this.getFirstname,this.getLastName=this.getLastname,this.getSysParam=this.getSystemParameter,Object.assign(this,e)}getUserId(){return this.userid}getUsername(){return this.login}getLang(){return this.lang}getEmail(){return this.email}getFirstname(){return this.firstname}getLastname(){return this.lastname}getPictureURL(){if(this.picture)return"data:"+this.picture.mime+";base64,"+this.picture.content}hasResponsibility(e){return this.responsibilities&&this.responsibilities.indexOf(e)!==-1}hasScope(e){if(this.apps){for(let t of this.apps)if(t.home===e)return!0}return!1}getSystemParameter(e){return this.sysparams&&this.sysparams[e]||""}T(e){return this.texts&&this.texts[e]||""}};var $=class{constructor(e,t){this.name=e,this.instance=t,this.rowidfield=w.DEFAULT_ROW_ID_NAME,this.label=e,this.help="",this.fields=new Array}};var d=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function h(a){try{u(i.next(a))}catch(l){o(l)}}function c(a){try{u(i.throw(a))}catch(l){o(l)}}function u(a){a.done?s(a.value):n(a.value).then(h,c)}u((i=i.apply(r,e||[])).next())})},O=class{constructor(e,t,i){this.getMetadata=this.getMetaData,this.session=e;let n=i||"api_"+t;this.metadata=new $(t,n),this.cacheKey=this.session.getBusinessObjectCacheKey(t,n),this.path=this.session.parameters.objpath+"?object="+encodeURIComponent(t)+"&inst="+encodeURIComponent(n),this.item={},this.filters={},this.list=[]}getMetaData(e){return d(this,void 0,void 0,function*(){let t="BusinessObject.getMetaData",i=this.session;return e=e||{},new Promise((n,s)=>{let o="";e.context&&(o+="&context="+encodeURIComponent(e.context)),e.contextParam&&(o+="&contextparam="+encodeURIComponent(e.contextParam)),i.sendRequest(this.path+"&action=metadata"+o,void 0,(h,c)=>{let u=i.parseResponse(h,c);if(i.debug(`[${t}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=i.getError(u.response,void 0,t);(e.error||i.error).call(this,a)||s.call(this,a)}else this.metadata=u.response,n.call(this,this.metadata)},h=>{h=i.getError(h,void 0,t),(e.error||i.error).call(this,h)||s.call(this,h)})})})}getName(){return this.metadata.name}getInstance(){return this.metadata.instance}getLabel(){return this.metadata.label}getHelp(){return this.metadata.help}getFields(){return this.metadata.fields}getField(e){let t=this.getFields(),i=0;for(;i<t.length&&t[i].name!==e;)i++;if(i<t.length)return t[i]}getRowIdFieldName(){return this.metadata.rowidfield}getRowIdField(){return this.getField(this.getRowIdFieldName())}getLinks(){return this.metadata.links}getFieldType(e){if(typeof e=="string"&&(e=this.getField(e)),e)return e.type}getFieldLabel(e){if(typeof e=="string"&&(e=this.getField(e)),e)return e.label}getFieldValue(e,t){if(t||(t=this.item),e&&t){let i=t[typeof e=="string"?e:e.name];return i&&i.mime?new x(i):i}}getFieldListValue(e,t){typeof e=="string"&&(e=this.getField(e));let i=this.getFieldValue(e,t);return e&&e.listOfValues?this.getListValue(e.listOfValues,i):i}getFieldListColors(e,t){typeof e=="string"&&(e=this.getField(e));let i=this.getFieldValue(e,t);return e&&e.listOfValues?this.getListColors(e.listOfValues,i):i}getFieldDataURL(e,t){typeof e!="string"&&(e=e.fullinput||e.name);let i=this.getFieldValue(e,t);if(i&&i.mime)return"data:"+i.mime+";base64,"+(i.content||i.thumbnail)}getFieldDocument(e,t){typeof e!="string"&&(e=e.fullinput||e.input||e.name);let i=this.getFieldValue(e,t);return i&&i.mime?new x(i):i}getFieldDocumentURL(e,t,i){typeof e!="string"&&(e=e.fullinput||e.input||e.name);let n=this.getFieldValue(e,t);if(n&&n.mime&&(n=n.id),n)return this.session.parameters.url+this.session.parameters.docpath+"?object="+encodeURIComponent(this.metadata.name)+"&inst="+encodeURIComponent(this.metadata.instance)+"&field="+encodeURIComponent(e)+"&row_id="+encodeURIComponent(this.getRowId(t))+"&doc_id="+encodeURIComponent(n)+(i?"&thumbnail=true":"")+(this.session.authtoken?"&_x_simplicite_authorization_="+encodeURIComponent(this.session.authtoken):"")}getListValue(e,t){if(e){for(let i of e)if(i.code===t)return i.value}return t}getListColors(e,t){if(e){for(let i of e)if(i.code===t)return{color:i.color,bgcolor:i.bgcolor}}return{color:"inherit",bgcolor:"inherit"}}setFieldValue(e,t,i){i||(i=this.item),e&&i&&(i[typeof e=="string"?e:e.name]=t instanceof x?t.getValue():t)}resetValues(e){e||(e=this.item);for(let t in e)delete e[t]}setFieldValues(e,t){return d(this,void 0,void 0,function*(){t||(t=this.item);let i;return e instanceof FormData?(i={},e.forEach((n,s)=>i[s]=n)):i=e,new Promise(n=>{let s=[];for(let o of Object.keys(i)){let h=i[o];h instanceof File?s.push(new Promise(c=>{new x().load(h).then(u=>{this.setFieldValue(o,u),c.call(this)})})):this.setFieldValue(o,h)}Promise.allSettled(s).then(()=>n.call(this,t))})})}isRowIdField(e){return!e.ref&&e.name===this.metadata.rowidfield}isTimestampField(e){let t=e.name;return!e.ref&&(t==="created_by"||t==="created_dt"||t==="updated_by"||t==="updated_dt")}getFilters(e){return d(this,void 0,void 0,function*(){let t="BusinessObject.getFilters",i=this.session;return e=e||{},new Promise((n,s)=>{let o="";e.context&&(o+="&context="+encodeURIComponent(e.context)),e.reset&&(o+="&reset="+!!e.reset),i.sendRequest(this.path+"&action=filters"+o,void 0,(h,c)=>{let u=i.parseResponse(h,c);if(i.debug(`[${t}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=i.getError(u.response,void 0,t);(e.error||i.error).call(this,a)||s.call(this,a)}else this.filters=u.response,n.call(this,this.filters)},h=>{h=i.getError(h,void 0,t),(e.error||i.error).call(this,h)||s.call(this,h)})})})}getReqContextOption(e){return e.context?`&context=${encodeURIComponent(e.context)}`:""}getReqOptions(e){let t=this.getReqContextOption(e),i=e.inlineDocs||e.inlineDocuments||e.inlineImages;i&&(t+=`&inline_documents=${encodeURIComponent(i.join?i.join(","):i)}`);let n=e.inlineThumbs||e.inlineThumbnails;n&&(t+=`&inline_thumbnails=${encodeURIComponent(n.join?n.join(","):n)}`);let s=e.inlineObjs||e.inlineObjects;return s&&(t+=`&inline_objects=${encodeURIComponent(s.join?s.join(","):s)}`),t}convertFilterWildCards(e){return typeof e=="string"?e.replace(new RegExp("\\*","g"),"%").replace(new RegExp("\\?","g"),"_"):e}getReqParams(e,t){let i="";if(!e)return i;for(let n of Object.entries(e)){let s=n[0],o=n[1]||"";if(o instanceof x&&(o=o.getValue()),o.name&&o.content)o.content.startsWith("data:")&&(o.content=o.content.replace(/data:.*;base64,/,"")),i+=(i!==""?"&":"")+s+"="+encodeURIComponent("id|"+(o.id?o.id:"0")+"|name|"+o.name+"|content|"+o.content);else if(o.object&&o.row_id)i+=(i!==""?"&":"")+s+"="+encodeURIComponent("object|"+o.object+"|row_id|"+o.row_id);else if(o.sort)for(let h of o)i+=(i!==""?"&":"")+s+"="+encodeURIComponent(t?this.convertFilterWildCards(h):h);else i+=(i!==""?"&":"")+s+"="+encodeURIComponent(t?this.convertFilterWildCards(o):o)}return i}getPath(e,t){let i=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.path}&action=${encodeURIComponent(e)}${i}`}getCount(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.getCount",n=this.session;return t=t||{},new Promise((s,o)=>{let h=this.getReqContextOption(t);t.operations===!0&&(h+="&_operations=true"),this.filters=e||{},n.sendRequest(`${this.getPath("count",t)}${h}`,this.getReqParams(this.filters,!0),(c,u)=>{let a=n.parseResponse(c,u);if(n.debug("["+i+"] HTTP status = "+u+", response type = "+a.type),a.type==="error"){let l=n.getError(a.response,void 0,i);(t.error||n.error).call(this,l)||o.call(this,l)}else this.count=a.response.count,this.page=a.response.page>=0?a.response.page+1:void 0,this.maxpage=a.response.maxpage>=0?a.response.maxpage+1:void 0,this.list=[],s.call(this,this.count)},c=>{c=n.getError(c,void 0,i),(t.error||n.error).call(this,c)||o.call(this,c)})})})}search(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.search",n=this.session;return t=t||{},new Promise((s,o)=>{let h=this.getReqOptions(t);t.page>0&&(h+=`&page=${t.page-1}`),t.metadata===!0&&(h+="&_md=true"),t.visible===!0&&(h+="&_visible=true"),this.filters=e||{},n.sendRequest(`${this.getPath("search",t)}${h}`,this.getReqParams(this.filters,!0),(c,u)=>{let a=n.parseResponse(c,u);if(n.debug(`[${i}] HTTP status = ${u}, response type = ${a.type}`),a.type==="error"){let l=n.getError(a.response,void 0,i);(t.error||n.error).call(this,l)||o.call(this,l)}else c.meta&&(this.metadata=a.response.meta),this.count=a.response.count,this.page=a.response.page>=0?a.response.page+1:void 0,this.maxpage=a.response.maxpage>=0?a.response.maxpage+1:void 0,this.list=a.response.list,s.call(this,this.list)},c=>{c=n.getError(c,void 0,i),(t.error||n.error).call(this,c)||o.call(this,c)})})})}get(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.get",n=this.session;return t=t||{},new Promise((s,o)=>{let h=this.getReqOptions(t),c=t.treeView;if(c&&(h+=`&treeview=${encodeURIComponent(c)}`),t.fields)for(let u of t.fields.length)h+=`&fields=${encodeURIComponent(u.replace(".","__"))}`;t.metadata&&(h+="&_md=true"),t.social&&(h+="&_social=true"),n.sendRequest(`${this.getPath("get",t)}&${this.metadata.rowidfield}=${encodeURIComponent(e||this.getRowId())}${h}`,void 0,(u,a)=>{let l=n.parseResponse(u,a);if(n.debug("[simplicite.BusinessObject.get] HTTP status = "+a+", response type = "+l.type),l.type==="error"){let p=n.getError(l.response,void 0,i);(t.error||n.error).call(this,p)||o.call(this,p)}else l.response.meta&&(this.metadata=l.response.meta),l.response.data?this.item=c?l.response.data.item:l.response.data:this.item=c?l.response.item:l.response,s.call(this,c?l.response:this.item)},u=>{u=n.getError(u,void 0,i),(t.error||n.error).call(this,u)||o.call(this,u)})})})}getForCreate(e){return d(this,void 0,void 0,function*(){return e=e||{},delete e.treeview,delete e.fields,e.context=w.CONTEXT_CREATE,this.get(w.DEFAULT_ROW_ID,e)})}getForUpdate(e,t){return d(this,void 0,void 0,function*(){return t=t||{},delete t.treeview,delete t.fields,t.context=w.CONTEXT_UPDATE,this.get(e||this.getRowId(),t)})}getForCopy(e,t){return d(this,void 0,void 0,function*(){return t=t||{},delete t.treeview,delete t.fields,t.context=w.CONTEXT_COPY,this.get(e||this.getRowId(),t)})}getForDelete(e,t){return d(this,void 0,void 0,function*(){return t=t||{},delete t.treeview,delete t.fields,t.context=w.CONTEXT_DELETE,this.get(e||this.getRowId(),t)})}getRowId(e){if(e=e||this.item,e)return e[this.getRowIdFieldName()]}populate(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.populate",n=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),n.sendRequest(`${this.getPath("populate",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(h,c)=>{let u=n.parseResponse(h,c);if(n.debug(`[${i}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=n.getError(u.response,void 0,i);(t.error||n.error).call(this,a)||o.call(this,a)}else this.item=u.response.data?u.response.data:u.response,s.call(this,this.item)},h=>{h=n.getError(h,void 0,i),(t.error||n.error).call(this,h)||o.call(this,h)})})})}getFieldLinkedList(e,t,i,n){return d(this,void 0,void 0,function*(){let s="BusinessObject.getFieldLinkedList",o=this.session;return n=n||{},new Promise((h,c)=>{typeof e!="string"&&(e=e.fullinput||e.name),typeof t!="string"&&(t=t.fullinput||t.name);let u=!1;i===!0?(u=!0,i=void 0):typeof i>"u"&&(i=this.getFieldValue(e)),o.sendRequest(this.getPath("getlinkedlist",n),this.getReqParams({origin:e,input:t,code:i,all:u}),(a,l)=>{let p=o.parseResponse(a,l);if(o.debug("["+s+"] HTTP status = "+l+", response type = "+p.type),p.type==="error"){let g=o.getError(p.response,void 0,s);(n.error||o.error).call(this,g)||c.call(this,g)}else this.item=p.response.result?p.response.result:p.response,h.call(this,this.item)},a=>{a=o.getError(a,void 0,s),(n.error||o.error).call(this,a)||c.call(this,a)})})})}save(e,t){return d(this,void 0,void 0,function*(){e&&(this.item=e);let i=this.item[this.metadata.rowidfield];return!i||i===w.DEFAULT_ROW_ID?this.create(e,t):this.update(e,t)})}create(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.create",n=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),this.item.row_id=w.DEFAULT_ROW_ID,n.sendRequest(`${this.getPath("create",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(h,c)=>{let u=n.parseResponse(h,c);if(n.debug("["+i+"] HTTP status = "+c+", response type = "+u.type),u.type==="error"){let a=n.getError(u.response,void 0,i);(t.error||n.error).call(this,a)||o.call(this,a)}else this.item=u.response.data?u.response.data:u.response,s.call(this,this.item)},h=>{h=n.getError(h,void 0,i),(t.error||n.error).call(this,h)||o.call(this,h)})})})}update(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.update",n=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),n.sendRequest(`${this.getPath("update",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(h,c)=>{let u=n.parseResponse(h,c);if(n.debug(`[${i}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=n.getError(u.response,void 0,i);(t.error||n.error).call(this,a)||o.call(this,a)}else this.item=u.response.data?u.response.data:u.response,s.call(this,this.item)},h=>{h=n.getError(h,void 0,i),(t.error||n.error).call(this,h)||o.call(this,h)})})})}del(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.del",n=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),n.sendRequest(`${this.getPath("delete",t)}&${this.metadata.rowidfield}=${encodeURIComponent(this.item[this.metadata.rowidfield])}`,void 0,(h,c)=>{let u=n.parseResponse(h,c);if(n.debug(`[${i}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=n.getError(u.response,void 0,i);(t.error||n.error).call(this,a)||o.call(this,a)}else this.item=void 0,delete u.response.undoredo,s.call(this,u.response)},h=>{h=n.getError(h,void 0,i),(t.error||n.error).call(this,h)||o.call(this,h)})})})}action(e,t,i){return d(this,void 0,void 0,function*(){let n=`BusinessObject.action(${e})`,s=this.session;return i=i||{},new Promise((o,h)=>{let c=t?`&${this.getRowIdFieldName()}=${encodeURIComponent(t)}`:"";s.sendRequest(`${this.getPath(e,i)}${c}`,this.getReqParams(i.parameters),(u,a)=>{let l=s.parseResponse(u,a);if(s.debug("["+n+"] HTTP status = "+a+", response type = "+l.type),l.type==="error"){let p=s.getError(l.response,void 0,n);(i.error||s.error).call(this,p)||h.call(this,p)}else{let p=l.response.result;o.call(this,p)}},u=>{u=s.getError(u,void 0,n),(i.error||s.error).call(this,u)||h.call(this,u)})})})}crosstab(e,t){return d(this,void 0,void 0,function*(){let i=`BusinessObject.crosstab(${e})`,n=this.session;return t=t||{},new Promise((s,o)=>{t.filters&&(this.filters=t.filters),n.sendRequest(`${this.getPath(t.cubes?"crosstabcubes":"crosstab",t)}&crosstab=${encodeURIComponent(e)}`,this.getReqParams(t.filters||this.filters,!0),(h,c)=>{let u=n.parseResponse(h,c);if(n.debug(`[${i}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=n.getError(u.response,void 0,i);(t.error||n.error).call(this,a)||o.call(this,a)}else s.call(this,u.response)},h=>{h=n.getError(h,void 0,i),(t.error||n.error).call(this,h)||o.call(this,h)})})})}print(e,t,i){return d(this,void 0,void 0,function*(){let n=`BusinessObject.print(${e})`,s=this.session;return i=i||{},new Promise((o,h)=>{i.filters&&(this.filters=i.filters);let c="";i.all&&(c+="&all="+!!i.all),i.mailing&&(c+="&mailing="+!!i.mailing),t&&(c+=`&${this.getRowIdFieldName()}=${encodeURIComponent(t)}`),s.sendRequest(`${this.getPath("print",i)}&printtemplate=${encodeURIComponent(e)}${c}`,void 0,(u,a)=>{let l=s.parseResponse(u,a);if(s.debug("["+n+"] HTTP status = "+a+", response type = "+l.type),l.type==="error"){let p=s.getError(l.response,void 0,n);(i.error||s.error).call(this,p)||h.call(this,p)}else o.call(this,new x(l.response))},u=>{u=s.getError(u,void 0,n),(i.error||s.error).call(this,u)||h.call(this,u)})})})}placemap(e,t,i){return d(this,void 0,void 0,function*(){let n=`BusinessObject.placemap(${e})`,s=this.session;return this.filters=t||{},i=i||{},new Promise((o,h)=>{i.filters&&(this.filters=i.filters),s.sendRequest(`${this.getPath("placemap",i)}&placemap=${encodeURIComponent(e)}`,this.getReqParams(this.filters,!0),(c,u)=>{let a=s.parseResponse(c,u);if(s.debug("["+n+"] HTTP status = "+u+", response type = "+a.type),a.type==="error"){let l=s.getError(a.response,void 0,n);(i.error||s.error).call(this,l)||h.call(this,l)}else o.call(this,a.response)},c=>{c=s.getError(c,void 0,n),(i.error||s.error).call(this,c)||h.call(this,c)})})})}setParameter(e,t,i){return d(this,void 0,void 0,function*(){let n="BusinessObject.setParameter",s=this.session;return i=i||{},new Promise((o,h)=>{let c={name:e};t&&(c.value=t),s.sendRequest(this.getPath("setparameter",i),this.getReqParams(c),(u,a)=>{let l=s.parseResponse(u,a);if(s.debug(`[${n}] HTTP status = ${a}, response type = ${l.type}`),l.type==="error"){let p=s.getError(l.response,void 0,n);(i.error||s.error).call(this,p)||h.call(this,p)}else{let p=l.response.result;o.call(this,p)}},u=>{u=s.getError(u,void 0,n),(i.error||s.error).call(this,u)||h.call(this,u)})})})}getParameter(e,t){return d(this,void 0,void 0,function*(){let i="BusinessObject.getParameter",n=this.session;return t=t||{},new Promise((s,o)=>{let h={name:e};n.sendRequest(this.getPath("getparameter",t),this.getReqParams(h),(c,u)=>{let a=n.parseResponse(c,u);if(n.debug(`[${i}] HTTP status = ${u}, response type = ${a.type}`),a.type==="error"){let l=n.getError(a.response,void 0,i);(t.error||n.error).call(this,l)||o.call(this,l)}else{let l=a.response.result;s.call(this,l)}},c=>{c=n.getError(c,void 0,i),(t.error||n.error).call(this,c)||o.call(this,c)})})})}getResourceURL(e,t){return this.session.getResourceURL(e,t,this.metadata.name,this.metadata.id)}};var S=class{constructor(e){this.name=e}};var Se=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function h(a){try{u(i.next(a))}catch(l){o(l)}}function c(a){try{u(i.throw(a))}catch(l){o(l)}}function u(a){a.done?s(a.value):n(a.value).then(h,c)}u((i=i.apply(r,e||[])).next())})},N=class{constructor(e,t){this.invoke=this.call,this.session=e,this.metadata=new S(t),this.path=`${this.session.parameters.extpath}/${encodeURIComponent(t)}`}getName(){return this.metadata.name}callParams(e){let t="";if(!e)return t;for(let i of Object.entries(e)){let n=i[0],s=i[1]||"";if(s.sort)for(let o of s)t+=(t!==""?"&":"")+n+"="+encodeURIComponent(o);else t+=(t!==""?"&":"")+n+"="+encodeURIComponent(s)}return t}call(e,t,i){return Se(this,void 0,void 0,function*(){let n="ExternalObject.call",s=this.session;return i=i||{},new Promise((o,h)=>{let c="";e&&(c=this.callParams(e)),i.businessCase&&(c+=`_bc=${encodeURIComponent(i.businessCase)}`);let u=i.method?i.method.toUpperCase():t?"POST":"GET",a={};i.contentType?a["content-type"]=i.contentType:t&&!(t instanceof FormData)&&(a["content-type"]=typeof t=="string"?"application/x-www-form-urlencoded":"application/json"),i.accept&&(a.accept=i.accept==="json"?"application/json":i.accept);let l=s.getBearerTokenHeader();l?a[s.authheader]=l:(l=s.getBasicAuthHeader(),l&&(a[s.authheader]=l));let p=s.parameters.url+(i.path&&i.path.startsWith("/")?i.path:this.path+(i.path?"/"+i.path:""))+(c!==""?"?"+c:""),g=t?typeof t=="string"||t instanceof FormData?t:JSON.stringify(t):void 0;s.debug("[simplicite.ExternalObject.call] "+u+" "+p+(g?" with "+g:"")),fetch(p,{method:u,headers:a,signal:AbortSignal.timeout(s.parameters.timeout),body:g}).then(m=>{let U=m.headers.get("content-type");s.debug(`[${n}] HTTP status = ${m.status}, response content type = ${U}`),U&&U.startsWith("application/json")?m.json().then(y=>{o.call(this,y,m.status,m.headers)}).catch(y=>{y=s.getError(y,void 0,n),(i.error||s.error).call(this,y)||h.call(this,y)}):U&&(U.startsWith("text/")||U.startsWith("application/yaml"))?m.text().then(y=>{o.call(this,y,m.status,m.headers)}).catch(y=>{y=s.getError(y,void 0,n),(i.error||s.error).call(this,y)||h.call(this,y)}):m.arrayBuffer().then(y=>{o.call(this,y,m.status,m.headers)}).catch(y=>{y=s.getError(y,void 0,n),(i.error||s.error).call(this,y)||h.call(this,y)})}).catch(m=>{m=s.getError(m,void 0,n),(i.error||s.error).call(this,m)||h.call(this,m)})})})}};var _e=$e(Be(),1);var _=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function h(a){try{u(i.next(a))}catch(l){o(l)}}function c(a){try{u(i.throw(a))}catch(l){o(l)}}function u(a){a.done?s(a.value):n(a.value).then(h,c)}u((i=i.apply(r,e||[])).next())})},j=class{constructor(e){this.constants=w,this.health=this.getHealth,e=e||{};let t=typeof globalThis.Simplicite<"u";this.endpoint=e.endpoint||(t?globalThis.Simplicite.ENDPOINT:"api"),this.authheader=e.authheader||this.constants.DEFAULT_AUTH_HEADER,this.log=e.logHandler||((...a)=>{console.log(a)}),this.info=e.infoHandler||((...a)=>{a&&a.length===1&&typeof a[0]=="string"?console.info(`INFO - ${a[0]}`):console.info("INFO",a)}),this.warn=e.warningHandler||((...a)=>{a&&a.length===1&&typeof a[0]=="string"?console.warn(`WARN - ${a[0]}`):console.warn(`WARN${a&&a.length>0&&a[0].message?` - ${a[0].message}`:""}`,a)}),this.error=e.errorHandler||((...a)=>{a&&a.length===1&&typeof a[0]=="string"?console.error(`ERROR - ${a[0]}`):console.error(`ERROR${a&&a.length>0&&a[0].message?` - ${a[0].message}`:""}`,a)}),this.debugMode=!!e.debug,this.debug=e.debugHandler||((...a)=>{this.debugMode&&(a&&a.length===1&&typeof a[0]=="string"?console.info(`DEBUG - ${a[0]}`):console.log("DEBUG",a))});let i=e.url||t&&globalThis.Simplicite.URL||globalThis.window&&globalThis.window.location.origin;if(this.debug("[simplicite] URL parameter = "+i),i)try{e.scheme=i.replace(/:.*$/,"");let a=i.replace(new RegExp("^"+e.scheme+"://"),"").split(":");if(a.length===1)e.host=a[0].replace(/\/.*$/,""),e.port=e.scheme==="http"?80:443,e.root=a[0].replace(new RegExp("^"+e.host+"/?"),"");else{if(e.host=a[0],e.port=parseInt(a[1].replace(/\/.*$/,""),10),isNaN(e.port))throw new Error("Incorrect port");e.root=a[1].replace(new RegExp("^"+e.port+"/?"),"")}e.root==="/"&&(e.root="")}catch(a){this.error("Unable to parse URL ["+i+"]: "+a.message);return}let n=e.scheme||(e.port===443?"https":"http");if(n!=="http"&&n!=="https"){this.error("Incorrect scheme ["+e.scheme+"]");return}let s=e.host||"localhost",o=e.port||8080,h=e.root||"";h==="/"&&(h="");let c=n+"://"+s;(n==="http"&&o!==80||n==="https"&&o!==443)&&(c+=":"+o),h!==""&&(c+=h.startsWith("/")?h:"/"+h),this.debug("[simplicite] Base URL = "+c);let u=this.endpoint==="uipublic"?"":"/"+this.endpoint;this.parameters={scheme:n,host:s,port:o,root:h,url:c,username:e.username,password:e.password,authtoken:e.authtoken,timeout:(e.timeout||30)*1e3,compress:e.compress||!0,healthpath:(u==="/ui"?u:"")+"/health?format=json",loginpath:u==="/api"?"/api/login?format=json":u+"/json/app?action=session",logoutpath:u==="/api"?"/api/logout?format=json":u+"/json/app?action=logout",apppath:u+"/json/app",objpath:u+"/json/obj",extpath:u+"/ext",docpath:u+"/raw/document",respath:"/resource"},this.username=e.username||e.login,this.password=e.password||e.pwd,this.authtoken=e.authtoken||e.token,!this.authtoken&&this.endpoint==="ui"&&(this.authtoken=this.getFromStorage(this.constants.UI_AUTH_TOKEN_STORAGE_KEY)||(t?globalThis.Simplicite.AUTH_TOKEN:void 0)),this.ajaxkey=e.ajaxkey,!this.ajaxkey&&this.endpoint==="ui"&&(this.ajaxkey=this.getFromStorage(this.constants.UI_AJAX_KEY_STORAGE_KEY)||(t?globalThis.Simplicite.AJAX_KEY:void 0)),this.businessObjectCache=new Map}getFromStorage(e){let t=null,i=globalThis.window?globalThis.window.localStorage:null;if(i&&(t=i.getItem(e)||i.getItem(e.toLowerCase())),!t){let n=globalThis.window?globalThis.window.sessionStorage:null;n&&(t=n.getItem(e)||n.getItem(e.toLowerCase()))}return t}getModuleVersion(){return this.constants.MODULE_VERSION}setUsername(e){this.username=e}setPassword(e){this.password=e}setAuthToken(e){this.authtoken=e}setAuthTokenExpiryDate(e){this.authtokenexpiry=e}isAuthTokenExpired(){return this.authtokenexpiry?new Date>this.authtokenexpiry:!1}setAjaxKey(e){this.ajaxkey=e}getBusinessObjectCacheKey(e,t){return e+":"+(t||"js_"+e)}clear(){this.username=void 0,this.password=void 0,this.authtoken=void 0,this.authtokenexpiry=void 0,this.sessionid=void 0,this.grant=void 0,this.appinfo=void 0,this.sysinfo=void 0,this.devinfo=void 0,this.businessObjectCache=new Map}getBasicAuthHeader(){return this.username&&this.password?"Basic "+_e.Buffer.from(this.username+":"+this.password).toString("base64"):void 0}getBearerTokenHeader(){return this.authtoken?"Bearer "+this.authtoken:void 0}getError(e,t,i){if(typeof e=="string")return{message:e,status:t||200,origin:i};if(e.response){if(typeof e.response=="string")return{message:e.response,status:t||200,origin:i};if(i)try{e.response.origin=i}catch{}return e.response}else{if(i)try{e.origin=i}catch{}return e}}compressData(e){let i=(typeof e=="string"?new Blob([e],{type:"text/plain"}).stream():new Blob([JSON.stringify(e)],{type:"application/json"}).stream()).pipeThrough(new CompressionStream("gzip"));return new Response(i).blob()}uncompressData(e){let t=e.stream().pipeThrough(new DecompressionStream("gzip"));return new Response(t).text()}sendRequest(e,t,i,n){let s="Session.sendRequest",o=t?"POST":"GET",h={};t&&(h["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),h.accept="application/json";let c=this.getBearerTokenHeader();c?h[this.authheader]=c:(c=this.getBasicAuthHeader(),c&&(h[this.authheader]=c));let u=this.parameters.url+(e||"/");this.ajaxkey&&(u+=(u.indexOf("?")>=0?"&":"?")+"_ajaxkey="+encodeURIComponent(this.ajaxkey));let a=t?typeof t=="string"?t:JSON.stringify(t):void 0;this.debug(`[${s}] ${o} ${u}${a?" with "+a:""}`),fetch(u,{method:o,headers:h,signal:AbortSignal.timeout(this.parameters.timeout),body:a}).then(l=>{i&&l.text().then(p=>{i.call(this,p,l.status,l.headers)})}).catch(l=>{let p=l.response&&l.response.status?l.response.status:void 0,g=l.response&&l.response.data?l.response.data:l;if(n)n.call(this,this.getError(g,p,s));else throw g})}parseResponse(e,t){try{return t!==200?{type:"error",response:this.getError("HTTP status: "+t,t)}:typeof e=="object"?e:JSON.parse(e)}catch(i){return{type:"error",response:this.getError("Parsing error: "+i.message,t)}}}getHealth(e){return _(this,void 0,void 0,function*(){let t="Session.getHealth";return e=e||{},new Promise((i,n)=>{let s=`&full=${!!e.full}`;e.businessCase&&(s+=`&_bc=${encodeURIComponent(e.businessCase)}`),this.sendRequest(`${this.parameters.healthpath}${s}`,void 0,(o,h)=>{let c=this.parseResponse(o,h);if(this.debug(`[${t}] HTTP status = ${h}, response type = ${o}`),c.type==="error"){let u=this.getError(c.response,void 0,t);(e.error||this.error).call(this,u)||n.call(this,u)}else i.call(this,c)},o=>{o=this.getError(o,void 0,t),(e.error||this.error).call(this,o)||n.call(this,o)})})})}login(e){return _(this,void 0,void 0,function*(){let t="Session.login";return e=e||{},new Promise((i,n)=>{(e.username||e.login)&&(e.password||e.pwd)?(this.clear(),this.username=e.username||e.login,this.password=e.password||e.pwd):(e.authtoken||e.authToken||e.token)&&(this.clear(),this.authtoken=e.authtoken||e.authToken||e.token),this.sendRequest(this.parameters.loginpath,void 0,(s,o)=>{let h=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${h.type||(h.error?"error":"login")}`),h.type==="error"||h.error){let c=this.getError(h.response?h.response:h,void 0,t);(e.error||this.error).call(this,c)||n.call(this,c)}else{this.sessionid=h.response?h.response.id:h.sessionid,this.debug(`[${t}] Session ID = ${this.sessionid}`),this.username=h.response?h.response.login:h.login,this.username&&this.debug(`[${t}] Username = ${this.username}`),this.authtoken=h.response?h.response.authtoken:h.authtoken,this.authtoken&&this.debug(`[${t}] Auth token = ${this.authtoken}`);try{let c=new Date;c.setTime(h.response?h.response.authtokenexpiry:h.authtokenexpiry),this.authtokenexpiry=c}catch{this.authtokenexpiry=void 0}this.authtokenexpiry&&this.debug(`[${t}] Auth token expiry date = ${this.authtokenexpiry.toLocaleDateString()} ${this.authtokenexpiry.toLocaleTimeString()}`),this.grant=new A({login:this.username,userid:h.response?h.response.userid:h.userid,firstname:h.response?h.response.firstname:h.firstname,lastname:h.response?h.response.lastname:h.lastname,email:h.response?h.response.email:h.email}),i.call(this,h.response||h)}},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||n.call(this,s)})})})}logout(e){return _(this,void 0,void 0,function*(){let t="Session.logout";return e=e||{},new Promise((i,n)=>{this.sendRequest(this.parameters.logoutpath,void 0,(s,o)=>{let h=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${h.type||(h.error?"error":"logout")}`),h.type==="error"){let c=this.getError(h.response?h.response:h,void 0,t);(e.error||this.error).call(this,c)||n.call(this,c)}else this.clear(),this.username=this.parameters.username,this.password=this.parameters.password,this.authtoken=this.parameters.authtoken,i.call(this,h.response||h)},s=>{s=this.getError(s,void 0,t),s.status===401&&(this.authtoken=void 0),(e.error||this.error).call(this,s)||n.call(this,s)})})})}getPath(e,t){let i=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.parameters.apppath}?action=${encodeURIComponent(e)}${i}`}getGrant(e){return _(this,void 0,void 0,function*(){let t="Session.getGrant";return e=e||{},new Promise((i,n)=>{let s="&web=true",o=!!e.includeTexts||!!e.texts;s+=`&texts=${encodeURIComponent(o)}`;let h=!!e.inlinePicture||!!e.picture;h&&(s+="&inline_picture=true"),(!!e.includeSysparams||!!e.sysparams)&&(s+="&sysparams=true"),this.sendRequest(`${this.getPath("getgrant",e)}${s}`,void 0,(u,a)=>{let l=this.parseResponse(u,a);if(this.debug(`[${t}] HTTP status = ${a}, response type = ${l.type}`),l.type==="error"){let p=this.getError(l.response,void 0,t);(e.error||this.error).call(this,p)||n.call(this,p)}else this.grant=new A(l.response),h&&(this.grant.picture=new x(this.grant.picture)),o&&(this.grant.texts=Object.assign(new Map,this.grant.texts)),i.call(this,this.grant)},u=>{u=this.getError(u,void 0,t),(e.error||this.error).call(this,u)||n.call(this,u)})})})}changePassword(e,t){return _(this,void 0,void 0,function*(){let i="Session.changePassword";return t=t||{},new Promise((n,s)=>{this.sendRequest(`${this.getPath("setpassword",t)}&password=${encodeURIComponent(e)}`,void 0,(o,h)=>{let c=this.parseResponse(o,h);if(this.debug(`[${i}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=this.getError(c.response,void 0,i);(t.error||this.error).call(this,u)||s.call(this,u)}else n.call(this,c.response)},o=>{o=this.getError(o,void 0,i),(t.error||this.error).call(this,o)||s.call(this,o)})})})}getAppInfo(e){return _(this,void 0,void 0,function*(){let t="Session.getAppInfo";return e=e||{},new Promise((i,n)=>{this.sendRequest(this.getPath("getinfo",e),void 0,(s,o)=>{let h=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${h.type}`),h.type==="error"){let c=this.getError(h.response,void 0,t);(e.error||this.error).call(this,c)||n.call(this,c)}else this.appinfo=h.response,i.call(this,this.appinfo)},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||n.call(this,s)})})})}getSysInfo(e){return _(this,void 0,void 0,function*(){let t="Session.getSysInfo";return e=e||{},new Promise((i,n)=>{this.sendRequest(this.getPath("sysinfo",e),void 0,(s,o)=>{let h=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${h.type}`),h.type==="error"){let c=this.getError(h.response,void 0,t);(e.error||this.error).call(this,c)||n.call(this,c)}else this.sysinfo=h.response,i.call(this,this.sysinfo)},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||n.call(this,s)})})})}getDevInfo(e,t){return _(this,void 0,void 0,function*(){let i="Session.getDevInfo";return t=t||{},new Promise((n,s)=>{let o="";e&&(o+=`&module=${encodeURIComponent(e)}`),this.sendRequest(`${this.getPath("devinfo",t)}${o}`,void 0,(h,c)=>{let u=this.parseResponse(h,c);if(this.debug(`[${i}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=this.getError(u.response,void 0,i);(t.error||this.error).call(this,a)||s.call(this,a)}else e||(this.devinfo=u.response),n.call(this,u.response)},h=>{h=this.getError(h,void 0,i),(t.error||this.error).call(this,h)||s.call(this,h)})})})}getNews(e){return _(this,void 0,void 0,function*(){let t="Session.getNews";return e=e||{},new Promise((i,n)=>{let s="";(!!e.inlineImages||!!e.images)&&(s+="&inline_images=true"),this.sendRequest(`${this.getPath("news",e)}${s}`,void 0,(h,c)=>{let u=this.parseResponse(h,c);if(this.debug(`[${t}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let a=this.getError(u.response,void 0,t);(e.error||this.error).call(this,a)||n.call(this,a)}else{this.news=u.response;for(let a of this.news)a.image=new x(a.image);i.call(this,this.news)}},h=>{h=this.getError(h,void 0,t),(e.error||this.error).call(this,h)||n.call(this,h)})})})}indexSearch(e,t,i){return _(this,void 0,void 0,function*(){let n="Session.indexSearch";return i=i||{},new Promise((s,o)=>{let h=`&request=${encodeURIComponent(e||"")}`;t&&(h+=`&object=${encodeURIComponent(t)}`),i.metadata===!0&&(h+="&_md=true"),i.context&&(h+=`&context=${encodeURIComponent(i.context)}`),this.sendRequest(`${this.getPath("indexsearch",i)}${h}`,void 0,(c,u)=>{let a=this.parseResponse(c,u);if(this.debug(`[${n}] HTTP status = ${u}, response type = ${a.type}`),a.type==="error"){let l=this.getError(a.response,void 0,n);(i.error||this.error).call(this,l)||o.call(this,l)}else s.call(this,a.response)},c=>{c=this.getError(c,void 0,n),(i.error||this.error).call(this,c)||o.call(this,c)})})})}getBusinessObject(e,t){let i=this.getBusinessObjectCacheKey(e,t),n=this.businessObjectCache[i];return n||(n=new O(this,e,t),this.businessObjectCache[i]=n),n}getExternalObject(e){return new N(this,e)}getResourceURL(e,t,i,n){return this.parameters.url+this.parameters.respath+"?code="+encodeURIComponent(e)+"&type="+encodeURIComponent(t||"IMG")+(i?"&object="+encodeURIComponent(i):"")+(n?"&objid="+encodeURIComponent(n):"")+(this.authtoken?"_x_simplicite_authorization_="+encodeURIComponent(this.authtoken):"")}};var pt=r=>new j(r),q={constants:w,session:pt,Session:j,Doc:x,Grant:A,BusinessObjectMetadata:$,BusinessObject:O,ExternalObjectMetadata:S,ExternalObject:N};if(typeof globalThis<"u")globalThis.simplicite=q;else if(typeof self<"u")self.simplicite=q;else if(typeof window<"u")window.simplicite=q;else if(typeof global<"u")global.simplicite=q;else throw new Error("Unable to find global object");})();
/**
 * Simplicite(R) platform Javascript API client module (for node.js and browser).
 * @module simplicite
 * @version 3.1.4
 * @license Apache-2.0
 */
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
//# sourceMappingURL=simplicite.min.js.map
