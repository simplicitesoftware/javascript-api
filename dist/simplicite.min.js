(()=>{var t={742:(t,e)=>{"use strict";e.byteLength=function(t){var e=h(t),s=e[0],r=e[1];return 3*(s+r)/4-r},e.toByteArray=function(t){var e,s,n=h(t),o=n[0],a=n[1],l=new i(function(t,e,s){return 3*(e+s)/4-s}(0,o,a)),c=0,u=a>0?o-4:o;for(s=0;s<u;s+=4)e=r[t.charCodeAt(s)]<<18|r[t.charCodeAt(s+1)]<<12|r[t.charCodeAt(s+2)]<<6|r[t.charCodeAt(s+3)],l[c++]=e>>16&255,l[c++]=e>>8&255,l[c++]=255&e;2===a&&(e=r[t.charCodeAt(s)]<<2|r[t.charCodeAt(s+1)]>>4,l[c++]=255&e);1===a&&(e=r[t.charCodeAt(s)]<<10|r[t.charCodeAt(s+1)]<<4|r[t.charCodeAt(s+2)]>>2,l[c++]=e>>8&255,l[c++]=255&e);return l},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,n=[],o=16383,h=0,l=r-i;h<l;h+=o)n.push(a(t,h,h+o>l?l:h+o));1===i?(e=t[r-1],n.push(s[e>>2]+s[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],n.push(s[e>>10]+s[e>>4&63]+s[e<<2&63]+"="));return n.join("")};for(var s=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)s[o]=n[o],r[n.charCodeAt(o)]=o;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=t.indexOf("=");return-1===s&&(s=e),[s,s===e?0:4-s%4]}function a(t,e,r){for(var i,n,o=[],h=e;h<r;h+=3)i=(t[h]<<16&16711680)+(t[h+1]<<8&65280)+(255&t[h+2]),o.push(s[(n=i)>>18&63]+s[n>>12&63]+s[n>>6&63]+s[63&n]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},764:(t,e,s)=>{"use strict";const r=s(742),i=s(645),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.lW=a,e.h2=50;const o=2147483647;function h(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,s){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return u(t)}return l(t,e,s)}function l(t,e,s){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!a.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const s=0|g(t,e);let r=h(s);const i=r.write(t,e);i!==s&&(r=r.slice(0,i));return r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(z(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return p(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(z(t,ArrayBuffer)||t&&z(t.buffer,ArrayBuffer))return f(t,e,s);if("undefined"!=typeof SharedArrayBuffer&&(z(t,SharedArrayBuffer)||t&&z(t.buffer,SharedArrayBuffer)))return f(t,e,s);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return a.from(r,e,s);const i=function(t){if(a.isBuffer(t)){const e=0|d(t.length),s=h(e);return 0===s.length||t.copy(s,0,0,e),s}if(void 0!==t.length)return"number"!=typeof t.length||J(t.length)?h(0):p(t);if("Buffer"===t.type&&Array.isArray(t.data))return p(t.data)}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return c(t),h(t<0?0:0|d(t))}function p(t){const e=t.length<0?0:0|d(t.length),s=h(e);for(let r=0;r<e;r+=1)s[r]=255&t[r];return s}function f(t,e,s){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(s||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,e):new Uint8Array(t,e,s),Object.setPrototypeOf(r,a.prototype),r}function d(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function g(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const s=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===s)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return X(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return W(t).length;default:if(i)return r?-1:X(t).length;e=(""+e).toLowerCase(),i=!0}}function m(t,e,s){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return A(this,e,s);case"utf8":case"utf-8":return O(this,e,s);case"ascii":return U(this,e,s);case"latin1":case"binary":return _(this,e,s);case"base64":return P(this,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,s);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,s){const r=t[e];t[e]=t[s],t[s]=r}function E(t,e,s,r,i){if(0===t.length)return-1;if("string"==typeof s?(r=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),J(s=+s)&&(s=i?0:t.length-1),s<0&&(s=t.length+s),s>=t.length){if(i)return-1;s=t.length-1}else if(s<0){if(!i)return-1;s=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:w(t,e,s,r,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,s):Uint8Array.prototype.lastIndexOf.call(t,e,s):w(t,[e],s,r,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,s,r,i){let n,o=1,h=t.length,a=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,h/=2,a/=2,s/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let r=-1;for(n=s;n<h;n++)if(l(t,n)===l(e,-1===r?0:n-r)){if(-1===r&&(r=n),n-r+1===a)return r*o}else-1!==r&&(n-=n-r),r=-1}else for(s+a>h&&(s=h-a),n=s;n>=0;n--){let s=!0;for(let r=0;r<a;r++)if(l(t,n+r)!==l(e,r)){s=!1;break}if(s)return n}return-1}function b(t,e,s,r){s=Number(s)||0;const i=t.length-s;r?(r=Number(r))>i&&(r=i):r=i;const n=e.length;let o;for(r>n/2&&(r=n/2),o=0;o<r;++o){const r=parseInt(e.substr(2*o,2),16);if(J(r))return o;t[s+o]=r}return o}function T(t,e,s,r){return G(X(e,t.length-s),t,s,r)}function R(t,e,s,r){return G(function(t){const e=[];for(let s=0;s<t.length;++s)e.push(255&t.charCodeAt(s));return e}(e),t,s,r)}function v(t,e,s,r){return G(W(e),t,s,r)}function I(t,e,s,r){return G(function(t,e){let s,r,i;const n=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)s=t.charCodeAt(o),r=s>>8,i=s%256,n.push(i),n.push(r);return n}(e,t.length-s),t,s,r)}function P(t,e,s){return 0===e&&s===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,s))}function O(t,e,s){s=Math.min(t.length,s);const r=[];let i=e;for(;i<s;){const e=t[i];let n=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=s){let s,r,h,a;switch(o){case 1:e<128&&(n=e);break;case 2:s=t[i+1],128==(192&s)&&(a=(31&e)<<6|63&s,a>127&&(n=a));break;case 3:s=t[i+1],r=t[i+2],128==(192&s)&&128==(192&r)&&(a=(15&e)<<12|(63&s)<<6|63&r,a>2047&&(a<55296||a>57343)&&(n=a));break;case 4:s=t[i+1],r=t[i+2],h=t[i+3],128==(192&s)&&128==(192&r)&&128==(192&h)&&(a=(15&e)<<18|(63&s)<<12|(63&r)<<6|63&h,a>65535&&a<1114112&&(n=a))}}null===n?(n=65533,o=1):n>65535&&(n-=65536,r.push(n>>>10&1023|55296),n=56320|1023&n),r.push(n),i+=o}return function(t){const e=t.length;if(e<=$)return String.fromCharCode.apply(String,t);let s="",r=0;for(;r<e;)s+=String.fromCharCode.apply(String,t.slice(r,r+=$));return s}(r)}a.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,s){return l(t,e,s)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,s){return function(t,e,s){return c(t),t<=0?h(t):void 0!==e?"string"==typeof s?h(t).fill(e,s):h(t).fill(e):h(t)}(t,e,s)},a.allocUnsafe=function(t){return u(t)},a.allocUnsafeSlow=function(t){return u(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(z(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),z(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let s=t.length,r=e.length;for(let i=0,n=Math.min(s,r);i<n;++i)if(t[i]!==e[i]){s=t[i],r=e[i];break}return s<r?-1:r<s?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);let s;if(void 0===e)for(e=0,s=0;s<t.length;++s)e+=t[s].length;const r=a.allocUnsafe(e);let i=0;for(s=0;s<t.length;++s){let e=t[s];if(z(e,Uint8Array))i+e.length>r.length?(a.isBuffer(e)||(e=a.from(e)),e.copy(r,i)):Uint8Array.prototype.set.call(r,e,i);else{if(!a.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,i)}i+=e.length}return r},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},a.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},a.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},a.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?O(this,0,t):m.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){let t="";const s=e.h2;return t=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(t+=" ... "),"<Buffer "+t+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(t,e,s,r,i){if(z(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===s&&(s=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||s>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=s)return 0;if(r>=i)return-1;if(e>=s)return 1;if(this===t)return 0;let n=(i>>>=0)-(r>>>=0),o=(s>>>=0)-(e>>>=0);const h=Math.min(n,o),l=this.slice(r,i),c=t.slice(e,s);for(let t=0;t<h;++t)if(l[t]!==c[t]){n=l[t],o=c[t];break}return n<o?-1:o<n?1:0},a.prototype.includes=function(t,e,s){return-1!==this.indexOf(t,e,s)},a.prototype.indexOf=function(t,e,s){return E(this,t,e,s,!0)},a.prototype.lastIndexOf=function(t,e,s){return E(this,t,e,s,!1)},a.prototype.write=function(t,e,s,r){if(void 0===e)r="utf8",s=this.length,e=0;else if(void 0===s&&"string"==typeof e)r=e,s=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(s)?(s>>>=0,void 0===r&&(r="utf8")):(r=s,s=void 0)}const i=this.length-e;if((void 0===s||s>i)&&(s=i),t.length>0&&(s<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let n=!1;for(;;)switch(r){case"hex":return b(this,t,e,s);case"utf8":case"utf-8":return T(this,t,e,s);case"ascii":case"latin1":case"binary":return R(this,t,e,s);case"base64":return v(this,t,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,e,s);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),n=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const $=4096;function U(t,e,s){let r="";s=Math.min(t.length,s);for(let i=e;i<s;++i)r+=String.fromCharCode(127&t[i]);return r}function _(t,e,s){let r="";s=Math.min(t.length,s);for(let i=e;i<s;++i)r+=String.fromCharCode(t[i]);return r}function A(t,e,s){const r=t.length;(!e||e<0)&&(e=0),(!s||s<0||s>r)&&(s=r);let i="";for(let r=e;r<s;++r)i+=K[t[r]];return i}function C(t,e,s){const r=t.slice(e,s);let i="";for(let t=0;t<r.length-1;t+=2)i+=String.fromCharCode(r[t]+256*r[t+1]);return i}function B(t,e,s){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>s)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,s,r,i,n){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<n)throw new RangeError('"value" argument is out of bounds');if(s+r>t.length)throw new RangeError("Index out of range")}function x(t,e,s,r,i){H(e,r,i,t,s,7);let n=Number(e&BigInt(4294967295));t[s++]=n,n>>=8,t[s++]=n,n>>=8,t[s++]=n,n>>=8,t[s++]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[s++]=o,o>>=8,t[s++]=o,o>>=8,t[s++]=o,o>>=8,t[s++]=o,s}function S(t,e,s,r,i){H(e,r,i,t,s,7);let n=Number(e&BigInt(4294967295));t[s+7]=n,n>>=8,t[s+6]=n,n>>=8,t[s+5]=n,n>>=8,t[s+4]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[s+3]=o,o>>=8,t[s+2]=o,o>>=8,t[s+1]=o,o>>=8,t[s]=o,s+8}function N(t,e,s,r,i,n){if(s+r>t.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function j(t,e,s,r,n){return e=+e,s>>>=0,n||N(t,0,s,4),i.write(t,e,s,r,23,4),s+4}function F(t,e,s,r,n){return e=+e,s>>>=0,n||N(t,0,s,8),i.write(t,e,s,r,52,8),s+8}a.prototype.slice=function(t,e){const s=this.length;(t=~~t)<0?(t+=s)<0&&(t=0):t>s&&(t=s),(e=void 0===e?s:~~e)<0?(e+=s)<0&&(e=0):e>s&&(e=s),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,s){t>>>=0,e>>>=0,s||B(t,e,this.length);let r=this[t],i=1,n=0;for(;++n<e&&(i*=256);)r+=this[t+n]*i;return r},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,s){t>>>=0,e>>>=0,s||B(t,e,this.length);let r=this[t+--e],i=1;for(;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readBigUInt64LE=Z((function(t){q(t>>>=0,"offset");const e=this[t],s=this[t+7];void 0!==e&&void 0!==s||Y(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+s*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),a.prototype.readBigUInt64BE=Z((function(t){q(t>>>=0,"offset");const e=this[t],s=this[t+7];void 0!==e&&void 0!==s||Y(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+s;return(BigInt(r)<<BigInt(32))+BigInt(i)})),a.prototype.readIntLE=function(t,e,s){t>>>=0,e>>>=0,s||B(t,e,this.length);let r=this[t],i=1,n=0;for(;++n<e&&(i*=256);)r+=this[t+n]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,s){t>>>=0,e>>>=0,s||B(t,e,this.length);let r=e,i=1,n=this[t+--r];for(;r>0&&(i*=256);)n+=this[t+--r]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},a.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);const s=this[t]|this[t+1]<<8;return 32768&s?4294901760|s:s},a.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);const s=this[t+1]|this[t]<<8;return 32768&s?4294901760|s:s},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readBigInt64LE=Z((function(t){q(t>>>=0,"offset");const e=this[t],s=this[t+7];void 0!==e&&void 0!==s||Y(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(s<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),a.prototype.readBigInt64BE=Z((function(t){q(t>>>=0,"offset");const e=this[t],s=this[t+7];void 0!==e&&void 0!==s||Y(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+s)})),a.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,s,r){if(t=+t,e>>>=0,s>>>=0,!r){L(this,t,e,s,Math.pow(2,8*s)-1,0)}let i=1,n=0;for(this[e]=255&t;++n<s&&(i*=256);)this[e+n]=t/i&255;return e+s},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,s,r){if(t=+t,e>>>=0,s>>>=0,!r){L(this,t,e,s,Math.pow(2,8*s)-1,0)}let i=s-1,n=1;for(this[e+i]=255&t;--i>=0&&(n*=256);)this[e+i]=t/n&255;return e+s},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigUInt64LE=Z((function(t,e=0){return x(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeBigUInt64BE=Z((function(t,e=0){return S(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeIntLE=function(t,e,s,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*s-1);L(this,t,e,s,r-1,-r)}let i=0,n=1,o=0;for(this[e]=255&t;++i<s&&(n*=256);)t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/n>>0)-o&255;return e+s},a.prototype.writeIntBE=function(t,e,s,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*s-1);L(this,t,e,s,r-1,-r)}let i=s-1,n=1,o=0;for(this[e+i]=255&t;--i>=0&&(n*=256);)t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/n>>0)-o&255;return e+s},a.prototype.writeInt8=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,s){return t=+t,e>>>=0,s||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigInt64LE=Z((function(t,e=0){return x(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeBigInt64BE=Z((function(t,e=0){return S(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeFloatLE=function(t,e,s){return j(this,t,e,!0,s)},a.prototype.writeFloatBE=function(t,e,s){return j(this,t,e,!1,s)},a.prototype.writeDoubleLE=function(t,e,s){return F(this,t,e,!0,s)},a.prototype.writeDoubleBE=function(t,e,s){return F(this,t,e,!1,s)},a.prototype.copy=function(t,e,s,r){if(!a.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<s&&(r=s),r===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-s&&(r=t.length-e+s);const i=r-s;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,s,r):Uint8Array.prototype.set.call(t,this.subarray(s,r),e),i},a.prototype.fill=function(t,e,s,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<s)throw new RangeError("Out of range index");if(s<=e)return this;let i;if(e>>>=0,s=void 0===s?this.length:s>>>0,t||(t=0),"number"==typeof t)for(i=e;i<s;++i)this[i]=t;else{const n=a.isBuffer(t)?t:a.from(t,r),o=n.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<s-e;++i)this[i+e]=n[i%o]}return this};const k={};function D(t,e,s){k[t]=class extends s{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function M(t){let e="",s=t.length;const r="-"===t[0]?1:0;for(;s>=r+4;s-=3)e=`_${t.slice(s-3,s)}${e}`;return`${t.slice(0,s)}${e}`}function H(t,e,s,r,i,n){if(t>s||t<e){const r="bigint"==typeof e?"n":"";let i;throw i=n>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(n+1)}${r}`:`>= -(2${r} ** ${8*(n+1)-1}${r}) and < 2 ** ${8*(n+1)-1}${r}`:`>= ${e}${r} and <= ${s}${r}`,new k.ERR_OUT_OF_RANGE("value",i,t)}!function(t,e,s){q(e,"offset"),void 0!==t[e]&&void 0!==t[e+s]||Y(e,t.length-(s+1))}(r,i,n)}function q(t,e){if("number"!=typeof t)throw new k.ERR_INVALID_ARG_TYPE(e,"number",t)}function Y(t,e,s){if(Math.floor(t)!==t)throw q(t,s),new k.ERR_OUT_OF_RANGE(s||"offset","an integer",t);if(e<0)throw new k.ERR_BUFFER_OUT_OF_BOUNDS;throw new k.ERR_OUT_OF_RANGE(s||"offset",`>= ${s?1:0} and <= ${e}`,t)}D("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),D("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),D("ERR_OUT_OF_RANGE",(function(t,e,s){let r=`The value of "${t}" is out of range.`,i=s;return Number.isInteger(s)&&Math.abs(s)>2**32?i=M(String(s)):"bigint"==typeof s&&(i=String(s),(s>BigInt(2)**BigInt(32)||s<-(BigInt(2)**BigInt(32)))&&(i=M(i)),i+="n"),r+=` It must be ${e}. Received ${i}`,r}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function X(t,e){let s;e=e||1/0;const r=t.length;let i=null;const n=[];for(let o=0;o<r;++o){if(s=t.charCodeAt(o),s>55295&&s<57344){if(!i){if(s>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&n.push(239,191,189);continue}i=s;continue}if(s<56320){(e-=3)>-1&&n.push(239,191,189),i=s;continue}s=65536+(i-55296<<10|s-56320)}else i&&(e-=3)>-1&&n.push(239,191,189);if(i=null,s<128){if((e-=1)<0)break;n.push(s)}else if(s<2048){if((e-=2)<0)break;n.push(s>>6|192,63&s|128)}else if(s<65536){if((e-=3)<0)break;n.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return n}function W(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,s,r){let i;for(i=0;i<r&&!(i+s>=e.length||i>=t.length);++i)e[i+s]=t[i];return i}function z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function J(t){return t!=t}const K=function(){const t="0123456789abcdef",e=new Array(256);for(let s=0;s<16;++s){const r=16*s;for(let i=0;i<16;++i)e[r+i]=t[s]+t[i]}return e}();function Z(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},645:(t,e)=>{e.read=function(t,e,s,r,i){var n,o,h=8*i-r-1,a=(1<<h)-1,l=a>>1,c=-7,u=s?i-1:0,p=s?-1:1,f=t[e+u];for(u+=p,n=f&(1<<-c)-1,f>>=-c,c+=h;c>0;n=256*n+t[e+u],u+=p,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=r;c>0;o=256*o+t[e+u],u+=p,c-=8);if(0===n)n=1-l;else{if(n===a)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),n-=l}return(f?-1:1)*o*Math.pow(2,n-r)},e.write=function(t,e,s,r,i,n){var o,h,a,l=8*n-i-1,c=(1<<l)-1,u=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:n-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-o))<1&&(o--,a*=2),(e+=o+u>=1?p/a:p*Math.pow(2,1-u))*a>=2&&(o++,a/=2),o+u>=c?(h=0,o=c):o+u>=1?(h=(e*a-1)*Math.pow(2,i),o+=u):(h=e*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;t[s+f]=255&h,f+=d,h/=256,i-=8);for(o=o<<i|h,l+=i;l>0;t[s+f]=255&o,f+=d,o/=256,l-=8);t[s+f-d]|=128*g}}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,s),n.exports}(()=>{"use strict";var t=s(764),e=function(t,e,s,r){return new(s||(s=Promise))((function(i,n){function o(t){try{a(r.next(t))}catch(t){n(t)}}function h(t){try{a(r.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,h)}a((r=r.apply(t,e||[])).next())}))};const r={MODULE_VERSION:"3.0.1",DEFAULT_ROW_ID_NAME:"row_id",DEFAULT_ROW_ID:"0",CONTEXT_NONE:0,CONTEXT_SEARCH:1,CONTEXT_LIST:2,CONTEXT_CREATE:3,CONTEXT_COPY:4,CONTEXT_UPDATE:5,CONTEXT_DELETE:6,CONTEXT_GRAPH:7,CONTEXT_CROSSTAB:8,CONTEXT_PRINTTMPL:9,CONTEXT_UPDATEALL:10,CONTEXT_REFSELECT:11,CONTEXT_DATAMAPSELECT:12,CONTEXT_PREVALIDATE:13,CONTEXT_POSTVALIDATE:14,CONTEXT_STATETRANSITION:15,CONTEXT_EXPORT:16,CONTEXT_IMPORT:17,CONTEXT_ASSOCIATE:18,CONTEXT_PANELLIST:19,CONTEXT_ACTION:20,CONTEXT_AGENDA:21,CONTEXT_PLACEMAP:22,TYPE_ID:0,TYPE_INT:1,TYPE_FLOAT:2,TYPE_STRING:3,TYPE_DATE:4,TYPE_DATETIME:5,TYPE_TIME:6,TYPE_ENUM:7,TYPE_BOOLEAN:8,TYPE_PASSWORD:9,TYPE_URL:10,TYPE_HTML:11,TYPE_EMAIL:12,TYPE_LONG_STRING:13,TYPE_ENUM_MULTI:14,TYPE_REGEXP:15,TYPE_DOC:17,TYPE_FLOAT_EMPTY:18,TYPE_EXTFILE:19,TYPE_IMAGE:20,TYPE_NOTEPAD:21,TYPE_PHONENUM:22,TYPE_COLOR:23,TYPE_OBJECT:24,TYPE_GEOCOORDS:25,VIS_NOT:0,VIS_HIDDEN:0,VIS_LIST:1,VIS_FORM:2,VIS_BOTH:3,SEARCH_NONE:0,SEARCH_MONO:1,SEARCH_MULTI_CHECK:2,SEARCH_MULTI_LIST:3,SEARCH_PERIOD:4,TRUE:"1",FALSE:"0",ERRLEVEL_FATAL:1,ERRLEVEL_ERROR:2,ERRLEVEL_WARNING:3,RESOURCE_TYPE_IMAGE:"IMG",RESOURCE_TYPE_ICON:"ICO",RESOURCE_TYPE_STYLESHEET:"CSS",RESOURCE_TYPE_JAVASCRIPT:"JS",DEFAULT_AUTH_HEADER:"authorization",SIMPLICITE_AUTH_HEADER:"x-simplicite-authorization"};class i{constructor(s){this.constants=r,this.setUsername=t=>{this.username=t},this.setPassword=t=>{this.password=t},this.setAuthToken=t=>{this.authtoken=t},this.setAuthTokenExpiryDate=t=>{this.authtokenexpiry=t},this.isAuthTokenExpired=()=>!!this.authtokenexpiry&&new Date>this.authtokenexpiry,this.setAjaxKey=t=>{this.ajaxkey=t},this.getBusinessObjectCacheKey=(t,e)=>t+":"+(e||"js_"+t),this.clear=()=>{this.username=void 0,this.password=void 0,this.authtoken=void 0,this.authtokenexpiry=void 0,this.sessionid=void 0,this.grant=void 0,this.appinfo=void 0,this.sysinfo=void 0,this.devinfo=void 0,this.businessObjectCache=new Map},this.getBasicAuthHeader=()=>this.username&&this.password?"Basic "+t.lW.from(this.username+":"+this.password).toString("base64"):void 0,this.getBearerTokenHeader=()=>this.authtoken?"Bearer "+this.authtoken:void 0,this.getError=(t,e,s)=>{if("string"==typeof t)return{message:t,status:e||200,origin:s};if(t.response){if("string"==typeof t.response)return{message:t.response,status:e||200,origin:s};if(s)try{t.response.origin=s}catch(t){}return t.response}if(s)try{t.origin=s}catch(t){}return t},this.compressData=t=>{const e=("string"==typeof t?new Blob([t],{type:"text/plian"}).stream():new Blob([JSON.stringify(t)],{type:"application/json"}).stream()).pipeThrough(new CompressionStream("gzip"));return new Response(e).blob()},this.uncompressData=t=>{const e=t.stream().pipeThrough(new DecompressionStream("gzip"));return new Response(e).text()},this.sendRequest=(t,e,s,r)=>{const i="Session.sendRequest",n=e?"POST":"GET",o={};e&&(o["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),o.accept="application/json";let h=this.getBearerTokenHeader();h?o[this.authheader]=h:(h=this.getBasicAuthHeader(),h&&(o[this.authheader]=h));let a=this.parameters.url+(t||"/");this.ajaxkey&&(a+=(a.indexOf("?")>=0?"&":"?")+"_ajaxkey="+encodeURIComponent(this.ajaxkey));const l=e?"string"==typeof e?e:JSON.stringify(e):void 0;this.debug(`[${i}] ${n} ${a}${l?" with "+l:""}`),fetch(a,{method:n,headers:o,signal:AbortSignal.timeout(this.parameters.timeout),body:l}).then((t=>{s&&t.text().then((e=>{s.call(this,e,t.status,t.headers)}))})).catch((t=>{const e=t.response&&t.response.status?t.response.status:void 0,s=t.response&&t.response.data?t.response.data:t;if(!r)throw s;r.call(this,this.getError(s,e,i))}))},this.parseResponse=(t,e)=>{try{return 200!==e?{type:"error",response:this.getError("HTTP status: "+e,e)}:"object"==typeof t?t:JSON.parse(t)}catch(t){return{type:"error",response:this.getError("Parsing error: "+t.message,e)}}},this.getHealth=t=>e(this,void 0,void 0,(function*(){const e="Session.getHealth";return t=t||{},new Promise(((s,r)=>{let i=`&full=${!!t.full}`;t.businessCase&&(i+=`&_bc=${encodeURIComponent(t.businessCase)}`),this.sendRequest(`${this.parameters.healthpath}${i}`,void 0,((i,n)=>{const o=this.parseResponse(i,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${i}`),"error"===o.type){const s=this.getError(o.response,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else s.call(this,o)}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.health=this.getHealth,this.login=t=>e(this,void 0,void 0,(function*(){const e="Session.login";return t=t||{},new Promise(((s,r)=>{(t.username||t.login)&&(t.password||t.pwd)?(this.clear(),this.username=t.username||t.login,this.password=t.password||t.pwd):(t.authtoken||t.authToken||t.token)&&(this.clear(),this.authtoken=t.authtoken||t.authToken||t.token),this.sendRequest(this.parameters.loginpath,void 0,((i,n)=>{const h=this.parseResponse(i,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${h.type||(h.error?"error":"login")}`),"error"===h.type||h.error){const s=this.getError(h.response?h.response:h,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else{this.sessionid=h.response?h.response.id:h.sessionid,this.debug(`[${e}] Session ID = ${this.sessionid}`),this.username=h.response?h.response.login:h.login,this.username&&this.debug(`[${e}] Username = ${this.username}`),this.authtoken=h.response?h.response.authtoken:h.authtoken,this.authtoken&&this.debug(`[${e}] Auth token = ${this.authtoken}`);try{const t=new Date;t.setTime(h.response?h.response.authtokenexpiry:h.authtokenexpiry),this.authtokenexpiry=t}catch(t){this.authtokenexpiry=void 0}this.authtokenexpiry&&this.debug(`[${e}] Auth token expiry date = ${this.authtokenexpiry.toLocaleDateString()} ${this.authtokenexpiry.toLocaleTimeString()}`),this.grant=new o({login:this.username,userid:h.response?h.response.userid:h.userid,firstname:h.response?h.response.firstname:h.firstname,lastname:h.response?h.response.lastname:h.lastname,email:h.response?h.response.email:h.email}),s.call(this,h.response||h)}}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.logout=t=>e(this,void 0,void 0,(function*(){const e="Session.logout";return t=t||{},new Promise(((s,r)=>{this.sendRequest(this.parameters.logoutpath,void 0,((i,n)=>{const o=this.parseResponse(i,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${o.type||(o.error?"error":"logout")}`),"error"===o.type){const s=this.getError(o.response?o.response:o,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else this.clear(),this.username=this.parameters.username,this.password=this.parameters.password,this.authtoken=this.parameters.authtoken,s.call(this,o.response||o)}),(s=>{401===(s=this.getError(s,void 0,e)).status&&(this.authtoken=void 0),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.getGrant=t=>e(this,void 0,void 0,(function*(){const e="Session.getGrant";return t=t||{},new Promise(((s,r)=>{let i="&web=true";const h=!!t.includeTexts||!!t.texts;i+=`&texts=${encodeURIComponent(h)}`;const a=!!t.inlinePicture||!!t.picture;a&&(i+="&inline_picture=true");(!!t.includeSysparams||!!t.sysparams)&&(i+="&sysparams=true"),this.sendRequest(`${this.getPath("getgrant",t)}${i}`,void 0,((i,l)=>{const c=this.parseResponse(i,l);if(this.debug(`[${e}] HTTP status = ${l}, response type = ${c.type}`),"error"===c.type){const s=this.getError(c.response,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else this.grant=new o(c.response),a&&(this.grant.picture=new n(this.grant.picture)),h&&(this.grant.texts=Object.assign(new Map,this.grant.texts)),s.call(this,this.grant)}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.changePassword=(t,s)=>e(this,void 0,void 0,(function*(){const e="Session.changePassword";return s=s||{},new Promise(((r,i)=>{this.sendRequest(`${this.getPath("setpassword",s)}&password=${encodeURIComponent(t)}`,void 0,((t,n)=>{const o=this.parseResponse(t,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${o.type}`),"error"===o.type){const t=this.getError(o.response,void 0,e);(s.error||this.error).call(this,t)||i.call(this,t)}else r.call(this,o.response)}),(t=>{t=this.getError(t,void 0,e),(s.error||this.error).call(this,t)||i.call(this,t)}))}))})),this.getAppInfo=t=>e(this,void 0,void 0,(function*(){const e="Session.getAppInfo";return t=t||{},new Promise(((s,r)=>{this.sendRequest(this.getPath("getinfo",t),void 0,((i,n)=>{const o=this.parseResponse(i,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${o.type}`),"error"===o.type){const s=this.getError(o.response,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else this.appinfo=o.response,s.call(this,this.appinfo)}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.getSysInfo=t=>e(this,void 0,void 0,(function*(){const e="Session.getSysInfo";return t=t||{},new Promise(((s,r)=>{this.sendRequest(this.getPath("sysinfo",t),void 0,((i,n)=>{const o=this.parseResponse(i,n);if(this.debug(`[${e}] HTTP status = ${n}, response type = ${o.type}`),"error"===o.type){const s=this.getError(o.response,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else this.sysinfo=o.response,s.call(this,this.sysinfo)}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.getDevInfo=(t,s)=>e(this,void 0,void 0,(function*(){const e="Session.getDevInfo";return s=s||{},new Promise(((r,i)=>{let n="";t&&(n+=`&module=${encodeURIComponent(t)}`),this.sendRequest(`${this.getPath("devinfo",s)}${n}`,void 0,((n,o)=>{const h=this.parseResponse(n,o);if(this.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=this.getError(h.response,void 0,e);(s.error||this.error).call(this,t)||i.call(this,t)}else t||(this.devinfo=h.response),r.call(this,h.response)}),(t=>{t=this.getError(t,void 0,e),(s.error||this.error).call(this,t)||i.call(this,t)}))}))})),this.getNews=t=>e(this,void 0,void 0,(function*(){const e="Session.getNews";return t=t||{},new Promise(((s,r)=>{let i="";(!!t.inlineImages||!!t.images)&&(i+="&inline_images=true"),this.sendRequest(`${this.getPath("news",t)}${i}`,void 0,((i,o)=>{const h=this.parseResponse(i,o);if(this.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const s=this.getError(h.response,void 0,e);(t.error||this.error).call(this,s)||r.call(this,s)}else{this.news=h.response;for(const t of this.news)t.image=new n(t.image);s.call(this,this.news)}}),(s=>{s=this.getError(s,void 0,e),(t.error||this.error).call(this,s)||r.call(this,s)}))}))})),this.indexSearch=(t,s,r)=>e(this,void 0,void 0,(function*(){const e="Session.indexSearch";return r=r||{},new Promise(((i,n)=>{let o=`&request=${encodeURIComponent(t||"")}`;s&&(o+=`&object=${encodeURIComponent(s)}`),!0===r.metadata&&(o+="&_md=true"),r.context&&(o+=`&context=${encodeURIComponent(r.context)}`),this.sendRequest(`${this.getPath("indexsearch",r)}${o}`,void 0,((t,s)=>{const o=this.parseResponse(t,s);if(this.debug(`[${e}] HTTP status = ${s}, response type = ${o.type}`),"error"===o.type){const t=this.getError(o.response,void 0,e);(r.error||this.error).call(this,t)||n.call(this,t)}else i.call(this,o.response)}),(t=>{t=this.getError(t,void 0,e),(r.error||this.error).call(this,t)||n.call(this,t)}))}))})),this.getBusinessObject=(t,e)=>{const s=this.getBusinessObjectCacheKey(t,e);let r=this.businessObjectCache[s];return r||(r=new a(this,t,e),this.businessObjectCache[s]=r),r},this.getExternalObject=t=>new c(this,t),this.getResourceURL=(t,e,s,r)=>this.parameters.url+this.parameters.respath+"?code="+encodeURIComponent(t)+"&type="+encodeURIComponent(e||"IMG")+(s?"&object="+encodeURIComponent(s):"")+(r?"&objid="+encodeURIComponent(r):"")+(this.authtoken?"_x_simplicite_authorization_="+encodeURIComponent(this.authtoken):""),s=s||{};const i=void 0!==globalThis.Simplicite;this.endpoint=s.endpoint||(i?globalThis.Simplicite.ENDPOINT:"api"),this.authheader=s.authheader||this.constants.DEFAULT_AUTH_HEADER,this.log=s.logHandler||((...t)=>{console.log(t)}),this.info=s.infoHandler||((...t)=>{t&&1===t.length&&"string"==typeof t[0]?console.info(`INFO - ${t[0]}`):console.info("INFO",t)}),this.warn=s.warningHandler||((...t)=>{t&&1===t.length&&"string"==typeof t[0]?console.warn(`WARN - ${t[0]}`):console.warn("WARN"+(t&&t.length>0&&t[0].message?` - ${t[0].message}`:""),t)}),this.error=s.errorHandler||((...t)=>{t&&1===t.length&&"string"==typeof t[0]?console.error(`ERROR - ${t[0]}`):console.error("ERROR"+(t&&t.length>0&&t[0].message?` - ${t[0].message}`:""),t)}),this.debugMode=!!s.debug,this.debug=s.debugHandler||((...t)=>{this.debugMode&&(t&&1===t.length&&"string"==typeof t[0]?console.info(`DEBUG - ${t[0]}`):console.log("DEBUG",t))});const h=s.url||i&&globalThis.Simplicite.URL||globalThis.window&&globalThis.window.location.origin;if(this.debug("[simplicite] URL parameter = "+h),h)try{s.scheme=h.replace(/:.*$/,"");const t=h.replace(new RegExp("^"+s.scheme+"://"),"").split(":");if(1===t.length)s.host=t[0].replace(/\/.*$/,""),s.port="http"===s.scheme?80:443,s.root=t[0].replace(new RegExp("^"+s.host+"/?"),"");else{if(s.host=t[0],s.port=parseInt(t[1].replace(/\/.*$/,""),10),isNaN(s.port))throw new Error("Incorrect port");s.root=t[1].replace(new RegExp("^"+s.port+"/?"),"")}"/"===s.root&&(s.root="")}catch(t){return void this.error("Unable to parse URL ["+h+"]: "+t.message)}const l=s.scheme||(443===s.port?"https":"http");if("http"!==l&&"https"!==l)return void this.error("Incorrect scheme ["+s.scheme+"]");const u=s.host||"localhost",p=s.port||8080;let f=s.root||"";"/"===f&&(f="");let d=l+"://"+u;("http"===l&&80!==p||"https"===l&&443!==p)&&(d+=":"+p),""!==f&&(d+=f.startsWith("/")?f:"/"+f),this.debug("[simplicite] Base URL = "+d);const g="uipublic"===this.endpoint?"":"/"+this.endpoint;if(this.parameters={scheme:l,host:u,port:p,root:f,url:d,username:s.username,password:s.password,authtoken:s.authtoken,timeout:1e3*(s.timeout||30),compress:s.compress||!0,healthpath:("/ui"===g?g:"")+"/health?format=json",loginpath:"/api"===g?"/api/login?format=json":g+"/json/app?action=session",logoutpath:"/api"===g?"/api/logout?format=json":g+"/json/app?action=logout",apppath:g+"/json/app",objpath:g+"/json/obj",extpath:g+"/ext",docpath:g+"/raw/document",respath:"/resource"},this.username=s.username||s.login,this.password=s.password||s.pwd,this.authtoken=s.authtoken||s.token,!this.authtoken&&i){const t=globalThis.window?globalThis.window.localStorage:null;this.authtoken=t?t.getItem("_authToken"):globalThis.Simplicite.AUTH_TOKEN}if(this.ajaxkey=s.ajaxkey,!this.ajaxkey&&i){const t=globalThis.window?globalThis.window.localStorage:null;this.ajaxkey=t?t.getItem("_ajaxKey"):globalThis.Simplicite.AJAX_KEY}this.businessObjectCache=new Map}getPath(t,e){const s=e&&e.businessCase?`&_bc=${encodeURIComponent(e.businessCase)}`:"";return`${this.parameters.apppath}?action=${encodeURIComponent(t)}${s}`}}class n{constructor(s){this.getId=()=>this.id,this.getMIMEType=()=>this.mime,this.getMimeType=this.getMIMEType,this.setMIMEType=t=>(this.mime=t,this),this.setMimeType=this.setMIMEType,this.getName=()=>this.name,this.getFileName=this.getName,this.getFilename=this.getName,this.setName=t=>(this.name=t,this),this.setFileName=this.setName,this.setFilename=this.setName,this.getContent=()=>this.content,this.getThumbnail=()=>this.thumbnail,this.getContentAsArrayBuffer=()=>this.getBuffer(this.content).buffer,this.getThumbnailAsArrayBuffer=()=>this.getBuffer(this.thumbnail||"").buffer,this.getContentAsText=()=>this.getBuffer(this.content).toString("utf-8"),this.setContent=t=>(this.content=this.cleanContent(t),this),this.setContentFromText=e=>(this.content=t.lW.from(e,"utf-8").toString("base64"),this),this.getDataURL=t=>{if(this.content)return"data:"+this.mime+";base64,"+(t&&this.thumbnail?this.thumbnail:this.content)},this.load=t=>e(this,void 0,void 0,(function*(){return new Promise(((e,s)=>{try{if(t){this.name=t.name,this.mime=t.type;const s=new FileReader;s.onload=()=>{this.content=s.result?this.cleanContent(s.result):"",e(this)},s.readAsDataURL(t)}else this.content="",e(this)}catch(t){s(t)}}))})),this.getValue=()=>({id:this.id,name:this.filename&&!this.name?this.filename:this.name,mime:this.mime,content:this.content,thumbnail:this.thumbnail}),Object.assign(this,"string"==typeof s?{name:s}:s||{}),this.filename&&!this.name&&(this.name=this.filename,this.filename=void 0)}cleanContent(t){return t.startsWith("data:")?t.replace(/data:.*;base64,/,""):t}getBuffer(e){return t.lW.from(e,"base64")}}class o{constructor(t){this.getUserId=()=>this.userid,this.getUsername=()=>this.login,this.getLogin=this.getUsername,this.getLang=()=>this.lang,this.getEmail=()=>this.email,this.getFirstname=()=>this.firstname,this.getFirstName=this.getFirstname,this.getLastname=()=>this.lastname,this.getLastName=this.getLastname,this.getPictureURL=()=>{if(this.picture)return"data:"+this.picture.mime+";base64,"+this.picture.content},this.hasResponsibility=t=>this.responsibilities&&-1!==this.responsibilities.indexOf(t),this.getSystemParameter=t=>this.sysparams&&this.sysparams[t]||"",this.getSysParam=this.getSystemParameter,this.T=t=>this.texts&&this.texts[t]||"",Object.assign(this,t)}}class h{constructor(t,e){this.name=t,this.instance=e,this.rowidfield=r.DEFAULT_ROW_ID_NAME,this.label=t,this.help="",this.fields=new Array}}class a{constructor(t,s,i){this.getMetaData=t=>e(this,void 0,void 0,(function*(){const e="BusinessObject.getMetaData",s=this.session;return t=t||{},new Promise(((r,i)=>{let n="";t.context&&(n+="&context="+encodeURIComponent(t.context)),t.contextParam&&(n+="&contextparam="+encodeURIComponent(t.contextParam)),s.sendRequest(this.path+"&action=metadata"+n,void 0,((n,o)=>{const h=s.parseResponse(n,o);if(s.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const r=s.getError(h.response,void 0,e);(t.error||s.error).call(this,r)||i.call(this,r)}else this.metadata=h.response,r.call(this,this.metadata)}),(r=>{r=s.getError(r,void 0,e),(t.error||s.error).call(this,r)||i.call(this,r)}))}))})),this.getMetadata=this.getMetaData,this.getName=()=>this.metadata.name,this.getInstance=()=>this.metadata.instance,this.getLabel=()=>this.metadata.label,this.getHelp=()=>this.metadata.help,this.getFields=()=>this.metadata.fields,this.getField=t=>{const e=this.getFields();let s=0;for(;s<e.length&&e[s].name!==t;)s++;if(s<e.length)return e[s]},this.getRowIdFieldName=()=>this.metadata.rowidfield,this.getRowIdField=()=>this.getField(this.getRowIdFieldName()),this.getLinks=()=>this.metadata.links,this.getFieldType=t=>{if("string"==typeof t&&(t=this.getField(t)),t)return t.type},this.getFieldLabel=t=>{if("string"==typeof t&&(t=this.getField(t)),t)return t.label},this.getFieldValue=(t,e)=>{if(e||(e=this.item),t&&e){const s=e["string"==typeof t?t:t.name];return s&&s.mime?new n(s):s}},this.getFieldListValue=(t,e)=>{"string"==typeof t&&(t=this.getField(t));const s=this.getFieldValue(t,e);return t&&t.listOfValues?this.getListValue(t.listOfValues,s):s},this.getFieldListColors=(t,e)=>{"string"==typeof t&&(t=this.getField(t));const s=this.getFieldValue(t,e);return t&&t.listOfValues?this.getListColors(t.listOfValues,s):s},this.getFieldDataURL=(t,e)=>{"string"!=typeof t&&(t=t.fullinput||t.name);const s=this.getFieldValue(t,e);if(s&&s.mime)return"data:"+s.mime+";base64,"+(s.content||s.thumbnail)},this.getFieldDocument=(t,e)=>{"string"!=typeof t&&(t=t.fullinput||t.input||t.name);const s=this.getFieldValue(t,e);return s&&s.mime?new n(s):s},this.getFieldDocumentURL=(t,e,s)=>{"string"!=typeof t&&(t=t.fullinput||t.input||t.name);let r=this.getFieldValue(t,e);if(r&&r.mime&&(r=r.id),r)return this.session.parameters.url+this.session.parameters.docpath+"?object="+encodeURIComponent(this.metadata.name)+"&inst="+encodeURIComponent(this.metadata.instance)+"&field="+encodeURIComponent(t)+"&row_id="+encodeURIComponent(this.getRowId(e))+"&doc_id="+encodeURIComponent(r)+(s?"&thumbnail=true":"")+(this.session.authtoken?"&_x_simplicite_authorization_="+encodeURIComponent(this.session.authtoken):"")},this.getListValue=(t,e)=>{if(t)for(const s of t)if(s.code===e)return s.value;return e},this.getListColors=(t,e)=>{if(t)for(const s of t)if(s.code===e)return{color:s.color,bgcolor:s.bgcolor};return{color:"inherit",bgcolor:"inherit"}},this.setFieldValue=(t,e,s)=>{s||(s=this.item),t&&s&&(s["string"==typeof t?t:t.name]=e instanceof n?e.getValue():e)},this.isRowIdField=t=>!t.ref&&t.name===this.metadata.rowidfield,this.isTimestampField=t=>{const e=t.name;return!t.ref&&("created_by"===e||"created_dt"===e||"updated_by"===e||"updated_dt"===e)},this.getFilters=t=>e(this,void 0,void 0,(function*(){const e="BusinessObject.getFilters",s=this.session;return t=t||{},new Promise(((r,i)=>{let n="";t.context&&(n+="&context="+encodeURIComponent(t.context)),t.reset&&(n+="&reset="+!!t.reset),s.sendRequest(this.path+"&action=filters"+n,void 0,((n,o)=>{const h=s.parseResponse(n,o);if(s.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const r=s.getError(h.response,void 0,e);(t.error||s.error).call(this,r)||i.call(this,r)}else this.filters=h.response,r.call(this,this.filters)}),(r=>{r=s.getError(r,void 0,e),(t.error||s.error).call(this,r)||i.call(this,r)}))}))})),this.getReqOptions=t=>{let e="";t.context&&(e+=`&context=${encodeURIComponent(t.context)}`);const s=t.inlineDocs||t.inlineDocuments||t.inlineImages;s&&(e+=`&inline_documents=${encodeURIComponent(s.join?s.join(","):s)}`);const r=t.inlineThumbs||t.inlineThumbnails;r&&(e+=`&inline_thumbnails=${encodeURIComponent(r.join?r.join(","):r)}`);const i=t.inlineObjs||t.inlineObjects;return i&&(e+=`&inline_objects=${encodeURIComponent(i.join?i.join(","):i)}`),e},this.convertFilterWildCards=t=>"string"==typeof t?t.replace(new RegExp("\\*","g"),"%").replace(new RegExp("\\?","g"),"_"):t,this.getReqParams=(t,e)=>{let s="";if(!t)return s;for(const r of Object.entries(t)){const t=r[0];let i=r[1]||"";if(i instanceof n&&(i=i.getValue()),i.name&&i.content)i.content.startsWith("data:")&&(i.content=i.content.replace(/data:.*;base64,/,"")),s+=(""!==s?"&":"")+t+"="+encodeURIComponent("id|"+(i.id?i.id:"0")+"|name|"+i.name+"|content|"+i.content);else if(i.object&&i.row_id)s+=(""!==s?"&":"")+t+"="+encodeURIComponent("object|"+i.object+"|row_id|"+i.row_id);else if(i.sort)for(const r of i)s+=(""!==s?"&":"")+t+"="+encodeURIComponent(e?this.convertFilterWildCards(r):r);else s+=(""!==s?"&":"")+t+"="+encodeURIComponent(e?this.convertFilterWildCards(i):i)}return s},this.getCount=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.getCount",r=this.session;return s=s||{},new Promise(((i,n)=>{this.filters=t||{},r.sendRequest(this.getPath("count",s),this.getReqParams(this.filters,!0),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug("["+e+"] HTTP status = "+o+", response type = "+h.type),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else this.count=h.response.count,this.page=h.response.page>=0?h.response.page+1:void 0,this.maxpage=h.response.maxpage>=0?h.response.maxpage+1:void 0,this.list=[],i.call(this,this.count)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.search=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.search",r=this.session;return s=s||{},new Promise(((i,n)=>{let o=this.getReqOptions(s);s.page>0&&(o+="&page="+(s.page-1)),!0===s.metadata&&(o+="&_md=true"),!0===s.visible&&(o+="&_visible=true"),this.filters=t||{},r.sendRequest(`${this.getPath("search",s)}${o}`,this.getReqParams(this.filters,!0),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else t.meta&&(this.metadata=h.response.meta),this.count=h.response.count,this.page=h.response.page>=0?h.response.page+1:void 0,this.maxpage=h.response.maxpage>=0?h.response.maxpage+1:void 0,this.list=h.response.list,i.call(this,this.list)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.get=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.get",r=this.session;return s=s||{},new Promise(((i,n)=>{let o=this.getReqOptions(s);const h=s.treeView;if(h&&(o+=`&treeview=${encodeURIComponent(h)}`),s.fields)for(const t of s.fields.length)o+=`&fields=${encodeURIComponent(t.replace(".","__"))}`;s.metadata&&(o+="&_md=true"),s.social&&(o+="&_social=true"),r.sendRequest(`${this.getPath("get",s)}&${this.metadata.rowidfield}=${encodeURIComponent(t||this.getRowId())}${o}`,void 0,((t,o)=>{const a=r.parseResponse(t,o);if(r.debug("[simplicite.BusinessObject.get] HTTP status = "+o+", response type = "+a.type),"error"===a.type){const t=r.getError(a.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else a.response.meta&&(this.metadata=a.response.meta),a.response.data?this.item=h?a.response.data.item:a.response.data:this.item=h?a.response.item:a.response,i.call(this,h?a.response:this.item)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.getForCreate=t=>e(this,void 0,void 0,(function*(){return delete(t=t||{}).treeview,delete t.fields,t.context=r.CONTEXT_CREATE,this.get(r.DEFAULT_ROW_ID,t)})),this.getForUpdate=(t,s)=>e(this,void 0,void 0,(function*(){return delete(s=s||{}).treeview,delete s.fields,s.context=r.CONTEXT_UPDATE,this.get(t||this.getRowId(),s)})),this.getForCopy=(t,s)=>e(this,void 0,void 0,(function*(){return delete(s=s||{}).treeview,delete s.fields,s.context=r.CONTEXT_COPY,this.get(t||this.getRowId(),s)})),this.getForDelete=(t,s)=>e(this,void 0,void 0,(function*(){return delete(s=s||{}).treeview,delete s.fields,s.context=r.CONTEXT_DELETE,this.get(t||this.getRowId(),s)})),this.getRowId=t=>{if(t=t||this.item)return t[this.getRowIdFieldName()]},this.populate=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.populate",r=this.session;return s=s||{},new Promise(((i,n)=>{t&&(this.item=t),r.sendRequest(`${this.getPath("populate",s)}${this.getReqOptions(s)}`,this.getReqParams(this.item),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else this.item=h.response.data?h.response.data:h.response,i.call(this,this.item)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.getFieldLinkedList=(t,s,r,i)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.getFieldLinkedList",n=this.session;return i=i||{},new Promise(((o,h)=>{"string"!=typeof t&&(t=t.fullinput||t.name),"string"!=typeof s&&(s=s.fullinput||s.name);let a=!1;!0===r?(a=!0,r=void 0):void 0===r&&(r=this.getFieldValue(t)),n.sendRequest(this.getPath("getlinkedlist",i),this.getReqParams({origin:t,input:s,code:r,all:a}),((t,s)=>{const r=n.parseResponse(t,s);if(n.debug("["+e+"] HTTP status = "+s+", response type = "+r.type),"error"===r.type){const t=n.getError(r.response,void 0,e);(i.error||n.error).call(this,t)||h.call(this,t)}else this.item=r.response.result?r.response.result:r.response,o.call(this,this.item)}),(t=>{t=n.getError(t,void 0,e),(i.error||n.error).call(this,t)||h.call(this,t)}))}))})),this.save=(t,s)=>e(this,void 0,void 0,(function*(){t&&(this.item=t);const e=this.item[this.metadata.rowidfield];return e&&e!==r.DEFAULT_ROW_ID?this.update(t,s):this.create(t,s)})),this.create=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.create",i=this.session;return s=s||{},new Promise(((n,o)=>{t&&(this.item=t),this.item.row_id=r.DEFAULT_ROW_ID,i.sendRequest(`${this.getPath("create",s)}${this.getReqOptions(s)}`,this.getReqParams(this.item),((t,r)=>{const h=i.parseResponse(t,r);if(i.debug("["+e+"] HTTP status = "+r+", response type = "+h.type),"error"===h.type){const t=i.getError(h.response,void 0,e);(s.error||i.error).call(this,t)||o.call(this,t)}else this.item=h.response.data?h.response.data:h.response,n.call(this,this.item)}),(t=>{t=i.getError(t,void 0,e),(s.error||i.error).call(this,t)||o.call(this,t)}))}))})),this.update=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.update",r=this.session;return s=s||{},new Promise(((i,n)=>{t&&(this.item=t),r.sendRequest(`${this.getPath("update",s)}${this.getReqOptions(s)}`,this.getReqParams(this.item),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else this.item=h.response.data?h.response.data:h.response,i.call(this,this.item)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.del=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.del",r=this.session;return s=s||{},new Promise(((i,n)=>{t&&(this.item=t),r.sendRequest(`${this.getPath("delete",s)}&${this.metadata.rowidfield}=${encodeURIComponent(this.item[this.metadata.rowidfield])}`,void 0,((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else this.item=void 0,delete h.response.undoredo,i.call(this,h.response)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.action=(t,s,r)=>e(this,void 0,void 0,(function*(){const e=`BusinessObject.action(${t})`,i=this.session;return r=r||{},new Promise(((n,o)=>{const h=s?`&${this.getRowIdFieldName()}=${encodeURIComponent(s)}`:"";i.sendRequest(`${this.getPath(t,r)}${h}`,this.getReqParams(r.parameters),((t,s)=>{const h=i.parseResponse(t,s);if(i.debug("["+e+"] HTTP status = "+s+", response type = "+h.type),"error"===h.type){const t=i.getError(h.response,void 0,e);(r.error||i.error).call(this,t)||o.call(this,t)}else{const t=h.response.result;n.call(this,t)}}),(t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)}))}))})),this.crosstab=(t,s)=>e(this,void 0,void 0,(function*(){const e=`BusinessObject.crosstab(${t})`,r=this.session;return s=s||{},new Promise(((i,n)=>{s.filters&&(this.filters=s.filters),r.sendRequest(`${this.getPath(s.cubes?"crosstabcubes":"crosstab",s)}&crosstab=${encodeURIComponent(t)}`,this.getReqParams(s.filters||this.filters,!0),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else i.call(this,h.response)}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.print=(t,s,r)=>e(this,void 0,void 0,(function*(){const e=`BusinessObject.print(${t})`,i=this.session;return r=r||{},new Promise(((o,h)=>{r.filters&&(this.filters=r.filters);let a="";r.all&&(a+="&all="+!!r.all),r.mailing&&(a+="&mailing="+!!r.mailing),s&&(a+=`&${this.getRowIdFieldName()}=${encodeURIComponent(s)}`),i.sendRequest(`${this.getPath("print",r)}&printtemplate=${encodeURIComponent(t)}${a}`,void 0,((t,s)=>{const a=i.parseResponse(t,s);if(i.debug("["+e+"] HTTP status = "+s+", response type = "+a.type),"error"===a.type){const t=i.getError(a.response,void 0,e);(r.error||i.error).call(this,t)||h.call(this,t)}else o.call(this,new n(a.response))}),(t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||h.call(this,t)}))}))})),this.placemap=(t,s,r)=>e(this,void 0,void 0,(function*(){const e=`BusinessObject.placemap(${t})`,i=this.session;return this.filters=s||{},r=r||{},new Promise(((s,n)=>{r.filters&&(this.filters=r.filters),i.sendRequest(`${this.getPath("placemap",r)}&placemap=${encodeURIComponent(t)}`,this.getReqParams(this.filters,!0),((t,o)=>{const h=i.parseResponse(t,o);if(i.debug("["+e+"] HTTP status = "+o+", response type = "+h.type),"error"===h.type){const t=i.getError(h.response,void 0,e);(r.error||i.error).call(this,t)||n.call(this,t)}else s.call(this,h.response)}),(t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||n.call(this,t)}))}))})),this.setParameter=(t,s,r)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.setParameter",i=this.session;return r=r||{},new Promise(((n,o)=>{const h={name:t};s&&(h.value=s),i.sendRequest(this.getPath("setparameter",r),this.getReqParams(h),((t,s)=>{const h=i.parseResponse(t,s);if(i.debug(`[${e}] HTTP status = ${s}, response type = ${h.type}`),"error"===h.type){const t=i.getError(h.response,void 0,e);(r.error||i.error).call(this,t)||o.call(this,t)}else{const t=h.response.result;n.call(this,t)}}),(t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)}))}))})),this.getParameter=(t,s)=>e(this,void 0,void 0,(function*(){const e="BusinessObject.getParameter",r=this.session;return s=s||{},new Promise(((i,n)=>{const o={name:t};r.sendRequest(this.getPath("getparameter",s),this.getReqParams(o),((t,o)=>{const h=r.parseResponse(t,o);if(r.debug(`[${e}] HTTP status = ${o}, response type = ${h.type}`),"error"===h.type){const t=r.getError(h.response,void 0,e);(s.error||r.error).call(this,t)||n.call(this,t)}else{const t=h.response.result;i.call(this,t)}}),(t=>{t=r.getError(t,void 0,e),(s.error||r.error).call(this,t)||n.call(this,t)}))}))})),this.getResourceURL=(t,e)=>this.session.getResourceURL(t,e,this.metadata.name,this.metadata.id),this.session=t;const o=i||"api_"+s;this.metadata=new h(s,o),this.cacheKey=this.session.getBusinessObjectCacheKey(s,o),this.path=this.session.parameters.objpath+"?object="+encodeURIComponent(s)+"&inst="+encodeURIComponent(o),this.item={},this.filters={},this.list=[]}getPath(t,e){const s=e&&e.businessCase?`&_bc=${encodeURIComponent(e.businessCase)}`:"";return`${this.path}&action=${encodeURIComponent(t)}${s}`}}class l{constructor(t){this.name=t}}class c{constructor(t,s){this.getName=()=>this.metadata.name,this.callParams=t=>{let e="";if(!t)return e;for(const s of Object.entries(t)){const t=s[0],r=s[1]||"";if(r.sort)for(const s of r)e+=(""!==e?"&":"")+t+"="+encodeURIComponent(s);else e+=(""!==e?"&":"")+t+"="+encodeURIComponent(r)}return e},this.call=(t,s,r)=>e(this,void 0,void 0,(function*(){const e="ExternalObject.call",i=this.session;return r=r||{},new Promise(((n,o)=>{let h="";t&&(h=this.callParams(t)),r.businessCase&&(h+=`_bc=${encodeURIComponent(r.businessCase)}`);const a=r.method?r.method.toUpperCase():s?"POST":"GET",l={};r.contentType?l["content-type"]=r.contentType:!s||s instanceof FormData||(l["content-type"]="string"==typeof s?"application/x-www-form-urlencoded":"application/json"),r.accept&&(l.accept="json"===r.accept?"application/json":r.accept);let c=i.getBearerTokenHeader();c?l[i.authheader]=c:(c=i.getBasicAuthHeader(),c&&(l[i.authheader]=c));const u=i.parameters.url+(r.path&&r.path.startsWith("/")?r.path:this.path+(r.path?"/"+r.path:""))+(""!==h?"?"+h:""),p=s?"string"==typeof s||s instanceof FormData?s:JSON.stringify(s):void 0;i.debug("[simplicite.ExternalObject.call] "+a+" "+u+(p?" with "+p:"")),fetch(u,{method:a,headers:l,signal:AbortSignal.timeout(i.parameters.timeout),body:p}).then((t=>{const s=t.headers.get("content-type");i.debug(`[${e}] HTTP status = ${t.status}, response content type = ${s}`),s&&s.startsWith("application/json")?t.json().then((e=>{n.call(this,e,t.status,t.headers)})).catch((t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)})):s&&(s.startsWith("text/")||s.startsWith("application/yaml"))?t.text().then((e=>{n.call(this,e,t.status,t.headers)})).catch((t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)})):t.arrayBuffer().then((e=>{n.call(this,e,t.status,t.headers)})).catch((t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)}))})).catch((t=>{t=i.getError(t,void 0,e),(r.error||i.error).call(this,t)||o.call(this,t)}))}))})),this.invoke=this.call,this.session=t,this.metadata=new l(s),this.path=`${this.session.parameters.extpath}/${encodeURIComponent(s)}`}}const u={constants:r,session:t=>new i(t),Session:i,Doc:n,Grant:o,BusinessObject:a,BusinessObjectMetadata:h,ExternalObject:c};if("undefined"!=typeof globalThis)globalThis.simplicite=u;else if("undefined"!=typeof self)self.simplicite=u;else if("undefined"!=typeof window)window.simplicite=u;else{if("undefined"==typeof global)throw new Error("Unable to find global object");global.simplicite=u}})()})();
//# sourceMappingURL=simplicite.min.js.map