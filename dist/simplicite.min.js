(()=>{var $e=Object.create;var ue=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var z=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var De=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of Se(e))!Le.call(n,h)&&h!==t&&ue(n,h,{get:()=>e[h],enumerable:!(s=Oe(e,h))||s.enumerable});return n};var ke=(n,e,t)=>(t=n!=null?$e(Ne(n)):{},De(e||!n||!n.__esModule?ue(t,"default",{value:n,enumerable:!0}):t,n));var fe=z(W=>{"use strict";W.byteLength=qe;W.toByteArray=Ve;W.fromByteArray=Ge;var U=[],C=[],je=typeof Uint8Array<"u"?Uint8Array:Array,Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(S=0,ce=Z.length;S<ce;++S)U[S]=Z[S],C[Z.charCodeAt(S)]=S;var S,ce;C[45]=62;C[95]=63;function le(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var s=t===e?0:4-t%4;return[t,s]}function qe(n){var e=le(n),t=e[0],s=e[1];return(t+s)*3/4-s}function Ye(n,e,t){return(e+t)*3/4-t}function Ve(n){var e,t=le(n),s=t[0],h=t[1],i=new je(Ye(n,s,h)),r=0,a=h>0?s-4:s,c;for(c=0;c<a;c+=4)e=C[n.charCodeAt(c)]<<18|C[n.charCodeAt(c+1)]<<12|C[n.charCodeAt(c+2)]<<6|C[n.charCodeAt(c+3)],i[r++]=e>>16&255,i[r++]=e>>8&255,i[r++]=e&255;return h===2&&(e=C[n.charCodeAt(c)]<<2|C[n.charCodeAt(c+1)]>>4,i[r++]=e&255),h===1&&(e=C[n.charCodeAt(c)]<<10|C[n.charCodeAt(c+1)]<<4|C[n.charCodeAt(c+2)]>>2,i[r++]=e>>8&255,i[r++]=e&255),i}function Xe(n){return U[n>>18&63]+U[n>>12&63]+U[n>>6&63]+U[n&63]}function ve(n,e,t){for(var s,h=[],i=e;i<t;i+=3)s=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),h.push(Xe(s));return h.join("")}function Ge(n){for(var e,t=n.length,s=t%3,h=[],i=16383,r=0,a=t-s;r<a;r+=i)h.push(ve(n,r,r+i>a?a:r+i));return s===1?(e=n[t-1],h.push(U[e>>2]+U[e<<4&63]+"==")):s===2&&(e=(n[t-2]<<8)+n[t-1],h.push(U[e>>10]+U[e>>4&63]+U[e<<2&63]+"=")),h.join("")}});var pe=z(Q=>{Q.read=function(n,e,t,s,h){var i,r,a=h*8-s-1,c=(1<<a)-1,f=c>>1,o=-7,u=t?h-1:0,p=t?-1:1,l=n[e+u];for(u+=p,i=l&(1<<-o)-1,l>>=-o,o+=a;o>0;i=i*256+n[e+u],u+=p,o-=8);for(r=i&(1<<-o)-1,i>>=-o,o+=s;o>0;r=r*256+n[e+u],u+=p,o-=8);if(i===0)i=1-f;else{if(i===c)return r?NaN:(l?-1:1)*(1/0);r=r+Math.pow(2,s),i=i-f}return(l?-1:1)*r*Math.pow(2,i-s)};Q.write=function(n,e,t,s,h,i){var r,a,c,f=i*8-h-1,o=(1<<f)-1,u=o>>1,p=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=s?0:i-1,d=s?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,r=o):(r=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-r))<1&&(r--,c*=2),r+u>=1?e+=p/c:e+=p*Math.pow(2,1-u),e*c>=2&&(r++,c/=2),r+u>=o?(a=0,r=o):r+u>=1?(a=(e*c-1)*Math.pow(2,h),r=r+u):(a=e*Math.pow(2,u-1)*Math.pow(2,h),r=0));h>=8;n[t+l]=a&255,l+=d,a/=256,h-=8);for(r=r<<h|a,f+=h;f>0;n[t+l]=r&255,l+=d,r/=256,f-=8);n[t+l-d]|=y*128}});var Ae=z(V=>{"use strict";var ee=fe(),q=pe(),de=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;V.Buffer=g;V.SlowBuffer=Qe;V.INSPECT_MAX_BYTES=50;var K=2147483647;V.kMaxLength=K;g.TYPED_ARRAY_SUPPORT=We();!g.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function We(){try{let n=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(n,e),n.foo()===42}catch{return!1}}Object.defineProperty(g.prototype,"parent",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.buffer}});Object.defineProperty(g.prototype,"offset",{enumerable:!0,get:function(){if(g.isBuffer(this))return this.byteOffset}});function P(n){if(n>K)throw new RangeError('The value "'+n+'" is invalid for option "size"');let e=new Uint8Array(n);return Object.setPrototypeOf(e,g.prototype),e}function g(n,e,t){if(typeof n=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return re(n)}return Ee(n,e,t)}g.poolSize=8192;function Ee(n,e,t){if(typeof n=="string")return Je(n,e);if(ArrayBuffer.isView(n))return ze(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(F(n,ArrayBuffer)||n&&F(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(F(n,SharedArrayBuffer)||n&&F(n.buffer,SharedArrayBuffer)))return ie(n,e,t);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let s=n.valueOf&&n.valueOf();if(s!=null&&s!==n)return g.from(s,e,t);let h=Ze(n);if(h)return h;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return g.from(n[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}g.from=function(n,e,t){return Ee(n,e,t)};Object.setPrototypeOf(g.prototype,Uint8Array.prototype);Object.setPrototypeOf(g,Uint8Array);function we(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function Ke(n,e,t){return we(n),n<=0?P(n):e!==void 0?typeof t=="string"?P(n).fill(e,t):P(n).fill(e):P(n)}g.alloc=function(n,e,t){return Ke(n,e,t)};function re(n){return we(n),P(n<0?0:se(n)|0)}g.allocUnsafe=function(n){return re(n)};g.allocUnsafeSlow=function(n){return re(n)};function Je(n,e){if((typeof e!="string"||e==="")&&(e="utf8"),!g.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=xe(n,e)|0,s=P(t),h=s.write(n,e);return h!==t&&(s=s.slice(0,h)),s}function te(n){let e=n.length<0?0:se(n.length)|0,t=P(e);for(let s=0;s<e;s+=1)t[s]=n[s]&255;return t}function ze(n){if(F(n,Uint8Array)){let e=new Uint8Array(n);return ie(e.buffer,e.byteOffset,e.byteLength)}return te(n)}function ie(n,e,t){if(e<0||n.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let s;return e===void 0&&t===void 0?s=new Uint8Array(n):t===void 0?s=new Uint8Array(n,e):s=new Uint8Array(n,e,t),Object.setPrototypeOf(s,g.prototype),s}function Ze(n){if(g.isBuffer(n)){let e=se(n.length)|0,t=P(e);return t.length===0||n.copy(t,0,0,e),t}if(n.length!==void 0)return typeof n.length!="number"||he(n.length)?P(0):te(n);if(n.type==="Buffer"&&Array.isArray(n.data))return te(n.data)}function se(n){if(n>=K)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K.toString(16)+" bytes");return n|0}function Qe(n){return+n!=n&&(n=0),g.alloc(+n)}g.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==g.prototype};g.compare=function(e,t){if(F(e,Uint8Array)&&(e=g.from(e,e.offset,e.byteLength)),F(t,Uint8Array)&&(t=g.from(t,t.offset,t.byteLength)),!g.isBuffer(e)||!g.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let s=e.length,h=t.length;for(let i=0,r=Math.min(s,h);i<r;++i)if(e[i]!==t[i]){s=e[i],h=t[i];break}return s<h?-1:h<s?1:0};g.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};g.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return g.alloc(0);let s;if(t===void 0)for(t=0,s=0;s<e.length;++s)t+=e[s].length;let h=g.allocUnsafe(t),i=0;for(s=0;s<e.length;++s){let r=e[s];if(F(r,Uint8Array))i+r.length>h.length?(g.isBuffer(r)||(r=g.from(r)),r.copy(h,i)):Uint8Array.prototype.set.call(h,r,i);else if(g.isBuffer(r))r.copy(h,i);else throw new TypeError('"list" argument must be an Array of Buffers');i+=r.length}return h};function xe(n,e){if(g.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||F(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);let t=n.length,s=arguments.length>2&&arguments[2]===!0;if(!s&&t===0)return 0;let h=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return ne(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return Fe(n).length;default:if(h)return s?-1:ne(n).length;e=(""+e).toLowerCase(),h=!0}}g.byteLength=xe;function et(n,e,t){let s=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(n||(n="utf8");;)switch(n){case"hex":return ct(this,e,t);case"utf8":case"utf-8":return Re(this,e,t);case"ascii":return at(this,e,t);case"latin1":case"binary":return ut(this,e,t);case"base64":return ot(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return lt(this,e,t);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),s=!0}}g.prototype._isBuffer=!0;function N(n,e,t){let s=n[e];n[e]=n[t],n[t]=s}g.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)N(this,t,t+1);return this};g.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)N(this,t,t+3),N(this,t+1,t+2);return this};g.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)N(this,t,t+7),N(this,t+1,t+6),N(this,t+2,t+5),N(this,t+3,t+4);return this};g.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?Re(this,0,e):et.apply(this,arguments)};g.prototype.toLocaleString=g.prototype.toString;g.prototype.equals=function(e){if(!g.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:g.compare(this,e)===0};g.prototype.inspect=function(){let e="",t=V.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};de&&(g.prototype[de]=g.prototype.inspect);g.prototype.compare=function(e,t,s,h,i){if(F(e,Uint8Array)&&(e=g.from(e,e.offset,e.byteLength)),!g.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),s===void 0&&(s=e?e.length:0),h===void 0&&(h=0),i===void 0&&(i=this.length),t<0||s>e.length||h<0||i>this.length)throw new RangeError("out of range index");if(h>=i&&t>=s)return 0;if(h>=i)return-1;if(t>=s)return 1;if(t>>>=0,s>>>=0,h>>>=0,i>>>=0,this===e)return 0;let r=i-h,a=s-t,c=Math.min(r,a),f=this.slice(h,i),o=e.slice(t,s);for(let u=0;u<c;++u)if(f[u]!==o[u]){r=f[u],a=o[u];break}return r<a?-1:a<r?1:0};function Te(n,e,t,s,h){if(n.length===0)return-1;if(typeof t=="string"?(s=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,he(t)&&(t=h?0:n.length-1),t<0&&(t=n.length+t),t>=n.length){if(h)return-1;t=n.length-1}else if(t<0)if(h)t=0;else return-1;if(typeof e=="string"&&(e=g.from(e,s)),g.isBuffer(e))return e.length===0?-1:ge(n,e,t,s,h);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(n,e,t):Uint8Array.prototype.lastIndexOf.call(n,e,t):ge(n,[e],t,s,h);throw new TypeError("val must be string, number or Buffer")}function ge(n,e,t,s,h){let i=1,r=n.length,a=e.length;if(s!==void 0&&(s=String(s).toLowerCase(),s==="ucs2"||s==="ucs-2"||s==="utf16le"||s==="utf-16le")){if(n.length<2||e.length<2)return-1;i=2,r/=2,a/=2,t/=2}function c(o,u){return i===1?o[u]:o.readUInt16BE(u*i)}let f;if(h){let o=-1;for(f=t;f<r;f++)if(c(n,f)===c(e,o===-1?0:f-o)){if(o===-1&&(o=f),f-o+1===a)return o*i}else o!==-1&&(f-=f-o),o=-1}else for(t+a>r&&(t=r-a),f=t;f>=0;f--){let o=!0;for(let u=0;u<a;u++)if(c(n,f+u)!==c(e,u)){o=!1;break}if(o)return f}return-1}g.prototype.includes=function(e,t,s){return this.indexOf(e,t,s)!==-1};g.prototype.indexOf=function(e,t,s){return Te(this,e,t,s,!0)};g.prototype.lastIndexOf=function(e,t,s){return Te(this,e,t,s,!1)};function tt(n,e,t,s){t=Number(t)||0;let h=n.length-t;s?(s=Number(s),s>h&&(s=h)):s=h;let i=e.length;s>i/2&&(s=i/2);let r;for(r=0;r<s;++r){let a=parseInt(e.substr(r*2,2),16);if(he(a))return r;n[t+r]=a}return r}function it(n,e,t,s){return J(ne(e,n.length-t),n,t,s)}function nt(n,e,t,s){return J(gt(e),n,t,s)}function rt(n,e,t,s){return J(Fe(e),n,t,s)}function st(n,e,t,s){return J(mt(e,n.length-t),n,t,s)}g.prototype.write=function(e,t,s,h){if(t===void 0)h="utf8",s=this.length,t=0;else if(s===void 0&&typeof t=="string")h=t,s=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(s)?(s=s>>>0,h===void 0&&(h="utf8")):(h=s,s=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let i=this.length-t;if((s===void 0||s>i)&&(s=i),e.length>0&&(s<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");h||(h="utf8");let r=!1;for(;;)switch(h){case"hex":return tt(this,e,t,s);case"utf8":case"utf-8":return it(this,e,t,s);case"ascii":case"latin1":case"binary":return nt(this,e,t,s);case"base64":return rt(this,e,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,e,t,s);default:if(r)throw new TypeError("Unknown encoding: "+h);h=(""+h).toLowerCase(),r=!0}};g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ot(n,e,t){return e===0&&t===n.length?ee.fromByteArray(n):ee.fromByteArray(n.slice(e,t))}function Re(n,e,t){t=Math.min(n.length,t);let s=[],h=e;for(;h<t;){let i=n[h],r=null,a=i>239?4:i>223?3:i>191?2:1;if(h+a<=t){let c,f,o,u;switch(a){case 1:i<128&&(r=i);break;case 2:c=n[h+1],(c&192)===128&&(u=(i&31)<<6|c&63,u>127&&(r=u));break;case 3:c=n[h+1],f=n[h+2],(c&192)===128&&(f&192)===128&&(u=(i&15)<<12|(c&63)<<6|f&63,u>2047&&(u<55296||u>57343)&&(r=u));break;case 4:c=n[h+1],f=n[h+2],o=n[h+3],(c&192)===128&&(f&192)===128&&(o&192)===128&&(u=(i&15)<<18|(c&63)<<12|(f&63)<<6|o&63,u>65535&&u<1114112&&(r=u))}}r===null?(r=65533,a=1):r>65535&&(r-=65536,s.push(r>>>10&1023|55296),r=56320|r&1023),s.push(r),h+=a}return ht(s)}var me=4096;function ht(n){let e=n.length;if(e<=me)return String.fromCharCode.apply(String,n);let t="",s=0;for(;s<e;)t+=String.fromCharCode.apply(String,n.slice(s,s+=me));return t}function at(n,e,t){let s="";t=Math.min(n.length,t);for(let h=e;h<t;++h)s+=String.fromCharCode(n[h]&127);return s}function ut(n,e,t){let s="";t=Math.min(n.length,t);for(let h=e;h<t;++h)s+=String.fromCharCode(n[h]);return s}function ct(n,e,t){let s=n.length;(!e||e<0)&&(e=0),(!t||t<0||t>s)&&(t=s);let h="";for(let i=e;i<t;++i)h+=yt[n[i]];return h}function lt(n,e,t){let s=n.slice(e,t),h="";for(let i=0;i<s.length-1;i+=2)h+=String.fromCharCode(s[i]+s[i+1]*256);return h}g.prototype.slice=function(e,t){let s=this.length;e=~~e,t=t===void 0?s:~~t,e<0?(e+=s,e<0&&(e=0)):e>s&&(e=s),t<0?(t+=s,t<0&&(t=0)):t>s&&(t=s),t<e&&(t=e);let h=this.subarray(e,t);return Object.setPrototypeOf(h,g.prototype),h};function I(n,e,t){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+e>t)throw new RangeError("Trying to access beyond buffer length")}g.prototype.readUintLE=g.prototype.readUIntLE=function(e,t,s){e=e>>>0,t=t>>>0,s||I(e,t,this.length);let h=this[e],i=1,r=0;for(;++r<t&&(i*=256);)h+=this[e+r]*i;return h};g.prototype.readUintBE=g.prototype.readUIntBE=function(e,t,s){e=e>>>0,t=t>>>0,s||I(e,t,this.length);let h=this[e+--t],i=1;for(;t>0&&(i*=256);)h+=this[e+--t]*i;return h};g.prototype.readUint8=g.prototype.readUInt8=function(e,t){return e=e>>>0,t||I(e,1,this.length),this[e]};g.prototype.readUint16LE=g.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||I(e,2,this.length),this[e]|this[e+1]<<8};g.prototype.readUint16BE=g.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||I(e,2,this.length),this[e]<<8|this[e+1]};g.prototype.readUint32LE=g.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};g.prototype.readUint32BE=g.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};g.prototype.readBigUInt64LE=$(function(e){e=e>>>0,Y(e,"offset");let t=this[e],s=this[e+7];(t===void 0||s===void 0)&&X(e,this.length-8);let h=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,i=this[++e]+this[++e]*2**8+this[++e]*2**16+s*2**24;return BigInt(h)+(BigInt(i)<<BigInt(32))});g.prototype.readBigUInt64BE=$(function(e){e=e>>>0,Y(e,"offset");let t=this[e],s=this[e+7];(t===void 0||s===void 0)&&X(e,this.length-8);let h=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],i=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+s;return(BigInt(h)<<BigInt(32))+BigInt(i)});g.prototype.readIntLE=function(e,t,s){e=e>>>0,t=t>>>0,s||I(e,t,this.length);let h=this[e],i=1,r=0;for(;++r<t&&(i*=256);)h+=this[e+r]*i;return i*=128,h>=i&&(h-=Math.pow(2,8*t)),h};g.prototype.readIntBE=function(e,t,s){e=e>>>0,t=t>>>0,s||I(e,t,this.length);let h=t,i=1,r=this[e+--h];for(;h>0&&(i*=256);)r+=this[e+--h]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r};g.prototype.readInt8=function(e,t){return e=e>>>0,t||I(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};g.prototype.readInt16LE=function(e,t){e=e>>>0,t||I(e,2,this.length);let s=this[e]|this[e+1]<<8;return s&32768?s|4294901760:s};g.prototype.readInt16BE=function(e,t){e=e>>>0,t||I(e,2,this.length);let s=this[e+1]|this[e]<<8;return s&32768?s|4294901760:s};g.prototype.readInt32LE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};g.prototype.readInt32BE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};g.prototype.readBigInt64LE=$(function(e){e=e>>>0,Y(e,"offset");let t=this[e],s=this[e+7];(t===void 0||s===void 0)&&X(e,this.length-8);let h=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(s<<24);return(BigInt(h)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});g.prototype.readBigInt64BE=$(function(e){e=e>>>0,Y(e,"offset");let t=this[e],s=this[e+7];(t===void 0||s===void 0)&&X(e,this.length-8);let h=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(h)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+s)});g.prototype.readFloatLE=function(e,t){return e=e>>>0,t||I(e,4,this.length),q.read(this,e,!0,23,4)};g.prototype.readFloatBE=function(e,t){return e=e>>>0,t||I(e,4,this.length),q.read(this,e,!1,23,4)};g.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||I(e,8,this.length),q.read(this,e,!0,52,8)};g.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||I(e,8,this.length),q.read(this,e,!1,52,8)};function _(n,e,t,s,h,i){if(!g.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>h||e<i)throw new RangeError('"value" argument is out of bounds');if(t+s>n.length)throw new RangeError("Index out of range")}g.prototype.writeUintLE=g.prototype.writeUIntLE=function(e,t,s,h){if(e=+e,t=t>>>0,s=s>>>0,!h){let a=Math.pow(2,8*s)-1;_(this,e,t,s,a,0)}let i=1,r=0;for(this[t]=e&255;++r<s&&(i*=256);)this[t+r]=e/i&255;return t+s};g.prototype.writeUintBE=g.prototype.writeUIntBE=function(e,t,s,h){if(e=+e,t=t>>>0,s=s>>>0,!h){let a=Math.pow(2,8*s)-1;_(this,e,t,s,a,0)}let i=s-1,r=1;for(this[t+i]=e&255;--i>=0&&(r*=256);)this[t+i]=e/r&255;return t+s};g.prototype.writeUint8=g.prototype.writeUInt8=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,1,255,0),this[t]=e&255,t+1};g.prototype.writeUint16LE=g.prototype.writeUInt16LE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};g.prototype.writeUint16BE=g.prototype.writeUInt16BE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};g.prototype.writeUint32LE=g.prototype.writeUInt32LE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};g.prototype.writeUint32BE=g.prototype.writeUInt32BE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Ie(n,e,t,s,h){Ue(e,s,h,n,t,7);let i=Number(e&BigInt(4294967295));n[t++]=i,i=i>>8,n[t++]=i,i=i>>8,n[t++]=i,i=i>>8,n[t++]=i;let r=Number(e>>BigInt(32)&BigInt(4294967295));return n[t++]=r,r=r>>8,n[t++]=r,r=r>>8,n[t++]=r,r=r>>8,n[t++]=r,t}function Be(n,e,t,s,h){Ue(e,s,h,n,t,7);let i=Number(e&BigInt(4294967295));n[t+7]=i,i=i>>8,n[t+6]=i,i=i>>8,n[t+5]=i,i=i>>8,n[t+4]=i;let r=Number(e>>BigInt(32)&BigInt(4294967295));return n[t+3]=r,r=r>>8,n[t+2]=r,r=r>>8,n[t+1]=r,r=r>>8,n[t]=r,t+8}g.prototype.writeBigUInt64LE=$(function(e,t=0){return Ie(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});g.prototype.writeBigUInt64BE=$(function(e,t=0){return Be(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});g.prototype.writeIntLE=function(e,t,s,h){if(e=+e,t=t>>>0,!h){let c=Math.pow(2,8*s-1);_(this,e,t,s,c-1,-c)}let i=0,r=1,a=0;for(this[t]=e&255;++i<s&&(r*=256);)e<0&&a===0&&this[t+i-1]!==0&&(a=1),this[t+i]=(e/r>>0)-a&255;return t+s};g.prototype.writeIntBE=function(e,t,s,h){if(e=+e,t=t>>>0,!h){let c=Math.pow(2,8*s-1);_(this,e,t,s,c-1,-c)}let i=s-1,r=1,a=0;for(this[t+i]=e&255;--i>=0&&(r*=256);)e<0&&a===0&&this[t+i+1]!==0&&(a=1),this[t+i]=(e/r>>0)-a&255;return t+s};g.prototype.writeInt8=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};g.prototype.writeInt16LE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};g.prototype.writeInt16BE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};g.prototype.writeInt32LE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};g.prototype.writeInt32BE=function(e,t,s){return e=+e,t=t>>>0,s||_(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};g.prototype.writeBigInt64LE=$(function(e,t=0){return Ie(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});g.prototype.writeBigInt64BE=$(function(e,t=0){return Be(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function be(n,e,t,s,h,i){if(t+s>n.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function _e(n,e,t,s,h){return e=+e,t=t>>>0,h||be(n,e,t,4,34028234663852886e22,-34028234663852886e22),q.write(n,e,t,s,23,4),t+4}g.prototype.writeFloatLE=function(e,t,s){return _e(this,e,t,!0,s)};g.prototype.writeFloatBE=function(e,t,s){return _e(this,e,t,!1,s)};function Ce(n,e,t,s,h){return e=+e,t=t>>>0,h||be(n,e,t,8,17976931348623157e292,-17976931348623157e292),q.write(n,e,t,s,52,8),t+8}g.prototype.writeDoubleLE=function(e,t,s){return Ce(this,e,t,!0,s)};g.prototype.writeDoubleBE=function(e,t,s){return Ce(this,e,t,!1,s)};g.prototype.copy=function(e,t,s,h){if(!g.isBuffer(e))throw new TypeError("argument should be a Buffer");if(s||(s=0),!h&&h!==0&&(h=this.length),t>=e.length&&(t=e.length),t||(t=0),h>0&&h<s&&(h=s),h===s||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("sourceEnd out of bounds");h>this.length&&(h=this.length),e.length-t<h-s&&(h=e.length-t+s);let i=h-s;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,s,h):Uint8Array.prototype.set.call(e,this.subarray(s,h),t),i};g.prototype.fill=function(e,t,s,h){if(typeof e=="string"){if(typeof t=="string"?(h=t,t=0,s=this.length):typeof s=="string"&&(h=s,s=this.length),h!==void 0&&typeof h!="string")throw new TypeError("encoding must be a string");if(typeof h=="string"&&!g.isEncoding(h))throw new TypeError("Unknown encoding: "+h);if(e.length===1){let r=e.charCodeAt(0);(h==="utf8"&&r<128||h==="latin1")&&(e=r)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<s)throw new RangeError("Out of range index");if(s<=t)return this;t=t>>>0,s=s===void 0?this.length:s>>>0,e||(e=0);let i;if(typeof e=="number")for(i=t;i<s;++i)this[i]=e;else{let r=g.isBuffer(e)?e:g.from(e,h),a=r.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<s-t;++i)this[i+t]=r[i%a]}return this};var j={};function oe(n,e,t){j[n]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${n}]`,this.stack,delete this.name}get code(){return n}set code(h){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:h,writable:!0})}toString(){return`${this.name} [${n}]: ${this.message}`}}}oe("ERR_BUFFER_OUT_OF_BOUNDS",function(n){return n?`${n} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);oe("ERR_INVALID_ARG_TYPE",function(n,e){return`The "${n}" argument must be of type number. Received type ${typeof e}`},TypeError);oe("ERR_OUT_OF_RANGE",function(n,e,t){let s=`The value of "${n}" is out of range.`,h=t;return Number.isInteger(t)&&Math.abs(t)>2**32?h=ye(String(t)):typeof t=="bigint"&&(h=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(h=ye(h)),h+="n"),s+=` It must be ${e}. Received ${h}`,s},RangeError);function ye(n){let e="",t=n.length,s=n[0]==="-"?1:0;for(;t>=s+4;t-=3)e=`_${n.slice(t-3,t)}${e}`;return`${n.slice(0,t)}${e}`}function ft(n,e,t){Y(e,"offset"),(n[e]===void 0||n[e+t]===void 0)&&X(e,n.length-(t+1))}function Ue(n,e,t,s,h,i){if(n>t||n<e){let r=typeof e=="bigint"?"n":"",a;throw i>3?e===0||e===BigInt(0)?a=`>= 0${r} and < 2${r} ** ${(i+1)*8}${r}`:a=`>= -(2${r} ** ${(i+1)*8-1}${r}) and < 2 ** ${(i+1)*8-1}${r}`:a=`>= ${e}${r} and <= ${t}${r}`,new j.ERR_OUT_OF_RANGE("value",a,n)}ft(s,h,i)}function Y(n,e){if(typeof n!="number")throw new j.ERR_INVALID_ARG_TYPE(e,"number",n)}function X(n,e,t){throw Math.floor(n)!==n?(Y(n,t),new j.ERR_OUT_OF_RANGE(t||"offset","an integer",n)):e<0?new j.ERR_BUFFER_OUT_OF_BOUNDS:new j.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,n)}var pt=/[^+/0-9A-Za-z-_]/g;function dt(n){if(n=n.split("=")[0],n=n.trim().replace(pt,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function ne(n,e){e=e||1/0;let t,s=n.length,h=null,i=[];for(let r=0;r<s;++r){if(t=n.charCodeAt(r),t>55295&&t<57344){if(!h){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(r+1===s){(e-=3)>-1&&i.push(239,191,189);continue}h=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),h=t;continue}t=(h-55296<<10|t-56320)+65536}else h&&(e-=3)>-1&&i.push(239,191,189);if(h=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function gt(n){let e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t)&255);return e}function mt(n,e){let t,s,h,i=[];for(let r=0;r<n.length&&!((e-=2)<0);++r)t=n.charCodeAt(r),s=t>>8,h=t%256,i.push(h),i.push(s);return i}function Fe(n){return ee.toByteArray(dt(n))}function J(n,e,t,s){let h;for(h=0;h<s&&!(h+t>=e.length||h>=n.length);++h)e[h+t]=n[h];return h}function F(n,e){return n instanceof e||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===e.name}function he(n){return n!==n}var yt=function(){let n="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let s=t*16;for(let h=0;h<16;++h)e[s+h]=n[t]+n[h]}return e}();function $(n){return typeof BigInt>"u"?Et:n}function Et(){throw new Error("BigInt not supported")}});var B={MODULE_VERSION:"3.1.0",DEFAULT_ROW_ID_NAME:"row_id",DEFAULT_ROW_ID:"0",CONTEXT_NONE:0,CONTEXT_SEARCH:1,CONTEXT_LIST:2,CONTEXT_CREATE:3,CONTEXT_COPY:4,CONTEXT_UPDATE:5,CONTEXT_DELETE:6,CONTEXT_GRAPH:7,CONTEXT_CROSSTAB:8,CONTEXT_PRINTTMPL:9,CONTEXT_UPDATEALL:10,CONTEXT_REFSELECT:11,CONTEXT_DATAMAPSELECT:12,CONTEXT_PREVALIDATE:13,CONTEXT_POSTVALIDATE:14,CONTEXT_STATETRANSITION:15,CONTEXT_EXPORT:16,CONTEXT_IMPORT:17,CONTEXT_ASSOCIATE:18,CONTEXT_PANELLIST:19,CONTEXT_ACTION:20,CONTEXT_AGENDA:21,CONTEXT_PLACEMAP:22,TYPE_ID:0,TYPE_INT:1,TYPE_FLOAT:2,TYPE_STRING:3,TYPE_DATE:4,TYPE_DATETIME:5,TYPE_TIME:6,TYPE_ENUM:7,TYPE_BOOLEAN:8,TYPE_PASSWORD:9,TYPE_URL:10,TYPE_HTML:11,TYPE_EMAIL:12,TYPE_LONG_STRING:13,TYPE_ENUM_MULTI:14,TYPE_REGEXP:15,TYPE_DOC:17,TYPE_FLOAT_EMPTY:18,TYPE_EXTFILE:19,TYPE_IMAGE:20,TYPE_NOTEPAD:21,TYPE_PHONENUM:22,TYPE_COLOR:23,TYPE_OBJECT:24,TYPE_GEOCOORDS:25,TYPE_BIGDECIMAL:26,TYPES:["ID","integer","decimal","string","date","datetime","time","enum","boolean","password","url","html","email","text","multienum","regexp","undefined","document","simpledecimal","extfile","picture","notepad","phonenum","color","object","geocoords","bigdecimal"],VIS_NOT:0,VIS_HIDDEN:0,VIS_LIST:1,VIS_FORM:2,VIS_BOTH:3,SEARCH_NONE:0,SEARCH_MONO:1,SEARCH_MULTI_CHECK:2,SEARCH_MULTI_LIST:3,SEARCH_PERIOD:4,TRUE:"1",FALSE:"0",ERRLEVEL_FATAL:1,ERRLEVEL_ERROR:2,ERRLEVEL_WARNING:3,RESOURCE_TYPE_IMAGE:"IMG",RESOURCE_TYPE_ICON:"ICO",RESOURCE_TYPE_STYLESHEET:"CSS",RESOURCE_TYPE_JAVASCRIPT:"JS",DEFAULT_AUTH_HEADER:"authorization",SIMPLICITE_AUTH_HEADER:"x-simplicite-authorization"};var Me=function(n,e,t,s){function h(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function a(o){try{f(s.next(o))}catch(u){r(u)}}function c(o){try{f(s.throw(o))}catch(u){r(u)}}function f(o){o.done?i(o.value):h(o.value).then(a,c)}f((s=s.apply(n,e||[])).next())})},b=class{constructor(e){this.getId=()=>this.id,this.getMIMEType=()=>this.mime,this.getMimeType=this.getMIMEType,this.setMIMEType=t=>(this.mime=t,this),this.setMimeType=this.setMIMEType,this.getName=()=>this.name,this.getFileName=this.getName,this.getFilename=this.getName,this.setName=t=>(this.name=t,this),this.setFileName=this.setName,this.setFilename=this.setName,this.getContent=()=>this.content,this.getThumbnail=()=>this.thumbnail,this.getContentAsArrayBuffer=()=>this.getBuffer(this.content).buffer,this.getThumbnailAsArrayBuffer=()=>this.getBuffer(this.thumbnail||"").buffer,this.getContentAsText=()=>this.getBuffer(this.content).toString("utf-8"),this.setContent=t=>(this.content=this.cleanContent(t),this),this.setContentFromText=t=>(this.content=Buffer.from(t,"utf-8").toString("base64"),this),this.getDataURL=t=>{if(this.content)return"data:"+this.mime+";base64,"+(t&&this.thumbnail?this.thumbnail:this.content)},this.load=t=>Me(this,void 0,void 0,function*(){return new Promise((s,h)=>{try{if(t){this.name=t.name,this.mime=t.type;let i=new FileReader;i.onload=()=>{this.content=i.result?this.cleanContent(i.result):"",s(this)},i.readAsDataURL(t)}else this.content="",s(this)}catch(i){h(i)}})}),this.getValue=()=>({id:this.id,name:this.filename&&!this.name?this.filename:this.name,mime:this.mime,content:this.content,thumbnail:this.thumbnail}),Object.assign(this,typeof e=="string"?{name:e}:e||{}),this.filename&&!this.name&&(this.name=this.filename,this.filename=void 0)}cleanContent(e){return e.startsWith("data:")?e.replace(/data:.*;base64,/,""):e}getBuffer(e){return Buffer.from(e,"base64")}};var O=class{constructor(e){this.getUserId=()=>this.userid,this.getUsername=()=>this.login,this.getLogin=this.getUsername,this.getLang=()=>this.lang,this.getEmail=()=>this.email,this.getFirstname=()=>this.firstname,this.getFirstName=this.getFirstname,this.getLastname=()=>this.lastname,this.getLastName=this.getLastname,this.getPictureURL=()=>{if(this.picture)return"data:"+this.picture.mime+";base64,"+this.picture.content},this.hasResponsibility=t=>this.responsibilities&&this.responsibilities.indexOf(t)!==-1,this.getSystemParameter=t=>this.sysparams&&this.sysparams[t]||"",this.getSysParam=this.getSystemParameter,this.T=t=>this.texts&&this.texts[t]||"",Object.assign(this,e)}};var D=class{constructor(e,t){this.name=e,this.instance=t,this.rowidfield=B.DEFAULT_ROW_ID_NAME,this.label=e,this.help="",this.fields=new Array}};var x=function(n,e,t,s){function h(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function a(o){try{f(s.next(o))}catch(u){r(u)}}function c(o){try{f(s.throw(o))}catch(u){r(u)}}function f(o){o.done?i(o.value):h(o.value).then(a,c)}f((s=s.apply(n,e||[])).next())})},k=class{constructor(e,t,s){this.getMetaData=i=>x(this,void 0,void 0,function*(){let r="BusinessObject.getMetaData",a=this.session;return i=i||{},new Promise((c,f)=>{let o="";i.context&&(o+="&context="+encodeURIComponent(i.context)),i.contextParam&&(o+="&contextparam="+encodeURIComponent(i.contextParam)),a.sendRequest(this.path+"&action=metadata"+o,void 0,(u,p)=>{let l=a.parseResponse(u,p);if(a.debug(`[${r}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=a.getError(l.response,void 0,r);(i.error||a.error).call(this,d)||f.call(this,d)}else this.metadata=l.response,c.call(this,this.metadata)},u=>{u=a.getError(u,void 0,r),(i.error||a.error).call(this,u)||f.call(this,u)})})}),this.getMetadata=this.getMetaData,this.getName=()=>this.metadata.name,this.getInstance=()=>this.metadata.instance,this.getLabel=()=>this.metadata.label,this.getHelp=()=>this.metadata.help,this.getFields=()=>this.metadata.fields,this.getField=i=>{let r=this.getFields(),a=0;for(;a<r.length&&r[a].name!==i;)a++;if(a<r.length)return r[a]},this.getRowIdFieldName=()=>this.metadata.rowidfield,this.getRowIdField=()=>this.getField(this.getRowIdFieldName()),this.getLinks=()=>this.metadata.links,this.getFieldType=i=>{if(typeof i=="string"&&(i=this.getField(i)),i)return i.type},this.getFieldLabel=i=>{if(typeof i=="string"&&(i=this.getField(i)),i)return i.label},this.getFieldValue=(i,r)=>{if(r||(r=this.item),i&&r){let a=r[typeof i=="string"?i:i.name];return a&&a.mime?new b(a):a}},this.getFieldListValue=(i,r)=>{typeof i=="string"&&(i=this.getField(i));let a=this.getFieldValue(i,r);return i&&i.listOfValues?this.getListValue(i.listOfValues,a):a},this.getFieldListColors=(i,r)=>{typeof i=="string"&&(i=this.getField(i));let a=this.getFieldValue(i,r);return i&&i.listOfValues?this.getListColors(i.listOfValues,a):a},this.getFieldDataURL=(i,r)=>{typeof i!="string"&&(i=i.fullinput||i.name);let a=this.getFieldValue(i,r);if(a&&a.mime)return"data:"+a.mime+";base64,"+(a.content||a.thumbnail)},this.getFieldDocument=(i,r)=>{typeof i!="string"&&(i=i.fullinput||i.input||i.name);let a=this.getFieldValue(i,r);return a&&a.mime?new b(a):a},this.getFieldDocumentURL=(i,r,a)=>{typeof i!="string"&&(i=i.fullinput||i.input||i.name);let c=this.getFieldValue(i,r);if(c&&c.mime&&(c=c.id),c)return this.session.parameters.url+this.session.parameters.docpath+"?object="+encodeURIComponent(this.metadata.name)+"&inst="+encodeURIComponent(this.metadata.instance)+"&field="+encodeURIComponent(i)+"&row_id="+encodeURIComponent(this.getRowId(r))+"&doc_id="+encodeURIComponent(c)+(a?"&thumbnail=true":"")+(this.session.authtoken?"&_x_simplicite_authorization_="+encodeURIComponent(this.session.authtoken):"")},this.getListValue=(i,r)=>{if(i){for(let a of i)if(a.code===r)return a.value}return r},this.getListColors=(i,r)=>{if(i){for(let a of i)if(a.code===r)return{color:a.color,bgcolor:a.bgcolor}}return{color:"inherit",bgcolor:"inherit"}},this.setFieldValue=(i,r,a)=>{a||(a=this.item),i&&a&&(a[typeof i=="string"?i:i.name]=r instanceof b?r.getValue():r)},this.resetValues=i=>{i||(i=this.item);for(let r in i)delete i[r]},this.setFieldValues=(i,r)=>x(this,void 0,void 0,function*(){r||(r=this.item);let a;return i instanceof FormData?(a={},i.forEach((c,f)=>a[f]=c)):a=i,new Promise(c=>{let f=[];for(let o of Object.keys(a)){let u=a[o];u instanceof File?f.push(new Promise(p=>{new b().load(u).then(l=>{this.setFieldValue(o,l),p.call(this)})})):this.setFieldValue(o,u)}Promise.allSettled(f).then(()=>c.call(this,r))})}),this.isRowIdField=i=>!i.ref&&i.name===this.metadata.rowidfield,this.isTimestampField=i=>{let r=i.name;return!i.ref&&(r==="created_by"||r==="created_dt"||r==="updated_by"||r==="updated_dt")},this.getFilters=i=>x(this,void 0,void 0,function*(){let r="BusinessObject.getFilters",a=this.session;return i=i||{},new Promise((c,f)=>{let o="";i.context&&(o+="&context="+encodeURIComponent(i.context)),i.reset&&(o+="&reset="+!!i.reset),a.sendRequest(this.path+"&action=filters"+o,void 0,(u,p)=>{let l=a.parseResponse(u,p);if(a.debug(`[${r}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=a.getError(l.response,void 0,r);(i.error||a.error).call(this,d)||f.call(this,d)}else this.filters=l.response,c.call(this,this.filters)},u=>{u=a.getError(u,void 0,r),(i.error||a.error).call(this,u)||f.call(this,u)})})}),this.getReqContextOption=i=>i.context?`&context=${encodeURIComponent(i.context)}`:"",this.getReqOptions=i=>{let r=this.getReqContextOption(i),a=i.inlineDocs||i.inlineDocuments||i.inlineImages;a&&(r+=`&inline_documents=${encodeURIComponent(a.join?a.join(","):a)}`);let c=i.inlineThumbs||i.inlineThumbnails;c&&(r+=`&inline_thumbnails=${encodeURIComponent(c.join?c.join(","):c)}`);let f=i.inlineObjs||i.inlineObjects;return f&&(r+=`&inline_objects=${encodeURIComponent(f.join?f.join(","):f)}`),r},this.convertFilterWildCards=i=>typeof i=="string"?i.replace(new RegExp("\\*","g"),"%").replace(new RegExp("\\?","g"),"_"):i,this.getReqParams=(i,r)=>{let a="";if(!i)return a;for(let c of Object.entries(i)){let f=c[0],o=c[1]||"";if(o instanceof b&&(o=o.getValue()),o.name&&o.content)o.content.startsWith("data:")&&(o.content=o.content.replace(/data:.*;base64,/,"")),a+=(a!==""?"&":"")+f+"="+encodeURIComponent("id|"+(o.id?o.id:"0")+"|name|"+o.name+"|content|"+o.content);else if(o.object&&o.row_id)a+=(a!==""?"&":"")+f+"="+encodeURIComponent("object|"+o.object+"|row_id|"+o.row_id);else if(o.sort)for(let u of o)a+=(a!==""?"&":"")+f+"="+encodeURIComponent(r?this.convertFilterWildCards(u):u);else a+=(a!==""?"&":"")+f+"="+encodeURIComponent(r?this.convertFilterWildCards(o):o)}return a},this.getCount=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.getCount",c=this.session;return r=r||{},new Promise((f,o)=>{let u=this.getReqContextOption(r);r.operations===!0&&(u+="&_operations=true"),this.filters=i||{},c.sendRequest(`${this.getPath("count",r)}${u}`,this.getReqParams(this.filters,!0),(p,l)=>{let d=c.parseResponse(p,l);if(c.debug("["+a+"] HTTP status = "+l+", response type = "+d.type),d.type==="error"){let y=c.getError(d.response,void 0,a);(r.error||c.error).call(this,y)||o.call(this,y)}else this.count=d.response.count,this.page=d.response.page>=0?d.response.page+1:void 0,this.maxpage=d.response.maxpage>=0?d.response.maxpage+1:void 0,this.list=[],f.call(this,this.count)},p=>{p=c.getError(p,void 0,a),(r.error||c.error).call(this,p)||o.call(this,p)})})}),this.search=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.search",c=this.session;return r=r||{},new Promise((f,o)=>{let u=this.getReqOptions(r);r.page>0&&(u+=`&page=${r.page-1}`),r.metadata===!0&&(u+="&_md=true"),r.visible===!0&&(u+="&_visible=true"),this.filters=i||{},c.sendRequest(`${this.getPath("search",r)}${u}`,this.getReqParams(this.filters,!0),(p,l)=>{let d=c.parseResponse(p,l);if(c.debug(`[${a}] HTTP status = ${l}, response type = ${d.type}`),d.type==="error"){let y=c.getError(d.response,void 0,a);(r.error||c.error).call(this,y)||o.call(this,y)}else p.meta&&(this.metadata=d.response.meta),this.count=d.response.count,this.page=d.response.page>=0?d.response.page+1:void 0,this.maxpage=d.response.maxpage>=0?d.response.maxpage+1:void 0,this.list=d.response.list,f.call(this,this.list)},p=>{p=c.getError(p,void 0,a),(r.error||c.error).call(this,p)||o.call(this,p)})})}),this.get=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.get",c=this.session;return r=r||{},new Promise((f,o)=>{let u=this.getReqOptions(r),p=r.treeView;if(p&&(u+=`&treeview=${encodeURIComponent(p)}`),r.fields)for(let l of r.fields.length)u+=`&fields=${encodeURIComponent(l.replace(".","__"))}`;r.metadata&&(u+="&_md=true"),r.social&&(u+="&_social=true"),c.sendRequest(`${this.getPath("get",r)}&${this.metadata.rowidfield}=${encodeURIComponent(i||this.getRowId())}${u}`,void 0,(l,d)=>{let y=c.parseResponse(l,d);if(c.debug("[simplicite.BusinessObject.get] HTTP status = "+d+", response type = "+y.type),y.type==="error"){let m=c.getError(y.response,void 0,a);(r.error||c.error).call(this,m)||o.call(this,m)}else y.response.meta&&(this.metadata=y.response.meta),y.response.data?this.item=p?y.response.data.item:y.response.data:this.item=p?y.response.item:y.response,f.call(this,p?y.response:this.item)},l=>{l=c.getError(l,void 0,a),(r.error||c.error).call(this,l)||o.call(this,l)})})}),this.getForCreate=i=>x(this,void 0,void 0,function*(){return i=i||{},delete i.treeview,delete i.fields,i.context=B.CONTEXT_CREATE,this.get(B.DEFAULT_ROW_ID,i)}),this.getForUpdate=(i,r)=>x(this,void 0,void 0,function*(){return r=r||{},delete r.treeview,delete r.fields,r.context=B.CONTEXT_UPDATE,this.get(i||this.getRowId(),r)}),this.getForCopy=(i,r)=>x(this,void 0,void 0,function*(){return r=r||{},delete r.treeview,delete r.fields,r.context=B.CONTEXT_COPY,this.get(i||this.getRowId(),r)}),this.getForDelete=(i,r)=>x(this,void 0,void 0,function*(){return r=r||{},delete r.treeview,delete r.fields,r.context=B.CONTEXT_DELETE,this.get(i||this.getRowId(),r)}),this.getRowId=i=>{if(i=i||this.item,i)return i[this.getRowIdFieldName()]},this.populate=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.populate",c=this.session;return r=r||{},new Promise((f,o)=>{i&&(this.item=i),c.sendRequest(`${this.getPath("populate",r)}${this.getReqOptions(r)}`,this.getReqParams(this.item),(u,p)=>{let l=c.parseResponse(u,p);if(c.debug(`[${a}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=c.getError(l.response,void 0,a);(r.error||c.error).call(this,d)||o.call(this,d)}else this.item=l.response.data?l.response.data:l.response,f.call(this,this.item)},u=>{u=c.getError(u,void 0,a),(r.error||c.error).call(this,u)||o.call(this,u)})})}),this.getFieldLinkedList=(i,r,a,c)=>x(this,void 0,void 0,function*(){let f="BusinessObject.getFieldLinkedList",o=this.session;return c=c||{},new Promise((u,p)=>{typeof i!="string"&&(i=i.fullinput||i.name),typeof r!="string"&&(r=r.fullinput||r.name);let l=!1;a===!0?(l=!0,a=void 0):typeof a>"u"&&(a=this.getFieldValue(i)),o.sendRequest(this.getPath("getlinkedlist",c),this.getReqParams({origin:i,input:r,code:a,all:l}),(d,y)=>{let m=o.parseResponse(d,y);if(o.debug("["+f+"] HTTP status = "+y+", response type = "+m.type),m.type==="error"){let E=o.getError(m.response,void 0,f);(c.error||o.error).call(this,E)||p.call(this,E)}else this.item=m.response.result?m.response.result:m.response,u.call(this,this.item)},d=>{d=o.getError(d,void 0,f),(c.error||o.error).call(this,d)||p.call(this,d)})})}),this.save=(i,r)=>x(this,void 0,void 0,function*(){i&&(this.item=i);let a=this.item[this.metadata.rowidfield];return!a||a===B.DEFAULT_ROW_ID?this.create(i,r):this.update(i,r)}),this.create=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.create",c=this.session;return r=r||{},new Promise((f,o)=>{i&&(this.item=i),this.item.row_id=B.DEFAULT_ROW_ID,c.sendRequest(`${this.getPath("create",r)}${this.getReqOptions(r)}`,this.getReqParams(this.item),(u,p)=>{let l=c.parseResponse(u,p);if(c.debug("["+a+"] HTTP status = "+p+", response type = "+l.type),l.type==="error"){let d=c.getError(l.response,void 0,a);(r.error||c.error).call(this,d)||o.call(this,d)}else this.item=l.response.data?l.response.data:l.response,f.call(this,this.item)},u=>{u=c.getError(u,void 0,a),(r.error||c.error).call(this,u)||o.call(this,u)})})}),this.update=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.update",c=this.session;return r=r||{},new Promise((f,o)=>{i&&(this.item=i),c.sendRequest(`${this.getPath("update",r)}${this.getReqOptions(r)}`,this.getReqParams(this.item),(u,p)=>{let l=c.parseResponse(u,p);if(c.debug(`[${a}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=c.getError(l.response,void 0,a);(r.error||c.error).call(this,d)||o.call(this,d)}else this.item=l.response.data?l.response.data:l.response,f.call(this,this.item)},u=>{u=c.getError(u,void 0,a),(r.error||c.error).call(this,u)||o.call(this,u)})})}),this.del=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.del",c=this.session;return r=r||{},new Promise((f,o)=>{i&&(this.item=i),c.sendRequest(`${this.getPath("delete",r)}&${this.metadata.rowidfield}=${encodeURIComponent(this.item[this.metadata.rowidfield])}`,void 0,(u,p)=>{let l=c.parseResponse(u,p);if(c.debug(`[${a}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=c.getError(l.response,void 0,a);(r.error||c.error).call(this,d)||o.call(this,d)}else this.item=void 0,delete l.response.undoredo,f.call(this,l.response)},u=>{u=c.getError(u,void 0,a),(r.error||c.error).call(this,u)||o.call(this,u)})})}),this.action=(i,r,a)=>x(this,void 0,void 0,function*(){let c=`BusinessObject.action(${i})`,f=this.session;return a=a||{},new Promise((o,u)=>{let p=r?`&${this.getRowIdFieldName()}=${encodeURIComponent(r)}`:"";f.sendRequest(`${this.getPath(i,a)}${p}`,this.getReqParams(a.parameters),(l,d)=>{let y=f.parseResponse(l,d);if(f.debug("["+c+"] HTTP status = "+d+", response type = "+y.type),y.type==="error"){let m=f.getError(y.response,void 0,c);(a.error||f.error).call(this,m)||u.call(this,m)}else{let m=y.response.result;o.call(this,m)}},l=>{l=f.getError(l,void 0,c),(a.error||f.error).call(this,l)||u.call(this,l)})})}),this.crosstab=(i,r)=>x(this,void 0,void 0,function*(){let a=`BusinessObject.crosstab(${i})`,c=this.session;return r=r||{},new Promise((f,o)=>{r.filters&&(this.filters=r.filters),c.sendRequest(`${this.getPath(r.cubes?"crosstabcubes":"crosstab",r)}&crosstab=${encodeURIComponent(i)}`,this.getReqParams(r.filters||this.filters,!0),(u,p)=>{let l=c.parseResponse(u,p);if(c.debug(`[${a}] HTTP status = ${p}, response type = ${l.type}`),l.type==="error"){let d=c.getError(l.response,void 0,a);(r.error||c.error).call(this,d)||o.call(this,d)}else f.call(this,l.response)},u=>{u=c.getError(u,void 0,a),(r.error||c.error).call(this,u)||o.call(this,u)})})}),this.print=(i,r,a)=>x(this,void 0,void 0,function*(){let c=`BusinessObject.print(${i})`,f=this.session;return a=a||{},new Promise((o,u)=>{a.filters&&(this.filters=a.filters);let p="";a.all&&(p+="&all="+!!a.all),a.mailing&&(p+="&mailing="+!!a.mailing),r&&(p+=`&${this.getRowIdFieldName()}=${encodeURIComponent(r)}`),f.sendRequest(`${this.getPath("print",a)}&printtemplate=${encodeURIComponent(i)}${p}`,void 0,(l,d)=>{let y=f.parseResponse(l,d);if(f.debug("["+c+"] HTTP status = "+d+", response type = "+y.type),y.type==="error"){let m=f.getError(y.response,void 0,c);(a.error||f.error).call(this,m)||u.call(this,m)}else o.call(this,new b(y.response))},l=>{l=f.getError(l,void 0,c),(a.error||f.error).call(this,l)||u.call(this,l)})})}),this.placemap=(i,r,a)=>x(this,void 0,void 0,function*(){let c=`BusinessObject.placemap(${i})`,f=this.session;return this.filters=r||{},a=a||{},new Promise((o,u)=>{a.filters&&(this.filters=a.filters),f.sendRequest(`${this.getPath("placemap",a)}&placemap=${encodeURIComponent(i)}`,this.getReqParams(this.filters,!0),(p,l)=>{let d=f.parseResponse(p,l);if(f.debug("["+c+"] HTTP status = "+l+", response type = "+d.type),d.type==="error"){let y=f.getError(d.response,void 0,c);(a.error||f.error).call(this,y)||u.call(this,y)}else o.call(this,d.response)},p=>{p=f.getError(p,void 0,c),(a.error||f.error).call(this,p)||u.call(this,p)})})}),this.setParameter=(i,r,a)=>x(this,void 0,void 0,function*(){let c="BusinessObject.setParameter",f=this.session;return a=a||{},new Promise((o,u)=>{let p={name:i};r&&(p.value=r),f.sendRequest(this.getPath("setparameter",a),this.getReqParams(p),(l,d)=>{let y=f.parseResponse(l,d);if(f.debug(`[${c}] HTTP status = ${d}, response type = ${y.type}`),y.type==="error"){let m=f.getError(y.response,void 0,c);(a.error||f.error).call(this,m)||u.call(this,m)}else{let m=y.response.result;o.call(this,m)}},l=>{l=f.getError(l,void 0,c),(a.error||f.error).call(this,l)||u.call(this,l)})})}),this.getParameter=(i,r)=>x(this,void 0,void 0,function*(){let a="BusinessObject.getParameter",c=this.session;return r=r||{},new Promise((f,o)=>{let u={name:i};c.sendRequest(this.getPath("getparameter",r),this.getReqParams(u),(p,l)=>{let d=c.parseResponse(p,l);if(c.debug(`[${a}] HTTP status = ${l}, response type = ${d.type}`),d.type==="error"){let y=c.getError(d.response,void 0,a);(r.error||c.error).call(this,y)||o.call(this,y)}else{let y=d.response.result;f.call(this,y)}},p=>{p=c.getError(p,void 0,a),(r.error||c.error).call(this,p)||o.call(this,p)})})}),this.getResourceURL=(i,r)=>this.session.getResourceURL(i,r,this.metadata.name,this.metadata.id),this.session=e;let h=s||"api_"+t;this.metadata=new D(t,h),this.cacheKey=this.session.getBusinessObjectCacheKey(t,h),this.path=this.session.parameters.objpath+"?object="+encodeURIComponent(t)+"&inst="+encodeURIComponent(h),this.item={},this.filters={},this.list=[]}getPath(e,t){let s=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.path}&action=${encodeURIComponent(e)}${s}`}};var M=class{constructor(e){this.name=e}};var He=function(n,e,t,s){function h(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function a(o){try{f(s.next(o))}catch(u){r(u)}}function c(o){try{f(s.throw(o))}catch(u){r(u)}}function f(o){o.done?i(o.value):h(o.value).then(a,c)}f((s=s.apply(n,e||[])).next())})},H=class{constructor(e,t){this.getName=()=>this.metadata.name,this.callParams=s=>{let h="";if(!s)return h;for(let i of Object.entries(s)){let r=i[0],a=i[1]||"";if(a.sort)for(let c of a)h+=(h!==""?"&":"")+r+"="+encodeURIComponent(c);else h+=(h!==""?"&":"")+r+"="+encodeURIComponent(a)}return h},this.call=(s,h,i)=>He(this,void 0,void 0,function*(){let r="ExternalObject.call",a=this.session;return i=i||{},new Promise((c,f)=>{let o="";s&&(o=this.callParams(s)),i.businessCase&&(o+=`_bc=${encodeURIComponent(i.businessCase)}`);let u=i.method?i.method.toUpperCase():h?"POST":"GET",p={};i.contentType?p["content-type"]=i.contentType:h&&!(h instanceof FormData)&&(p["content-type"]=typeof h=="string"?"application/x-www-form-urlencoded":"application/json"),i.accept&&(p.accept=i.accept==="json"?"application/json":i.accept);let l=a.getBearerTokenHeader();l?p[a.authheader]=l:(l=a.getBasicAuthHeader(),l&&(p[a.authheader]=l));let d=a.parameters.url+(i.path&&i.path.startsWith("/")?i.path:this.path+(i.path?"/"+i.path:""))+(o!==""?"?"+o:""),y=h?typeof h=="string"||h instanceof FormData?h:JSON.stringify(h):void 0;a.debug("[simplicite.ExternalObject.call] "+u+" "+d+(y?" with "+y:"")),fetch(d,{method:u,headers:p,signal:AbortSignal.timeout(a.parameters.timeout),body:y}).then(m=>{let E=m.headers.get("content-type");a.debug(`[${r}] HTTP status = ${m.status}, response content type = ${E}`),E&&E.startsWith("application/json")?m.json().then(w=>{c.call(this,w,m.status,m.headers)}).catch(w=>{w=a.getError(w,void 0,r),(i.error||a.error).call(this,w)||f.call(this,w)}):E&&(E.startsWith("text/")||E.startsWith("application/yaml"))?m.text().then(w=>{c.call(this,w,m.status,m.headers)}).catch(w=>{w=a.getError(w,void 0,r),(i.error||a.error).call(this,w)||f.call(this,w)}):m.arrayBuffer().then(w=>{c.call(this,w,m.status,m.headers)}).catch(w=>{w=a.getError(w,void 0,r),(i.error||a.error).call(this,w)||f.call(this,w)})}).catch(m=>{m=a.getError(m,void 0,r),(i.error||a.error).call(this,m)||f.call(this,m)})})}),this.invoke=this.call,this.session=e,this.metadata=new M(t),this.path=`${this.session.parameters.extpath}/${encodeURIComponent(t)}`}};var Pe=ke(Ae(),1);var A=function(n,e,t,s){function h(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function a(o){try{f(s.next(o))}catch(u){r(u)}}function c(o){try{f(s.throw(o))}catch(u){r(u)}}function f(o){o.done?i(o.value):h(o.value).then(a,c)}f((s=s.apply(n,e||[])).next())})},v=class{constructor(e){this.constants=B,this.setUsername=o=>{this.username=o},this.setPassword=o=>{this.password=o},this.setAuthToken=o=>{this.authtoken=o},this.setAuthTokenExpiryDate=o=>{this.authtokenexpiry=o},this.isAuthTokenExpired=()=>this.authtokenexpiry?new Date>this.authtokenexpiry:!1,this.setAjaxKey=o=>{this.ajaxkey=o},this.getBusinessObjectCacheKey=(o,u)=>o+":"+(u||"js_"+o),this.clear=()=>{this.username=void 0,this.password=void 0,this.authtoken=void 0,this.authtokenexpiry=void 0,this.sessionid=void 0,this.grant=void 0,this.appinfo=void 0,this.sysinfo=void 0,this.devinfo=void 0,this.businessObjectCache=new Map},this.getBasicAuthHeader=()=>this.username&&this.password?"Basic "+Pe.Buffer.from(this.username+":"+this.password).toString("base64"):void 0,this.getBearerTokenHeader=()=>this.authtoken?"Bearer "+this.authtoken:void 0,this.getError=(o,u,p)=>{if(typeof o=="string")return{message:o,status:u||200,origin:p};if(o.response){if(typeof o.response=="string")return{message:o.response,status:u||200,origin:p};if(p)try{o.response.origin=p}catch{}return o.response}else{if(p)try{o.origin=p}catch{}return o}},this.compressData=o=>{let p=(typeof o=="string"?new Blob([o],{type:"text/plain"}).stream():new Blob([JSON.stringify(o)],{type:"application/json"}).stream()).pipeThrough(new CompressionStream("gzip"));return new Response(p).blob()},this.uncompressData=o=>{let u=o.stream().pipeThrough(new DecompressionStream("gzip"));return new Response(u).text()},this.sendRequest=(o,u,p,l)=>{let d="Session.sendRequest",y=u?"POST":"GET",m={};u&&(m["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),m.accept="application/json";let E=this.getBearerTokenHeader();E?m[this.authheader]=E:(E=this.getBasicAuthHeader(),E&&(m[this.authheader]=E));let w=this.parameters.url+(o||"/");this.ajaxkey&&(w+=(w.indexOf("?")>=0?"&":"?")+"_ajaxkey="+encodeURIComponent(this.ajaxkey));let T=u?typeof u=="string"?u:JSON.stringify(u):void 0;this.debug(`[${d}] ${y} ${w}${T?" with "+T:""}`),fetch(w,{method:y,headers:m,signal:AbortSignal.timeout(this.parameters.timeout),body:T}).then(R=>{p&&R.text().then(L=>{p.call(this,L,R.status,R.headers)})}).catch(R=>{let L=R.response&&R.response.status?R.response.status:void 0,ae=R.response&&R.response.data?R.response.data:R;if(l)l.call(this,this.getError(ae,L,d));else throw ae})},this.parseResponse=(o,u)=>{try{return u!==200?{type:"error",response:this.getError("HTTP status: "+u,u)}:typeof o=="object"?o:JSON.parse(o)}catch(p){return{type:"error",response:this.getError("Parsing error: "+p.message,u)}}},this.getHealth=o=>A(this,void 0,void 0,function*(){let u="Session.getHealth";return o=o||{},new Promise((p,l)=>{let d=`&full=${!!o.full}`;o.businessCase&&(d+=`&_bc=${encodeURIComponent(o.businessCase)}`),this.sendRequest(`${this.parameters.healthpath}${d}`,void 0,(y,m)=>{let E=this.parseResponse(y,m);if(this.debug(`[${u}] HTTP status = ${m}, response type = ${y}`),E.type==="error"){let w=this.getError(E.response,void 0,u);(o.error||this.error).call(this,w)||l.call(this,w)}else p.call(this,E)},y=>{y=this.getError(y,void 0,u),(o.error||this.error).call(this,y)||l.call(this,y)})})}),this.health=this.getHealth,this.login=o=>A(this,void 0,void 0,function*(){let u="Session.login";return o=o||{},new Promise((p,l)=>{(o.username||o.login)&&(o.password||o.pwd)?(this.clear(),this.username=o.username||o.login,this.password=o.password||o.pwd):(o.authtoken||o.authToken||o.token)&&(this.clear(),this.authtoken=o.authtoken||o.authToken||o.token),this.sendRequest(this.parameters.loginpath,void 0,(d,y)=>{let m=this.parseResponse(d,y);if(this.debug(`[${u}] HTTP status = ${y}, response type = ${m.type||(m.error?"error":"login")}`),m.type==="error"||m.error){let E=this.getError(m.response?m.response:m,void 0,u);(o.error||this.error).call(this,E)||l.call(this,E)}else{this.sessionid=m.response?m.response.id:m.sessionid,this.debug(`[${u}] Session ID = ${this.sessionid}`),this.username=m.response?m.response.login:m.login,this.username&&this.debug(`[${u}] Username = ${this.username}`),this.authtoken=m.response?m.response.authtoken:m.authtoken,this.authtoken&&this.debug(`[${u}] Auth token = ${this.authtoken}`);try{let E=new Date;E.setTime(m.response?m.response.authtokenexpiry:m.authtokenexpiry),this.authtokenexpiry=E}catch{this.authtokenexpiry=void 0}this.authtokenexpiry&&this.debug(`[${u}] Auth token expiry date = ${this.authtokenexpiry.toLocaleDateString()} ${this.authtokenexpiry.toLocaleTimeString()}`),this.grant=new O({login:this.username,userid:m.response?m.response.userid:m.userid,firstname:m.response?m.response.firstname:m.firstname,lastname:m.response?m.response.lastname:m.lastname,email:m.response?m.response.email:m.email}),p.call(this,m.response||m)}},d=>{d=this.getError(d,void 0,u),(o.error||this.error).call(this,d)||l.call(this,d)})})}),this.logout=o=>A(this,void 0,void 0,function*(){let u="Session.logout";return o=o||{},new Promise((p,l)=>{this.sendRequest(this.parameters.logoutpath,void 0,(d,y)=>{let m=this.parseResponse(d,y);if(this.debug(`[${u}] HTTP status = ${y}, response type = ${m.type||(m.error?"error":"logout")}`),m.type==="error"){let E=this.getError(m.response?m.response:m,void 0,u);(o.error||this.error).call(this,E)||l.call(this,E)}else this.clear(),this.username=this.parameters.username,this.password=this.parameters.password,this.authtoken=this.parameters.authtoken,p.call(this,m.response||m)},d=>{d=this.getError(d,void 0,u),d.status===401&&(this.authtoken=void 0),(o.error||this.error).call(this,d)||l.call(this,d)})})}),this.getGrant=o=>A(this,void 0,void 0,function*(){let u="Session.getGrant";return o=o||{},new Promise((p,l)=>{let d="&web=true",y=!!o.includeTexts||!!o.texts;d+=`&texts=${encodeURIComponent(y)}`;let m=!!o.inlinePicture||!!o.picture;m&&(d+="&inline_picture=true"),(!!o.includeSysparams||!!o.sysparams)&&(d+="&sysparams=true"),this.sendRequest(`${this.getPath("getgrant",o)}${d}`,void 0,(w,T)=>{let R=this.parseResponse(w,T);if(this.debug(`[${u}] HTTP status = ${T}, response type = ${R.type}`),R.type==="error"){let L=this.getError(R.response,void 0,u);(o.error||this.error).call(this,L)||l.call(this,L)}else this.grant=new O(R.response),m&&(this.grant.picture=new b(this.grant.picture)),y&&(this.grant.texts=Object.assign(new Map,this.grant.texts)),p.call(this,this.grant)},w=>{w=this.getError(w,void 0,u),(o.error||this.error).call(this,w)||l.call(this,w)})})}),this.changePassword=(o,u)=>A(this,void 0,void 0,function*(){let p="Session.changePassword";return u=u||{},new Promise((l,d)=>{this.sendRequest(`${this.getPath("setpassword",u)}&password=${encodeURIComponent(o)}`,void 0,(y,m)=>{let E=this.parseResponse(y,m);if(this.debug(`[${p}] HTTP status = ${m}, response type = ${E.type}`),E.type==="error"){let w=this.getError(E.response,void 0,p);(u.error||this.error).call(this,w)||d.call(this,w)}else l.call(this,E.response)},y=>{y=this.getError(y,void 0,p),(u.error||this.error).call(this,y)||d.call(this,y)})})}),this.getAppInfo=o=>A(this,void 0,void 0,function*(){let u="Session.getAppInfo";return o=o||{},new Promise((p,l)=>{this.sendRequest(this.getPath("getinfo",o),void 0,(d,y)=>{let m=this.parseResponse(d,y);if(this.debug(`[${u}] HTTP status = ${y}, response type = ${m.type}`),m.type==="error"){let E=this.getError(m.response,void 0,u);(o.error||this.error).call(this,E)||l.call(this,E)}else this.appinfo=m.response,p.call(this,this.appinfo)},d=>{d=this.getError(d,void 0,u),(o.error||this.error).call(this,d)||l.call(this,d)})})}),this.getSysInfo=o=>A(this,void 0,void 0,function*(){let u="Session.getSysInfo";return o=o||{},new Promise((p,l)=>{this.sendRequest(this.getPath("sysinfo",o),void 0,(d,y)=>{let m=this.parseResponse(d,y);if(this.debug(`[${u}] HTTP status = ${y}, response type = ${m.type}`),m.type==="error"){let E=this.getError(m.response,void 0,u);(o.error||this.error).call(this,E)||l.call(this,E)}else this.sysinfo=m.response,p.call(this,this.sysinfo)},d=>{d=this.getError(d,void 0,u),(o.error||this.error).call(this,d)||l.call(this,d)})})}),this.getDevInfo=(o,u)=>A(this,void 0,void 0,function*(){let p="Session.getDevInfo";return u=u||{},new Promise((l,d)=>{let y="";o&&(y+=`&module=${encodeURIComponent(o)}`),this.sendRequest(`${this.getPath("devinfo",u)}${y}`,void 0,(m,E)=>{let w=this.parseResponse(m,E);if(this.debug(`[${p}] HTTP status = ${E}, response type = ${w.type}`),w.type==="error"){let T=this.getError(w.response,void 0,p);(u.error||this.error).call(this,T)||d.call(this,T)}else o||(this.devinfo=w.response),l.call(this,w.response)},m=>{m=this.getError(m,void 0,p),(u.error||this.error).call(this,m)||d.call(this,m)})})}),this.getNews=o=>A(this,void 0,void 0,function*(){let u="Session.getNews";return o=o||{},new Promise((p,l)=>{let d="";(!!o.inlineImages||!!o.images)&&(d+="&inline_images=true"),this.sendRequest(`${this.getPath("news",o)}${d}`,void 0,(m,E)=>{let w=this.parseResponse(m,E);if(this.debug(`[${u}] HTTP status = ${E}, response type = ${w.type}`),w.type==="error"){let T=this.getError(w.response,void 0,u);(o.error||this.error).call(this,T)||l.call(this,T)}else{this.news=w.response;for(let T of this.news)T.image=new b(T.image);p.call(this,this.news)}},m=>{m=this.getError(m,void 0,u),(o.error||this.error).call(this,m)||l.call(this,m)})})}),this.indexSearch=(o,u,p)=>A(this,void 0,void 0,function*(){let l="Session.indexSearch";return p=p||{},new Promise((d,y)=>{let m=`&request=${encodeURIComponent(o||"")}`;u&&(m+=`&object=${encodeURIComponent(u)}`),p.metadata===!0&&(m+="&_md=true"),p.context&&(m+=`&context=${encodeURIComponent(p.context)}`),this.sendRequest(`${this.getPath("indexsearch",p)}${m}`,void 0,(E,w)=>{let T=this.parseResponse(E,w);if(this.debug(`[${l}] HTTP status = ${w}, response type = ${T.type}`),T.type==="error"){let R=this.getError(T.response,void 0,l);(p.error||this.error).call(this,R)||y.call(this,R)}else d.call(this,T.response)},E=>{E=this.getError(E,void 0,l),(p.error||this.error).call(this,E)||y.call(this,E)})})}),this.getBusinessObject=(o,u)=>{let p=this.getBusinessObjectCacheKey(o,u),l=this.businessObjectCache[p];return l||(l=new k(this,o,u),this.businessObjectCache[p]=l),l},this.getExternalObject=o=>new H(this,o),this.getResourceURL=(o,u,p,l)=>this.parameters.url+this.parameters.respath+"?code="+encodeURIComponent(o)+"&type="+encodeURIComponent(u||"IMG")+(p?"&object="+encodeURIComponent(p):"")+(l?"&objid="+encodeURIComponent(l):"")+(this.authtoken?"_x_simplicite_authorization_="+encodeURIComponent(this.authtoken):""),e=e||{};let t=typeof globalThis.Simplicite<"u";this.endpoint=e.endpoint||(t?globalThis.Simplicite.ENDPOINT:"api"),this.authheader=e.authheader||this.constants.DEFAULT_AUTH_HEADER,this.log=e.logHandler||((...o)=>{console.log(o)}),this.info=e.infoHandler||((...o)=>{o&&o.length===1&&typeof o[0]=="string"?console.info(`INFO - ${o[0]}`):console.info("INFO",o)}),this.warn=e.warningHandler||((...o)=>{o&&o.length===1&&typeof o[0]=="string"?console.warn(`WARN - ${o[0]}`):console.warn(`WARN${o&&o.length>0&&o[0].message?` - ${o[0].message}`:""}`,o)}),this.error=e.errorHandler||((...o)=>{o&&o.length===1&&typeof o[0]=="string"?console.error(`ERROR - ${o[0]}`):console.error(`ERROR${o&&o.length>0&&o[0].message?` - ${o[0].message}`:""}`,o)}),this.debugMode=!!e.debug,this.debug=e.debugHandler||((...o)=>{this.debugMode&&(o&&o.length===1&&typeof o[0]=="string"?console.info(`DEBUG - ${o[0]}`):console.log("DEBUG",o))});let s=e.url||t&&globalThis.Simplicite.URL||globalThis.window&&globalThis.window.location.origin;if(this.debug("[simplicite] URL parameter = "+s),s)try{e.scheme=s.replace(/:.*$/,"");let o=s.replace(new RegExp("^"+e.scheme+"://"),"").split(":");if(o.length===1)e.host=o[0].replace(/\/.*$/,""),e.port=e.scheme==="http"?80:443,e.root=o[0].replace(new RegExp("^"+e.host+"/?"),"");else{if(e.host=o[0],e.port=parseInt(o[1].replace(/\/.*$/,""),10),isNaN(e.port))throw new Error("Incorrect port");e.root=o[1].replace(new RegExp("^"+e.port+"/?"),"")}e.root==="/"&&(e.root="")}catch(o){this.error("Unable to parse URL ["+s+"]: "+o.message);return}let h=e.scheme||(e.port===443?"https":"http");if(h!=="http"&&h!=="https"){this.error("Incorrect scheme ["+e.scheme+"]");return}let i=e.host||"localhost",r=e.port||8080,a=e.root||"";a==="/"&&(a="");let c=h+"://"+i;(h==="http"&&r!==80||h==="https"&&r!==443)&&(c+=":"+r),a!==""&&(c+=a.startsWith("/")?a:"/"+a),this.debug("[simplicite] Base URL = "+c);let f=this.endpoint==="uipublic"?"":"/"+this.endpoint;if(this.parameters={scheme:h,host:i,port:r,root:a,url:c,username:e.username,password:e.password,authtoken:e.authtoken,timeout:(e.timeout||30)*1e3,compress:e.compress||!0,healthpath:(f==="/ui"?f:"")+"/health?format=json",loginpath:f==="/api"?"/api/login?format=json":f+"/json/app?action=session",logoutpath:f==="/api"?"/api/logout?format=json":f+"/json/app?action=logout",apppath:f+"/json/app",objpath:f+"/json/obj",extpath:f+"/ext",docpath:f+"/raw/document",respath:"/resource"},this.username=e.username||e.login,this.password=e.password||e.pwd,this.authtoken=e.authtoken||e.token,!this.authtoken&&t){let o=globalThis.window?globalThis.window.localStorage:null;this.authtoken=o?o.getItem("_authToken"):globalThis.Simplicite.AUTH_TOKEN}if(this.ajaxkey=e.ajaxkey,!this.ajaxkey&&t){let o=globalThis.window?globalThis.window.localStorage:null;this.ajaxkey=o?o.getItem("_ajaxKey"):globalThis.Simplicite.AJAX_KEY}this.businessObjectCache=new Map}getPath(e,t){let s=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.parameters.apppath}?action=${encodeURIComponent(e)}${s}`}};var wt=n=>new v(n),G={constants:B,session:wt,Session:v,Doc:b,Grant:O,BusinessObjectMetadata:D,BusinessObject:k,ExternalObjectMetadata:M,ExternalObject:H};if(typeof globalThis<"u")globalThis.simplicite=G;else if(typeof self<"u")self.simplicite=G;else if(typeof window<"u")window.simplicite=G;else if(typeof global<"u")global.simplicite=G;else throw new Error("Unable to find global object");})();
/**
 * Simplicite(R) platform Javascript API client module (for node.js and browser).
 * @module simplicite
 * @version 3.1.0
 * @license Apache-2.0
 */
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
//# sourceMappingURL=simplicite.min.js.map
