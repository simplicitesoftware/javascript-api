var Re=Object.create;var ee=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Be=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var Y=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Fe=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Be(e))!Ce.call(i,r)&&r!==t&&ee(i,r,{get:()=>e[r],enumerable:!(n=Ie(e,r))||n.enumerable});return i};var Ue=(i,e,t)=>(t=i!=null?Re(Pe(i)):{},Fe(e||!i||!i.__esModule?ee(t,"default",{value:i,enumerable:!0}):t,i));var ie=Y(H=>{"use strict";H.byteLength=_e;H.toByteArray=Oe;H.fromByteArray=Le;var T=[],x=[],Ae=typeof Uint8Array<"u"?Uint8Array:Array,V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(F=0,te=V.length;F<te;++F)T[F]=V[F],x[V.charCodeAt(F)]=F;var F,te;x[45]=62;x[95]=63;function ne(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=i.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function _e(i){var e=ne(i),t=e[0],n=e[1];return(t+n)*3/4-n}function $e(i,e,t){return(e+t)*3/4-t}function Oe(i){var e,t=ne(i),n=t[0],r=t[1],s=new Ae($e(i,n,r)),o=0,a=r>0?n-4:n,h;for(h=0;h<a;h+=4)e=x[i.charCodeAt(h)]<<18|x[i.charCodeAt(h+1)]<<12|x[i.charCodeAt(h+2)]<<6|x[i.charCodeAt(h+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return r===2&&(e=x[i.charCodeAt(h)]<<2|x[i.charCodeAt(h+1)]>>4,s[o++]=e&255),r===1&&(e=x[i.charCodeAt(h)]<<10|x[i.charCodeAt(h+1)]<<4|x[i.charCodeAt(h+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Se(i){return T[i>>18&63]+T[i>>12&63]+T[i>>6&63]+T[i&63]}function Ne(i,e,t){for(var n,r=[],s=e;s<t;s+=3)n=(i[s]<<16&16711680)+(i[s+1]<<8&65280)+(i[s+2]&255),r.push(Se(n));return r.join("")}function Le(i){for(var e,t=i.length,n=t%3,r=[],s=16383,o=0,a=t-n;o<a;o+=s)r.push(Ne(i,o,o+s>a?a:o+s));return n===1?(e=i[t-1],r.push(T[e>>2]+T[e<<4&63]+"==")):n===2&&(e=(i[t-2]<<8)+i[t-1],r.push(T[e>>10]+T[e>>4&63]+T[e<<2&63]+"=")),r.join("")}});var re=Y(X=>{X.read=function(i,e,t,n,r){var s,o,a=r*8-n-1,h=(1<<a)-1,c=h>>1,u=-7,p=t?r-1:0,f=t?-1:1,g=i[e+p];for(p+=f,s=g&(1<<-u)-1,g>>=-u,u+=a;u>0;s=s*256+i[e+p],p+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+i[e+p],p+=f,u-=8);if(s===0)s=1-c;else{if(s===h)return o?NaN:(g?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-c}return(g?-1:1)*o*Math.pow(2,s-n)};X.write=function(i,e,t,n,r,s){var o,a,h,c=s*8-r-1,u=(1<<c)-1,p=u>>1,f=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:s-1,y=n?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+p>=1?e+=f/h:e+=f*Math.pow(2,1-p),e*h>=2&&(o++,h/=2),o+p>=u?(a=0,o=u):o+p>=1?(a=(e*h-1)*Math.pow(2,r),o=o+p):(a=e*Math.pow(2,p-1)*Math.pow(2,r),o=0));r>=8;i[t+g]=a&255,g+=y,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;i[t+g]=o&255,g+=y,o/=256,c-=8);i[t+g-y]|=B*128}});var xe=Y(D=>{"use strict";var G=ie(),N=re(),se=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;D.Buffer=l;D.SlowBuffer=qe;D.INSPECT_MAX_BYTES=50;var j=2147483647;D.kMaxLength=j;l.TYPED_ARRAY_SUPPORT=De();!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function De(){try{let i=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(i,e),i.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}});Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function I(i){if(i>j)throw new RangeError('The value "'+i+'" is invalid for option "size"');let e=new Uint8Array(i);return Object.setPrototypeOf(e,l.prototype),e}function l(i,e,t){if(typeof i=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return z(i)}return he(i,e,t)}l.poolSize=8192;function he(i,e,t){if(typeof i=="string")return Me(i,e);if(ArrayBuffer.isView(i))return He(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(R(i,ArrayBuffer)||i&&R(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(R(i,SharedArrayBuffer)||i&&R(i.buffer,SharedArrayBuffer)))return K(i,e,t);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=i.valueOf&&i.valueOf();if(n!=null&&n!==i)return l.from(n,e,t);let r=je(i);if(r)return r;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return l.from(i[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}l.from=function(i,e,t){return he(i,e,t)};Object.setPrototypeOf(l.prototype,Uint8Array.prototype);Object.setPrototypeOf(l,Uint8Array);function ce(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function ke(i,e,t){return ce(i),i<=0?I(i):e!==void 0?typeof t=="string"?I(i).fill(e,t):I(i).fill(e):I(i)}l.alloc=function(i,e,t){return ke(i,e,t)};function z(i){return ce(i),I(i<0?0:Z(i)|0)}l.allocUnsafe=function(i){return z(i)};l.allocUnsafeSlow=function(i){return z(i)};function Me(i,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=le(i,e)|0,n=I(t),r=n.write(i,e);return r!==t&&(n=n.slice(0,r)),n}function W(i){let e=i.length<0?0:Z(i.length)|0,t=I(e);for(let n=0;n<e;n+=1)t[n]=i[n]&255;return t}function He(i){if(R(i,Uint8Array)){let e=new Uint8Array(i);return K(e.buffer,e.byteOffset,e.byteLength)}return W(i)}function K(i,e,t){if(e<0||i.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(i):t===void 0?n=new Uint8Array(i,e):n=new Uint8Array(i,e,t),Object.setPrototypeOf(n,l.prototype),n}function je(i){if(l.isBuffer(i)){let e=Z(i.length)|0,t=I(e);return t.length===0||i.copy(t,0,0,e),t}if(i.length!==void 0)return typeof i.length!="number"||v(i.length)?I(0):W(i);if(i.type==="Buffer"&&Array.isArray(i.data))return W(i.data)}function Z(i){if(i>=j)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+j.toString(16)+" bytes");return i|0}function qe(i){return+i!=i&&(i=0),l.alloc(+i)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype};l.compare=function(e,t){if(R(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),R(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let s=0,o=Math.min(n,r);s<o;++s)if(e[s]!==t[s]){n=e[s],r=t[s];break}return n<r?-1:r<n?1:0};l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let r=l.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(R(o,Uint8Array))s+o.length>r.length?(l.isBuffer(o)||(o=l.from(o)),o.copy(r,s)):Uint8Array.prototype.set.call(r,o,s);else if(l.isBuffer(o))o.copy(r,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return r};function le(i,e){if(l.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||R(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);let t=i.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let r=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return J(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return we(i).length;default:if(r)return n?-1:J(i).length;e=(""+e).toLowerCase(),r=!0}}l.byteLength=le;function Ye(i,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(i||(i="utf8");;)switch(i){case"hex":return ve(this,e,t);case"utf8":case"utf-8":return fe(this,e,t);case"ascii":return Ze(this,e,t);case"latin1":case"binary":return Qe(this,e,t);case"base64":return Je(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),n=!0}}l.prototype._isBuffer=!0;function U(i,e,t){let n=i[e];i[e]=i[t],i[t]=n}l.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)U(this,t,t+1);return this};l.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)U(this,t,t+3),U(this,t+1,t+2);return this};l.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)U(this,t,t+7),U(this,t+1,t+6),U(this,t+2,t+5),U(this,t+3,t+4);return this};l.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?fe(this,0,e):Ye.apply(this,arguments)};l.prototype.toLocaleString=l.prototype.toString;l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0};l.prototype.inspect=function(){let e="",t=D.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};se&&(l.prototype[se]=l.prototype.inspect);l.prototype.compare=function(e,t,n,r,s){if(R(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),r===void 0&&(r=0),s===void 0&&(s=this.length),t<0||n>e.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&t>=n)return 0;if(r>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,s>>>=0,this===e)return 0;let o=s-r,a=n-t,h=Math.min(o,a),c=this.slice(r,s),u=e.slice(t,n);for(let p=0;p<h;++p)if(c[p]!==u[p]){o=c[p],a=u[p];break}return o<a?-1:a<o?1:0};function pe(i,e,t,n,r){if(i.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,v(t)&&(t=r?0:i.length-1),t<0&&(t=i.length+t),t>=i.length){if(r)return-1;t=i.length-1}else if(t<0)if(r)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,n)),l.isBuffer(e))return e.length===0?-1:oe(i,e,t,n,r);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?r?Uint8Array.prototype.indexOf.call(i,e,t):Uint8Array.prototype.lastIndexOf.call(i,e,t):oe(i,[e],t,n,r);throw new TypeError("val must be string, number or Buffer")}function oe(i,e,t,n,r){let s=1,o=i.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(i.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function h(u,p){return s===1?u[p]:u.readUInt16BE(p*s)}let c;if(r){let u=-1;for(c=t;c<o;c++)if(h(i,c)===h(e,u===-1?0:c-u)){if(u===-1&&(u=c),c-u+1===a)return u*s}else u!==-1&&(c-=c-u),u=-1}else for(t+a>o&&(t=o-a),c=t;c>=0;c--){let u=!0;for(let p=0;p<a;p++)if(h(i,c+p)!==h(e,p)){u=!1;break}if(u)return c}return-1}l.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};l.prototype.indexOf=function(e,t,n){return pe(this,e,t,n,!0)};l.prototype.lastIndexOf=function(e,t,n){return pe(this,e,t,n,!1)};function Ve(i,e,t,n){t=Number(t)||0;let r=i.length-t;n?(n=Number(n),n>r&&(n=r)):n=r;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(v(a))return o;i[t+o]=a}return o}function Xe(i,e,t,n){return q(J(e,i.length-t),i,t,n)}function Ge(i,e,t,n){return q(rt(e),i,t,n)}function We(i,e,t,n){return q(we(e),i,t,n)}function Ke(i,e,t,n){return q(st(e,i.length-t),i,t,n)}l.prototype.write=function(e,t,n,r){if(t===void 0)r="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")r=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,r===void 0&&(r="utf8")):(r=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let o=!1;for(;;)switch(r){case"hex":return Ve(this,e,t,n);case"utf8":case"utf-8":return Xe(this,e,t,n);case"ascii":case"latin1":case"binary":return Ge(this,e,t,n);case"base64":return We(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ke(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}};l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Je(i,e,t){return e===0&&t===i.length?G.fromByteArray(i):G.fromByteArray(i.slice(e,t))}function fe(i,e,t){t=Math.min(i.length,t);let n=[],r=e;for(;r<t;){let s=i[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a<=t){let h,c,u,p;switch(a){case 1:s<128&&(o=s);break;case 2:h=i[r+1],(h&192)===128&&(p=(s&31)<<6|h&63,p>127&&(o=p));break;case 3:h=i[r+1],c=i[r+2],(h&192)===128&&(c&192)===128&&(p=(s&15)<<12|(h&63)<<6|c&63,p>2047&&(p<55296||p>57343)&&(o=p));break;case 4:h=i[r+1],c=i[r+2],u=i[r+3],(h&192)===128&&(c&192)===128&&(u&192)===128&&(p=(s&15)<<18|(h&63)<<12|(c&63)<<6|u&63,p>65535&&p<1114112&&(o=p))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),r+=a}return ze(n)}var ae=4096;function ze(i){let e=i.length;if(e<=ae)return String.fromCharCode.apply(String,i);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,i.slice(n,n+=ae));return t}function Ze(i,e,t){let n="";t=Math.min(i.length,t);for(let r=e;r<t;++r)n+=String.fromCharCode(i[r]&127);return n}function Qe(i,e,t){let n="";t=Math.min(i.length,t);for(let r=e;r<t;++r)n+=String.fromCharCode(i[r]);return n}function ve(i,e,t){let n=i.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let r="";for(let s=e;s<t;++s)r+=ot[i[s]];return r}function et(i,e,t){let n=i.slice(e,t),r="";for(let s=0;s<n.length-1;s+=2)r+=String.fromCharCode(n[s]+n[s+1]*256);return r}l.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r};function m(i,e,t){if(i%1!==0||i<0)throw new RangeError("offset is not uint");if(i+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||m(e,t,this.length);let r=this[e],s=1,o=0;for(;++o<t&&(s*=256);)r+=this[e+o]*s;return r};l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||m(e,t,this.length);let r=this[e+--t],s=1;for(;t>0&&(s*=256);)r+=this[e+--t]*s;return r};l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e=e>>>0,t||m(e,1,this.length),this[e]};l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||m(e,2,this.length),this[e]|this[e+1]<<8};l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||m(e,2,this.length),this[e]<<8|this[e+1]};l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||m(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||m(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};l.prototype.readBigUInt64LE=P(function(e){e=e>>>0,L(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&k(e,this.length-8);let r=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(r)+(BigInt(s)<<BigInt(32))});l.prototype.readBigUInt64BE=P(function(e){e=e>>>0,L(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&k(e,this.length-8);let r=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(r)<<BigInt(32))+BigInt(s)});l.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||m(e,t,this.length);let r=this[e],s=1,o=0;for(;++o<t&&(s*=256);)r+=this[e+o]*s;return s*=128,r>=s&&(r-=Math.pow(2,8*t)),r};l.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||m(e,t,this.length);let r=t,s=1,o=this[e+--r];for(;r>0&&(s*=256);)o+=this[e+--r]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};l.prototype.readInt8=function(e,t){return e=e>>>0,t||m(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};l.prototype.readInt16LE=function(e,t){e=e>>>0,t||m(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};l.prototype.readInt16BE=function(e,t){e=e>>>0,t||m(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};l.prototype.readInt32LE=function(e,t){return e=e>>>0,t||m(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};l.prototype.readInt32BE=function(e,t){return e=e>>>0,t||m(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};l.prototype.readBigInt64LE=P(function(e){e=e>>>0,L(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&k(e,this.length-8);let r=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});l.prototype.readBigInt64BE=P(function(e){e=e>>>0,L(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&k(e,this.length-8);let r=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});l.prototype.readFloatLE=function(e,t){return e=e>>>0,t||m(e,4,this.length),N.read(this,e,!0,23,4)};l.prototype.readFloatBE=function(e,t){return e=e>>>0,t||m(e,4,this.length),N.read(this,e,!1,23,4)};l.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||m(e,8,this.length),N.read(this,e,!0,52,8)};l.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||m(e,8,this.length),N.read(this,e,!1,52,8)};function w(i,e,t,n,r,s){if(!l.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>i.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t=t>>>0,n=n>>>0,!r){let a=Math.pow(2,8*n)-1;w(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t=t>>>0,n=n>>>0,!r){let a=Math.pow(2,8*n)-1;w(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,1,255,0),this[t]=e&255,t+1};l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function ge(i,e,t,n,r){be(e,n,r,i,t,7);let s=Number(e&BigInt(4294967295));i[t++]=s,s=s>>8,i[t++]=s,s=s>>8,i[t++]=s,s=s>>8,i[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return i[t++]=o,o=o>>8,i[t++]=o,o=o>>8,i[t++]=o,o=o>>8,i[t++]=o,t}function ye(i,e,t,n,r){be(e,n,r,i,t,7);let s=Number(e&BigInt(4294967295));i[t+7]=s,s=s>>8,i[t+6]=s,s=s>>8,i[t+5]=s,s=s>>8,i[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return i[t+3]=o,o=o>>8,i[t+2]=o,o=o>>8,i[t+1]=o,o=o>>8,i[t]=o,t+8}l.prototype.writeBigUInt64LE=P(function(e,t=0){return ge(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});l.prototype.writeBigUInt64BE=P(function(e,t=0){return ye(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t=t>>>0,!r){let h=Math.pow(2,8*n-1);w(this,e,t,n,h-1,-h)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t=t>>>0,!r){let h=Math.pow(2,8*n-1);w(this,e,t,n,h-1,-h)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};l.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};l.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};l.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};l.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};l.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||w(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};l.prototype.writeBigInt64LE=P(function(e,t=0){return ge(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});l.prototype.writeBigInt64BE=P(function(e,t=0){return ye(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function de(i,e,t,n,r,s){if(t+n>i.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function me(i,e,t,n,r){return e=+e,t=t>>>0,r||de(i,e,t,4,34028234663852886e22,-34028234663852886e22),N.write(i,e,t,n,23,4),t+4}l.prototype.writeFloatLE=function(e,t,n){return me(this,e,t,!0,n)};l.prototype.writeFloatBE=function(e,t,n){return me(this,e,t,!1,n)};function Ee(i,e,t,n,r){return e=+e,t=t>>>0,r||de(i,e,t,8,17976931348623157e292,-17976931348623157e292),N.write(i,e,t,n,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,n){return Ee(this,e,t,!0,n)};l.prototype.writeDoubleBE=function(e,t,n){return Ee(this,e,t,!1,n)};l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!r&&r!==0&&(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let s=r-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),s};l.prototype.fill=function(e,t,n,r){if(typeof e=="string"){if(typeof t=="string"?(r=t,t=0,n=this.length):typeof n=="string"&&(r=n,n=this.length),r!==void 0&&typeof r!="string")throw new TypeError("encoding must be a string");if(typeof r=="string"&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(e.length===1){let o=e.charCodeAt(0);(r==="utf8"&&o<128||r==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=l.isBuffer(e)?e:l.from(e,r),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var S={};function Q(i,e,t){S[i]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${i}]`,this.stack,delete this.name}get code(){return i}set code(r){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:r,writable:!0})}toString(){return`${this.name} [${i}]: ${this.message}`}}}Q("ERR_BUFFER_OUT_OF_BOUNDS",function(i){return i?`${i} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Q("ERR_INVALID_ARG_TYPE",function(i,e){return`The "${i}" argument must be of type number. Received type ${typeof e}`},TypeError);Q("ERR_OUT_OF_RANGE",function(i,e,t){let n=`The value of "${i}" is out of range.`,r=t;return Number.isInteger(t)&&Math.abs(t)>2**32?r=ue(String(t)):typeof t=="bigint"&&(r=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(r=ue(r)),r+="n"),n+=` It must be ${e}. Received ${r}`,n},RangeError);function ue(i){let e="",t=i.length,n=i[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${i.slice(t-3,t)}${e}`;return`${i.slice(0,t)}${e}`}function tt(i,e,t){L(e,"offset"),(i[e]===void 0||i[e+t]===void 0)&&k(e,i.length-(t+1))}function be(i,e,t,n,r,s){if(i>t||i<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new S.ERR_OUT_OF_RANGE("value",a,i)}tt(n,r,s)}function L(i,e){if(typeof i!="number")throw new S.ERR_INVALID_ARG_TYPE(e,"number",i)}function k(i,e,t){throw Math.floor(i)!==i?(L(i,t),new S.ERR_OUT_OF_RANGE(t||"offset","an integer",i)):e<0?new S.ERR_BUFFER_OUT_OF_BOUNDS:new S.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,i)}var nt=/[^+/0-9A-Za-z-_]/g;function it(i){if(i=i.split("=")[0],i=i.trim().replace(nt,""),i.length<2)return"";for(;i.length%4!==0;)i=i+"=";return i}function J(i,e){e=e||1/0;let t,n=i.length,r=null,s=[];for(let o=0;o<n;++o){if(t=i.charCodeAt(o),t>55295&&t<57344){if(!r){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),r=t;continue}t=(r-55296<<10|t-56320)+65536}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function rt(i){let e=[];for(let t=0;t<i.length;++t)e.push(i.charCodeAt(t)&255);return e}function st(i,e){let t,n,r,s=[];for(let o=0;o<i.length&&!((e-=2)<0);++o)t=i.charCodeAt(o),n=t>>8,r=t%256,s.push(r),s.push(n);return s}function we(i){return G.toByteArray(it(i))}function q(i,e,t,n){let r;for(r=0;r<n&&!(r+t>=e.length||r>=i.length);++r)e[r+t]=i[r];return r}function R(i,e){return i instanceof e||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===e.name}function v(i){return i!==i}var ot=function(){let i="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let r=0;r<16;++r)e[n+r]=i[t]+i[r]}return e}();function P(i){return typeof BigInt>"u"?at:i}function at(){throw new Error("BigInt not supported")}});var E={MODULE_VERSION:"3.1.2",DEFAULT_ROW_ID_NAME:"row_id",DEFAULT_ROW_ID:"0",CONTEXT_NONE:0,CONTEXT_SEARCH:1,CONTEXT_LIST:2,CONTEXT_CREATE:3,CONTEXT_COPY:4,CONTEXT_UPDATE:5,CONTEXT_DELETE:6,CONTEXT_GRAPH:7,CONTEXT_CROSSTAB:8,CONTEXT_PRINTTMPL:9,CONTEXT_UPDATEALL:10,CONTEXT_REFSELECT:11,CONTEXT_DATAMAPSELECT:12,CONTEXT_PREVALIDATE:13,CONTEXT_POSTVALIDATE:14,CONTEXT_STATETRANSITION:15,CONTEXT_EXPORT:16,CONTEXT_IMPORT:17,CONTEXT_ASSOCIATE:18,CONTEXT_PANELLIST:19,CONTEXT_ACTION:20,CONTEXT_AGENDA:21,CONTEXT_PLACEMAP:22,TYPE_ID:0,TYPE_INT:1,TYPE_FLOAT:2,TYPE_STRING:3,TYPE_DATE:4,TYPE_DATETIME:5,TYPE_TIME:6,TYPE_ENUM:7,TYPE_BOOLEAN:8,TYPE_PASSWORD:9,TYPE_URL:10,TYPE_HTML:11,TYPE_EMAIL:12,TYPE_LONG_STRING:13,TYPE_ENUM_MULTI:14,TYPE_REGEXP:15,TYPE_DOC:17,TYPE_FLOAT_EMPTY:18,TYPE_EXTFILE:19,TYPE_IMAGE:20,TYPE_NOTEPAD:21,TYPE_PHONENUM:22,TYPE_COLOR:23,TYPE_OBJECT:24,TYPE_GEOCOORDS:25,TYPE_BIGDECIMAL:26,TYPES:["ID","integer","decimal","string","date","datetime","time","enum","boolean","password","url","html","email","text","multienum","regexp","undefined","document","simpledecimal","extfile","picture","notepad","phonenum","color","object","geocoords","bigdecimal"],VIS_NOT:0,VIS_HIDDEN:0,VIS_LIST:1,VIS_FORM:2,VIS_BOTH:3,SEARCH_NONE:0,SEARCH_MONO:1,SEARCH_MULTI_CHECK:2,SEARCH_MULTI_LIST:3,SEARCH_PERIOD:4,TRUE:"1",FALSE:"0",ERRLEVEL_FATAL:1,ERRLEVEL_ERROR:2,ERRLEVEL_WARNING:3,RESOURCE_TYPE_IMAGE:"IMG",RESOURCE_TYPE_ICON:"ICO",RESOURCE_TYPE_STYLESHEET:"CSS",RESOURCE_TYPE_JAVASCRIPT:"JS",DEFAULT_AUTH_HEADER:"authorization",SIMPLICITE_AUTH_HEADER:"x-simplicite-authorization"};var b=class{constructor(e){Object.assign(this,typeof e=="string"?{name:e}:e||{}),this.filename&&!this.name&&(this.name=this.filename,this.filename=void 0)}id;mime;name;content;thumbnail;getId(){return this.id}getMIMEType(){return this.mime}getMimeType=this.getMIMEType;setMIMEType(e){return this.mime=e,this}setMimeType=this.setMIMEType;getName(){return this.name}getFileName=this.getName;getFilename=this.getName;setName(e){return this.name=e,this}setFileName=this.setName;setFilename=this.setName;cleanContent(e){return e.startsWith("data:")?e.replace(/data:.*;base64,/,""):e}getContent(){return this.content}getThumbnail(){return this.thumbnail}getBuffer(e){return Buffer.from(e,"base64")}getContentAsArrayBuffer(){return this.getBuffer(this.content).buffer}getThumbnailAsArrayBuffer(){return this.getBuffer(this.thumbnail||"").buffer}getContentAsText(){return this.getBuffer(this.content).toString("utf-8")}setContent(e){return this.content=this.cleanContent(e),this}setContentFromText(e){return this.content=Buffer.from(e,"utf-8").toString("base64"),this}getDataURL(e){if(this.content)return"data:"+this.mime+";base64,"+(e&&this.thumbnail?this.thumbnail:this.content)}async load(e){return new Promise((t,n)=>{try{if(e){this.name=e.name,this.mime=e.type;let r=new FileReader;r.onload=()=>{this.content=r.result?this.cleanContent(r.result):"",t(this)},r.readAsDataURL(e)}else this.content="",t(this)}catch(r){n(r)}})}getValue(){return{id:this.id,name:this.filename&&!this.name?this.filename:this.name,mime:this.mime,content:this.content,thumbnail:this.thumbnail}}};var C=class{constructor(e){Object.assign(this,e)}userid;login;lang;email;firstname;lastname;picture;responsibilities;apps;texts;sysparams;getUserId(){return this.userid}getUsername(){return this.login}getLogin=this.getUsername;getLang(){return this.lang}getEmail(){return this.email}getFirstname(){return this.firstname}getFirstName=this.getFirstname;getLastname(){return this.lastname}getLastName=this.getLastname;getPictureURL(){if(this.picture)return"data:"+this.picture.mime+";base64,"+this.picture.content}hasResponsibility(e){return this.responsibilities&&this.responsibilities.indexOf(e)!==-1}hasScope(e){if(this.apps){for(let t of this.apps)if(t.home===e)return!0}return!1}getSystemParameter(e){return this.sysparams&&this.sysparams[e]||""}getSysParam=this.getSystemParameter;T(e){return this.texts&&this.texts[e]||""}};var A=class{constructor(e,t){this.name=e,this.instance=t,this.rowidfield=E.DEFAULT_ROW_ID_NAME,this.label=e,this.help="",this.fields=new Array}id;name;instance;rowidfield;label;help;fields;links};var _=class{constructor(e,t,n){this.session=e;let r=n||"api_"+t;this.metadata=new A(t,r),this.cacheKey=this.session.getBusinessObjectCacheKey(t,r),this.path=this.session.parameters.objpath+"?object="+encodeURIComponent(t)+"&inst="+encodeURIComponent(r),this.item={},this.filters={},this.list=[]}session;metadata;cacheKey;path;item;filters;list;count;page;maxpage;async getMetaData(e){let t="BusinessObject.getMetaData",n=this.session;return e=e||{},new Promise((r,s)=>{let o="";e.context&&(o+="&context="+encodeURIComponent(e.context)),e.contextParam&&(o+="&contextparam="+encodeURIComponent(e.contextParam)),n.sendRequest(this.path+"&action=metadata"+o,void 0,(a,h)=>{let c=n.parseResponse(a,h);if(n.debug(`[${t}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=n.getError(c.response,void 0,t);(e.error||n.error).call(this,u)||s.call(this,u)}else this.metadata=c.response,r.call(this,this.metadata)},a=>{a=n.getError(a,void 0,t),(e.error||n.error).call(this,a)||s.call(this,a)})})}getMetadata=this.getMetaData;getName(){return this.metadata.name}getInstance(){return this.metadata.instance}getLabel(){return this.metadata.label}getHelp(){return this.metadata.help}getFields(){return this.metadata.fields}getField(e){let t=this.getFields(),n=0;for(;n<t.length&&t[n].name!==e;)n++;if(n<t.length)return t[n]}getRowIdFieldName(){return this.metadata.rowidfield}getRowIdField(){return this.getField(this.getRowIdFieldName())}getLinks(){return this.metadata.links}getFieldType(e){if(typeof e=="string"&&(e=this.getField(e)),e)return e.type}getFieldLabel(e){if(typeof e=="string"&&(e=this.getField(e)),e)return e.label}getFieldValue(e,t){if(t||(t=this.item),e&&t){let n=t[typeof e=="string"?e:e.name];return n&&n.mime?new b(n):n}}getFieldListValue(e,t){typeof e=="string"&&(e=this.getField(e));let n=this.getFieldValue(e,t);return e&&e.listOfValues?this.getListValue(e.listOfValues,n):n}getFieldListColors(e,t){typeof e=="string"&&(e=this.getField(e));let n=this.getFieldValue(e,t);return e&&e.listOfValues?this.getListColors(e.listOfValues,n):n}getFieldDataURL(e,t){typeof e!="string"&&(e=e.fullinput||e.name);let n=this.getFieldValue(e,t);if(n&&n.mime)return"data:"+n.mime+";base64,"+(n.content||n.thumbnail)}getFieldDocument(e,t){typeof e!="string"&&(e=e.fullinput||e.input||e.name);let n=this.getFieldValue(e,t);return n&&n.mime?new b(n):n}getFieldDocumentURL(e,t,n){typeof e!="string"&&(e=e.fullinput||e.input||e.name);let r=this.getFieldValue(e,t);if(r&&r.mime&&(r=r.id),r)return this.session.parameters.url+this.session.parameters.docpath+"?object="+encodeURIComponent(this.metadata.name)+"&inst="+encodeURIComponent(this.metadata.instance)+"&field="+encodeURIComponent(e)+"&row_id="+encodeURIComponent(this.getRowId(t))+"&doc_id="+encodeURIComponent(r)+(n?"&thumbnail=true":"")+(this.session.authtoken?"&_x_simplicite_authorization_="+encodeURIComponent(this.session.authtoken):"")}getListValue(e,t){if(e){for(let n of e)if(n.code===t)return n.value}return t}getListColors(e,t){if(e){for(let n of e)if(n.code===t)return{color:n.color,bgcolor:n.bgcolor}}return{color:"inherit",bgcolor:"inherit"}}setFieldValue(e,t,n){n||(n=this.item),e&&n&&(n[typeof e=="string"?e:e.name]=t instanceof b?t.getValue():t)}resetValues(e){e||(e=this.item);for(let t in e)delete e[t]}async setFieldValues(e,t){t||(t=this.item);let n;return e instanceof FormData?(n={},e.forEach((r,s)=>n[s]=r)):n=e,new Promise(r=>{let s=[];for(let o of Object.keys(n)){let a=n[o];a instanceof File?s.push(new Promise(h=>{new b().load(a).then(c=>{this.setFieldValue(o,c),h.call(this)})})):this.setFieldValue(o,a)}Promise.allSettled(s).then(()=>r.call(this,t))})}isRowIdField(e){return!e.ref&&e.name===this.metadata.rowidfield}isTimestampField(e){let t=e.name;return!e.ref&&(t==="created_by"||t==="created_dt"||t==="updated_by"||t==="updated_dt")}async getFilters(e){let t="BusinessObject.getFilters",n=this.session;return e=e||{},new Promise((r,s)=>{let o="";e.context&&(o+="&context="+encodeURIComponent(e.context)),e.reset&&(o+="&reset="+!!e.reset),n.sendRequest(this.path+"&action=filters"+o,void 0,(a,h)=>{let c=n.parseResponse(a,h);if(n.debug(`[${t}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=n.getError(c.response,void 0,t);(e.error||n.error).call(this,u)||s.call(this,u)}else this.filters=c.response,r.call(this,this.filters)},a=>{a=n.getError(a,void 0,t),(e.error||n.error).call(this,a)||s.call(this,a)})})}getReqContextOption(e){return e.context?`&context=${encodeURIComponent(e.context)}`:""}getReqOptions(e){let t=this.getReqContextOption(e),n=e.inlineDocs||e.inlineDocuments||e.inlineImages;n&&(t+=`&inline_documents=${encodeURIComponent(n.join?n.join(","):n)}`);let r=e.inlineThumbs||e.inlineThumbnails;r&&(t+=`&inline_thumbnails=${encodeURIComponent(r.join?r.join(","):r)}`);let s=e.inlineObjs||e.inlineObjects;return s&&(t+=`&inline_objects=${encodeURIComponent(s.join?s.join(","):s)}`),t}convertFilterWildCards(e){return typeof e=="string"?e.replace(new RegExp("\\*","g"),"%").replace(new RegExp("\\?","g"),"_"):e}getReqParams(e,t){let n="";if(!e)return n;for(let r of Object.entries(e)){let s=r[0],o=r[1]||"";if(o instanceof b&&(o=o.getValue()),o.name&&o.content)o.content.startsWith("data:")&&(o.content=o.content.replace(/data:.*;base64,/,"")),n+=(n!==""?"&":"")+s+"="+encodeURIComponent("id|"+(o.id?o.id:"0")+"|name|"+o.name+"|content|"+o.content);else if(o.object&&o.row_id)n+=(n!==""?"&":"")+s+"="+encodeURIComponent("object|"+o.object+"|row_id|"+o.row_id);else if(o.sort)for(let a of o)n+=(n!==""?"&":"")+s+"="+encodeURIComponent(t?this.convertFilterWildCards(a):a);else n+=(n!==""?"&":"")+s+"="+encodeURIComponent(t?this.convertFilterWildCards(o):o)}return n}getPath(e,t){let n=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.path}&action=${encodeURIComponent(e)}${n}`}async getCount(e,t){let n="BusinessObject.getCount",r=this.session;return t=t||{},new Promise((s,o)=>{let a=this.getReqContextOption(t);t.operations===!0&&(a+="&_operations=true"),this.filters=e||{},r.sendRequest(`${this.getPath("count",t)}${a}`,this.getReqParams(this.filters,!0),(h,c)=>{let u=r.parseResponse(h,c);if(r.debug("["+n+"] HTTP status = "+c+", response type = "+u.type),u.type==="error"){let p=r.getError(u.response,void 0,n);(t.error||r.error).call(this,p)||o.call(this,p)}else this.count=u.response.count,this.page=u.response.page>=0?u.response.page+1:void 0,this.maxpage=u.response.maxpage>=0?u.response.maxpage+1:void 0,this.list=[],s.call(this,this.count)},h=>{h=r.getError(h,void 0,n),(t.error||r.error).call(this,h)||o.call(this,h)})})}async search(e,t){let n="BusinessObject.search",r=this.session;return t=t||{},new Promise((s,o)=>{let a=this.getReqOptions(t);t.page>0&&(a+=`&page=${t.page-1}`),t.metadata===!0&&(a+="&_md=true"),t.visible===!0&&(a+="&_visible=true"),this.filters=e||{},r.sendRequest(`${this.getPath("search",t)}${a}`,this.getReqParams(this.filters,!0),(h,c)=>{let u=r.parseResponse(h,c);if(r.debug(`[${n}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let p=r.getError(u.response,void 0,n);(t.error||r.error).call(this,p)||o.call(this,p)}else h.meta&&(this.metadata=u.response.meta),this.count=u.response.count,this.page=u.response.page>=0?u.response.page+1:void 0,this.maxpage=u.response.maxpage>=0?u.response.maxpage+1:void 0,this.list=u.response.list,s.call(this,this.list)},h=>{h=r.getError(h,void 0,n),(t.error||r.error).call(this,h)||o.call(this,h)})})}async get(e,t){let n="BusinessObject.get",r=this.session;return t=t||{},new Promise((s,o)=>{let a=this.getReqOptions(t),h=t.treeView;if(h&&(a+=`&treeview=${encodeURIComponent(h)}`),t.fields)for(let c of t.fields.length)a+=`&fields=${encodeURIComponent(c.replace(".","__"))}`;t.metadata&&(a+="&_md=true"),t.social&&(a+="&_social=true"),r.sendRequest(`${this.getPath("get",t)}&${this.metadata.rowidfield}=${encodeURIComponent(e||this.getRowId())}${a}`,void 0,(c,u)=>{let p=r.parseResponse(c,u);if(r.debug("[simplicite.BusinessObject.get] HTTP status = "+u+", response type = "+p.type),p.type==="error"){let f=r.getError(p.response,void 0,n);(t.error||r.error).call(this,f)||o.call(this,f)}else p.response.meta&&(this.metadata=p.response.meta),p.response.data?this.item=h?p.response.data.item:p.response.data:this.item=h?p.response.item:p.response,s.call(this,h?p.response:this.item)},c=>{c=r.getError(c,void 0,n),(t.error||r.error).call(this,c)||o.call(this,c)})})}async getForCreate(e){return e=e||{},delete e.treeview,delete e.fields,e.context=E.CONTEXT_CREATE,this.get(E.DEFAULT_ROW_ID,e)}async getForUpdate(e,t){return t=t||{},delete t.treeview,delete t.fields,t.context=E.CONTEXT_UPDATE,this.get(e||this.getRowId(),t)}async getForCopy(e,t){return t=t||{},delete t.treeview,delete t.fields,t.context=E.CONTEXT_COPY,this.get(e||this.getRowId(),t)}async getForDelete(e,t){return t=t||{},delete t.treeview,delete t.fields,t.context=E.CONTEXT_DELETE,this.get(e||this.getRowId(),t)}getRowId(e){if(e=e||this.item,e)return e[this.getRowIdFieldName()]}async populate(e,t){let n="BusinessObject.populate",r=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),r.sendRequest(`${this.getPath("populate",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(a,h)=>{let c=r.parseResponse(a,h);if(r.debug(`[${n}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=r.getError(c.response,void 0,n);(t.error||r.error).call(this,u)||o.call(this,u)}else this.item=c.response.data?c.response.data:c.response,s.call(this,this.item)},a=>{a=r.getError(a,void 0,n),(t.error||r.error).call(this,a)||o.call(this,a)})})}async getFieldLinkedList(e,t,n,r){let s="BusinessObject.getFieldLinkedList",o=this.session;return r=r||{},new Promise((a,h)=>{typeof e!="string"&&(e=e.fullinput||e.name),typeof t!="string"&&(t=t.fullinput||t.name);let c=!1;n===!0?(c=!0,n=void 0):typeof n>"u"&&(n=this.getFieldValue(e)),o.sendRequest(this.getPath("getlinkedlist",r),this.getReqParams({origin:e,input:t,code:n,all:c}),(u,p)=>{let f=o.parseResponse(u,p);if(o.debug("["+s+"] HTTP status = "+p+", response type = "+f.type),f.type==="error"){let g=o.getError(f.response,void 0,s);(r.error||o.error).call(this,g)||h.call(this,g)}else this.item=f.response.result?f.response.result:f.response,a.call(this,this.item)},u=>{u=o.getError(u,void 0,s),(r.error||o.error).call(this,u)||h.call(this,u)})})}async save(e,t){e&&(this.item=e);let n=this.item[this.metadata.rowidfield];return!n||n===E.DEFAULT_ROW_ID?this.create(e,t):this.update(e,t)}async create(e,t){let n="BusinessObject.create",r=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),this.item.row_id=E.DEFAULT_ROW_ID,r.sendRequest(`${this.getPath("create",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(a,h)=>{let c=r.parseResponse(a,h);if(r.debug("["+n+"] HTTP status = "+h+", response type = "+c.type),c.type==="error"){let u=r.getError(c.response,void 0,n);(t.error||r.error).call(this,u)||o.call(this,u)}else this.item=c.response.data?c.response.data:c.response,s.call(this,this.item)},a=>{a=r.getError(a,void 0,n),(t.error||r.error).call(this,a)||o.call(this,a)})})}async update(e,t){let n="BusinessObject.update",r=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),r.sendRequest(`${this.getPath("update",t)}${this.getReqOptions(t)}`,this.getReqParams(this.item),(a,h)=>{let c=r.parseResponse(a,h);if(r.debug(`[${n}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=r.getError(c.response,void 0,n);(t.error||r.error).call(this,u)||o.call(this,u)}else this.item=c.response.data?c.response.data:c.response,s.call(this,this.item)},a=>{a=r.getError(a,void 0,n),(t.error||r.error).call(this,a)||o.call(this,a)})})}async del(e,t){let n="BusinessObject.del",r=this.session;return t=t||{},new Promise((s,o)=>{e&&(this.item=e),r.sendRequest(`${this.getPath("delete",t)}&${this.metadata.rowidfield}=${encodeURIComponent(this.item[this.metadata.rowidfield])}`,void 0,(a,h)=>{let c=r.parseResponse(a,h);if(r.debug(`[${n}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=r.getError(c.response,void 0,n);(t.error||r.error).call(this,u)||o.call(this,u)}else this.item=void 0,delete c.response.undoredo,s.call(this,c.response)},a=>{a=r.getError(a,void 0,n),(t.error||r.error).call(this,a)||o.call(this,a)})})}async action(e,t,n){let r=`BusinessObject.action(${e})`,s=this.session;return n=n||{},new Promise((o,a)=>{let h=t?`&${this.getRowIdFieldName()}=${encodeURIComponent(t)}`:"";s.sendRequest(`${this.getPath(e,n)}${h}`,this.getReqParams(n.parameters),(c,u)=>{let p=s.parseResponse(c,u);if(s.debug("["+r+"] HTTP status = "+u+", response type = "+p.type),p.type==="error"){let f=s.getError(p.response,void 0,r);(n.error||s.error).call(this,f)||a.call(this,f)}else{let f=p.response.result;o.call(this,f)}},c=>{c=s.getError(c,void 0,r),(n.error||s.error).call(this,c)||a.call(this,c)})})}async crosstab(e,t){let n=`BusinessObject.crosstab(${e})`,r=this.session;return t=t||{},new Promise((s,o)=>{t.filters&&(this.filters=t.filters),r.sendRequest(`${this.getPath(t.cubes?"crosstabcubes":"crosstab",t)}&crosstab=${encodeURIComponent(e)}`,this.getReqParams(t.filters||this.filters,!0),(a,h)=>{let c=r.parseResponse(a,h);if(r.debug(`[${n}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=r.getError(c.response,void 0,n);(t.error||r.error).call(this,u)||o.call(this,u)}else s.call(this,c.response)},a=>{a=r.getError(a,void 0,n),(t.error||r.error).call(this,a)||o.call(this,a)})})}async print(e,t,n){let r=`BusinessObject.print(${e})`,s=this.session;return n=n||{},new Promise((o,a)=>{n.filters&&(this.filters=n.filters);let h="";n.all&&(h+="&all="+!!n.all),n.mailing&&(h+="&mailing="+!!n.mailing),t&&(h+=`&${this.getRowIdFieldName()}=${encodeURIComponent(t)}`),s.sendRequest(`${this.getPath("print",n)}&printtemplate=${encodeURIComponent(e)}${h}`,void 0,(c,u)=>{let p=s.parseResponse(c,u);if(s.debug("["+r+"] HTTP status = "+u+", response type = "+p.type),p.type==="error"){let f=s.getError(p.response,void 0,r);(n.error||s.error).call(this,f)||a.call(this,f)}else o.call(this,new b(p.response))},c=>{c=s.getError(c,void 0,r),(n.error||s.error).call(this,c)||a.call(this,c)})})}async placemap(e,t,n){let r=`BusinessObject.placemap(${e})`,s=this.session;return this.filters=t||{},n=n||{},new Promise((o,a)=>{n.filters&&(this.filters=n.filters),s.sendRequest(`${this.getPath("placemap",n)}&placemap=${encodeURIComponent(e)}`,this.getReqParams(this.filters,!0),(h,c)=>{let u=s.parseResponse(h,c);if(s.debug("["+r+"] HTTP status = "+c+", response type = "+u.type),u.type==="error"){let p=s.getError(u.response,void 0,r);(n.error||s.error).call(this,p)||a.call(this,p)}else o.call(this,u.response)},h=>{h=s.getError(h,void 0,r),(n.error||s.error).call(this,h)||a.call(this,h)})})}async setParameter(e,t,n){let r="BusinessObject.setParameter",s=this.session;return n=n||{},new Promise((o,a)=>{let h={name:e};t&&(h.value=t),s.sendRequest(this.getPath("setparameter",n),this.getReqParams(h),(c,u)=>{let p=s.parseResponse(c,u);if(s.debug(`[${r}] HTTP status = ${u}, response type = ${p.type}`),p.type==="error"){let f=s.getError(p.response,void 0,r);(n.error||s.error).call(this,f)||a.call(this,f)}else{let f=p.response.result;o.call(this,f)}},c=>{c=s.getError(c,void 0,r),(n.error||s.error).call(this,c)||a.call(this,c)})})}async getParameter(e,t){let n="BusinessObject.getParameter",r=this.session;return t=t||{},new Promise((s,o)=>{let a={name:e};r.sendRequest(this.getPath("getparameter",t),this.getReqParams(a),(h,c)=>{let u=r.parseResponse(h,c);if(r.debug(`[${n}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let p=r.getError(u.response,void 0,n);(t.error||r.error).call(this,p)||o.call(this,p)}else{let p=u.response.result;s.call(this,p)}},h=>{h=r.getError(h,void 0,n),(t.error||r.error).call(this,h)||o.call(this,h)})})}getResourceURL(e,t){return this.session.getResourceURL(e,t,this.metadata.name,this.metadata.id)}};var $=class{constructor(e){this.name=e}name};var O=class{constructor(e,t){this.session=e,this.metadata=new $(t),this.path=`${this.session.parameters.extpath}/${encodeURIComponent(t)}`}session;metadata;path;getName(){return this.metadata.name}callParams(e){let t="";if(!e)return t;for(let n of Object.entries(e)){let r=n[0],s=n[1]||"";if(s.sort)for(let o of s)t+=(t!==""?"&":"")+r+"="+encodeURIComponent(o);else t+=(t!==""?"&":"")+r+"="+encodeURIComponent(s)}return t}async call(e,t,n){let r="ExternalObject.call",s=this.session;return n=n||{},new Promise((o,a)=>{let h="";e&&(h=this.callParams(e)),n.businessCase&&(h+=`_bc=${encodeURIComponent(n.businessCase)}`);let c=n.method?n.method.toUpperCase():t?"POST":"GET",u={};n.contentType?u["content-type"]=n.contentType:t&&!(t instanceof FormData)&&(u["content-type"]=typeof t=="string"?"application/x-www-form-urlencoded":"application/json"),n.accept&&(u.accept=n.accept==="json"?"application/json":n.accept);let p=s.getBearerTokenHeader();p?u[s.authheader]=p:(p=s.getBasicAuthHeader(),p&&(u[s.authheader]=p));let f=s.parameters.url+(n.path&&n.path.startsWith("/")?n.path:this.path+(n.path?"/"+n.path:""))+(h!==""?"?"+h:""),g=t?typeof t=="string"||t instanceof FormData?t:JSON.stringify(t):void 0;s.debug("[simplicite.ExternalObject.call] "+c+" "+f+(g?" with "+g:"")),fetch(f,{method:c,headers:u,signal:AbortSignal.timeout(s.parameters.timeout),body:g}).then(y=>{let B=y.headers.get("content-type");s.debug(`[${r}] HTTP status = ${y.status}, response content type = ${B}`),B&&B.startsWith("application/json")?y.json().then(d=>{o.call(this,d,y.status,y.headers)}).catch(d=>{d=s.getError(d,void 0,r),(n.error||s.error).call(this,d)||a.call(this,d)}):B&&(B.startsWith("text/")||B.startsWith("application/yaml"))?y.text().then(d=>{o.call(this,d,y.status,y.headers)}).catch(d=>{d=s.getError(d,void 0,r),(n.error||s.error).call(this,d)||a.call(this,d)}):y.arrayBuffer().then(d=>{o.call(this,d,y.status,y.headers)}).catch(d=>{d=s.getError(d,void 0,r),(n.error||s.error).call(this,d)||a.call(this,d)})}).catch(y=>{y=s.getError(y,void 0,r),(n.error||s.error).call(this,y)||a.call(this,y)})})}invoke=this.call};var Te=Ue(xe(),1);var M=class{constructor(e){e=e||{};let t=typeof globalThis.Simplicite<"u";this.endpoint=e.endpoint||(t?globalThis.Simplicite.ENDPOINT:"api"),this.authheader=e.authheader||this.constants.DEFAULT_AUTH_HEADER,this.log=e.logHandler||((...u)=>{console.log(u)}),this.info=e.infoHandler||((...u)=>{u&&u.length===1&&typeof u[0]=="string"?console.info(`INFO - ${u[0]}`):console.info("INFO",u)}),this.warn=e.warningHandler||((...u)=>{u&&u.length===1&&typeof u[0]=="string"?console.warn(`WARN - ${u[0]}`):console.warn(`WARN${u&&u.length>0&&u[0].message?` - ${u[0].message}`:""}`,u)}),this.error=e.errorHandler||((...u)=>{u&&u.length===1&&typeof u[0]=="string"?console.error(`ERROR - ${u[0]}`):console.error(`ERROR${u&&u.length>0&&u[0].message?` - ${u[0].message}`:""}`,u)}),this.debugMode=!!e.debug,this.debug=e.debugHandler||((...u)=>{this.debugMode&&(u&&u.length===1&&typeof u[0]=="string"?console.info(`DEBUG - ${u[0]}`):console.log("DEBUG",u))});let n=e.url||t&&globalThis.Simplicite.URL||globalThis.window&&globalThis.window.location.origin;if(this.debug("[simplicite] URL parameter = "+n),n)try{e.scheme=n.replace(/:.*$/,"");let u=n.replace(new RegExp("^"+e.scheme+"://"),"").split(":");if(u.length===1)e.host=u[0].replace(/\/.*$/,""),e.port=e.scheme==="http"?80:443,e.root=u[0].replace(new RegExp("^"+e.host+"/?"),"");else{if(e.host=u[0],e.port=parseInt(u[1].replace(/\/.*$/,""),10),isNaN(e.port))throw new Error("Incorrect port");e.root=u[1].replace(new RegExp("^"+e.port+"/?"),"")}e.root==="/"&&(e.root="")}catch(u){this.error("Unable to parse URL ["+n+"]: "+u.message);return}let r=e.scheme||(e.port===443?"https":"http");if(r!=="http"&&r!=="https"){this.error("Incorrect scheme ["+e.scheme+"]");return}let s=e.host||"localhost",o=e.port||8080,a=e.root||"";a==="/"&&(a="");let h=r+"://"+s;(r==="http"&&o!==80||r==="https"&&o!==443)&&(h+=":"+o),a!==""&&(h+=a.startsWith("/")?a:"/"+a),this.debug("[simplicite] Base URL = "+h);let c=this.endpoint==="uipublic"?"":"/"+this.endpoint;if(this.parameters={scheme:r,host:s,port:o,root:a,url:h,username:e.username,password:e.password,authtoken:e.authtoken,timeout:(e.timeout||30)*1e3,compress:e.compress||!0,healthpath:(c==="/ui"?c:"")+"/health?format=json",loginpath:c==="/api"?"/api/login?format=json":c+"/json/app?action=session",logoutpath:c==="/api"?"/api/logout?format=json":c+"/json/app?action=logout",apppath:c+"/json/app",objpath:c+"/json/obj",extpath:c+"/ext",docpath:c+"/raw/document",respath:"/resource"},this.username=e.username||e.login,this.password=e.password||e.pwd,this.authtoken=e.authtoken||e.token,!this.authtoken&&t){let u=globalThis.window?globalThis.window.localStorage:null;this.authtoken=u?u.getItem("_authToken"):globalThis.Simplicite.AUTH_TOKEN}if(this.ajaxkey=e.ajaxkey,!this.ajaxkey&&t){let u=globalThis.window?globalThis.window.localStorage:null;this.ajaxkey=u?u.getItem("_ajaxKey"):globalThis.Simplicite.AJAX_KEY}this.businessObjectCache=new Map}constants=E;getModuleVersion(){return this.constants.MODULE_VERSION}endpoint;authheader;log;info;warn;error;debugMode;debug;parameters;username;setUsername(e){this.username=e}password;setPassword(e){this.password=e}authtoken;authtokenexpiry;ajaxkey;sessionid;setAuthToken(e){this.authtoken=e}setAuthTokenExpiryDate(e){this.authtokenexpiry=e}isAuthTokenExpired(){return this.authtokenexpiry?new Date>this.authtokenexpiry:!1}setAjaxKey(e){this.ajaxkey=e}businessObjectCache;getBusinessObjectCacheKey(e,t){return e+":"+(t||"js_"+e)}clear(){this.username=void 0,this.password=void 0,this.authtoken=void 0,this.authtokenexpiry=void 0,this.sessionid=void 0,this.grant=void 0,this.appinfo=void 0,this.sysinfo=void 0,this.devinfo=void 0,this.businessObjectCache=new Map}getBasicAuthHeader(){return this.username&&this.password?"Basic "+Te.Buffer.from(this.username+":"+this.password).toString("base64"):void 0}getBearerTokenHeader(){return this.authtoken?"Bearer "+this.authtoken:void 0}getError(e,t,n){if(typeof e=="string")return{message:e,status:t||200,origin:n};if(e.response){if(typeof e.response=="string")return{message:e.response,status:t||200,origin:n};if(n)try{e.response.origin=n}catch{}return e.response}else{if(n)try{e.origin=n}catch{}return e}}compressData(e){let n=(typeof e=="string"?new Blob([e],{type:"text/plain"}).stream():new Blob([JSON.stringify(e)],{type:"application/json"}).stream()).pipeThrough(new CompressionStream("gzip"));return new Response(n).blob()}uncompressData(e){let t=e.stream().pipeThrough(new DecompressionStream("gzip"));return new Response(t).text()}sendRequest(e,t,n,r){let s="Session.sendRequest",o=t?"POST":"GET",a={};t&&(a["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),a.accept="application/json";let h=this.getBearerTokenHeader();h?a[this.authheader]=h:(h=this.getBasicAuthHeader(),h&&(a[this.authheader]=h));let c=this.parameters.url+(e||"/");this.ajaxkey&&(c+=(c.indexOf("?")>=0?"&":"?")+"_ajaxkey="+encodeURIComponent(this.ajaxkey));let u=t?typeof t=="string"?t:JSON.stringify(t):void 0;this.debug(`[${s}] ${o} ${c}${u?" with "+u:""}`),fetch(c,{method:o,headers:a,signal:AbortSignal.timeout(this.parameters.timeout),body:u}).then(p=>{n&&p.text().then(f=>{n.call(this,f,p.status,p.headers)})}).catch(p=>{let f=p.response&&p.response.status?p.response.status:void 0,g=p.response&&p.response.data?p.response.data:p;if(r)r.call(this,this.getError(g,f,s));else throw g})}parseResponse(e,t){try{return t!==200?{type:"error",response:this.getError("HTTP status: "+t,t)}:typeof e=="object"?e:JSON.parse(e)}catch(n){return{type:"error",response:this.getError("Parsing error: "+n.message,t)}}}async getHealth(e){let t="Session.getHealth";return e=e||{},new Promise((n,r)=>{let s=`&full=${!!e.full}`;e.businessCase&&(s+=`&_bc=${encodeURIComponent(e.businessCase)}`),this.sendRequest(`${this.parameters.healthpath}${s}`,void 0,(o,a)=>{let h=this.parseResponse(o,a);if(this.debug(`[${t}] HTTP status = ${a}, response type = ${o}`),h.type==="error"){let c=this.getError(h.response,void 0,t);(e.error||this.error).call(this,c)||r.call(this,c)}else n.call(this,h)},o=>{o=this.getError(o,void 0,t),(e.error||this.error).call(this,o)||r.call(this,o)})})}health=this.getHealth;async login(e){let t="Session.login";return e=e||{},new Promise((n,r)=>{(e.username||e.login)&&(e.password||e.pwd)?(this.clear(),this.username=e.username||e.login,this.password=e.password||e.pwd):(e.authtoken||e.authToken||e.token)&&(this.clear(),this.authtoken=e.authtoken||e.authToken||e.token),this.sendRequest(this.parameters.loginpath,void 0,(s,o)=>{let a=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${a.type||(a.error?"error":"login")}`),a.type==="error"||a.error){let h=this.getError(a.response?a.response:a,void 0,t);(e.error||this.error).call(this,h)||r.call(this,h)}else{this.sessionid=a.response?a.response.id:a.sessionid,this.debug(`[${t}] Session ID = ${this.sessionid}`),this.username=a.response?a.response.login:a.login,this.username&&this.debug(`[${t}] Username = ${this.username}`),this.authtoken=a.response?a.response.authtoken:a.authtoken,this.authtoken&&this.debug(`[${t}] Auth token = ${this.authtoken}`);try{let h=new Date;h.setTime(a.response?a.response.authtokenexpiry:a.authtokenexpiry),this.authtokenexpiry=h}catch{this.authtokenexpiry=void 0}this.authtokenexpiry&&this.debug(`[${t}] Auth token expiry date = ${this.authtokenexpiry.toLocaleDateString()} ${this.authtokenexpiry.toLocaleTimeString()}`),this.grant=new C({login:this.username,userid:a.response?a.response.userid:a.userid,firstname:a.response?a.response.firstname:a.firstname,lastname:a.response?a.response.lastname:a.lastname,email:a.response?a.response.email:a.email}),n.call(this,a.response||a)}},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||r.call(this,s)})})}async logout(e){let t="Session.logout";return e=e||{},new Promise((n,r)=>{this.sendRequest(this.parameters.logoutpath,void 0,(s,o)=>{let a=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${a.type||(a.error?"error":"logout")}`),a.type==="error"){let h=this.getError(a.response?a.response:a,void 0,t);(e.error||this.error).call(this,h)||r.call(this,h)}else this.clear(),this.username=this.parameters.username,this.password=this.parameters.password,this.authtoken=this.parameters.authtoken,n.call(this,a.response||a)},s=>{s=this.getError(s,void 0,t),s.status===401&&(this.authtoken=void 0),(e.error||this.error).call(this,s)||r.call(this,s)})})}grant;getPath(e,t){let n=t&&t.businessCase?`&_bc=${encodeURIComponent(t.businessCase)}`:"";return`${this.parameters.apppath}?action=${encodeURIComponent(e)}${n}`}async getGrant(e){let t="Session.getGrant";return e=e||{},new Promise((n,r)=>{let s="&web=true",o=!!e.includeTexts||!!e.texts;s+=`&texts=${encodeURIComponent(o)}`;let a=!!e.inlinePicture||!!e.picture;a&&(s+="&inline_picture=true"),(!!e.includeSysparams||!!e.sysparams)&&(s+="&sysparams=true"),this.sendRequest(`${this.getPath("getgrant",e)}${s}`,void 0,(c,u)=>{let p=this.parseResponse(c,u);if(this.debug(`[${t}] HTTP status = ${u}, response type = ${p.type}`),p.type==="error"){let f=this.getError(p.response,void 0,t);(e.error||this.error).call(this,f)||r.call(this,f)}else this.grant=new C(p.response),a&&(this.grant.picture=new b(this.grant.picture)),o&&(this.grant.texts=Object.assign(new Map,this.grant.texts)),n.call(this,this.grant)},c=>{c=this.getError(c,void 0,t),(e.error||this.error).call(this,c)||r.call(this,c)})})}async changePassword(e,t){let n="Session.changePassword";return t=t||{},new Promise((r,s)=>{this.sendRequest(`${this.getPath("setpassword",t)}&password=${encodeURIComponent(e)}`,void 0,(o,a)=>{let h=this.parseResponse(o,a);if(this.debug(`[${n}] HTTP status = ${a}, response type = ${h.type}`),h.type==="error"){let c=this.getError(h.response,void 0,n);(t.error||this.error).call(this,c)||s.call(this,c)}else r.call(this,h.response)},o=>{o=this.getError(o,void 0,n),(t.error||this.error).call(this,o)||s.call(this,o)})})}appinfo;async getAppInfo(e){let t="Session.getAppInfo";return e=e||{},new Promise((n,r)=>{this.sendRequest(this.getPath("getinfo",e),void 0,(s,o)=>{let a=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${a.type}`),a.type==="error"){let h=this.getError(a.response,void 0,t);(e.error||this.error).call(this,h)||r.call(this,h)}else this.appinfo=a.response,n.call(this,this.appinfo)},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||r.call(this,s)})})}sysinfo;async getSysInfo(e){let t="Session.getSysInfo";return e=e||{},new Promise((n,r)=>{this.sendRequest(this.getPath("sysinfo",e),void 0,(s,o)=>{let a=this.parseResponse(s,o);if(this.debug(`[${t}] HTTP status = ${o}, response type = ${a.type}`),a.type==="error"){let h=this.getError(a.response,void 0,t);(e.error||this.error).call(this,h)||r.call(this,h)}else this.sysinfo=a.response,n.call(this,this.sysinfo)},s=>{s=this.getError(s,void 0,t),(e.error||this.error).call(this,s)||r.call(this,s)})})}devinfo;async getDevInfo(e,t){let n="Session.getDevInfo";return t=t||{},new Promise((r,s)=>{let o="";e&&(o+=`&module=${encodeURIComponent(e)}`),this.sendRequest(`${this.getPath("devinfo",t)}${o}`,void 0,(a,h)=>{let c=this.parseResponse(a,h);if(this.debug(`[${n}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=this.getError(c.response,void 0,n);(t.error||this.error).call(this,u)||s.call(this,u)}else e||(this.devinfo=c.response),r.call(this,c.response)},a=>{a=this.getError(a,void 0,n),(t.error||this.error).call(this,a)||s.call(this,a)})})}news;async getNews(e){let t="Session.getNews";return e=e||{},new Promise((n,r)=>{let s="";(!!e.inlineImages||!!e.images)&&(s+="&inline_images=true"),this.sendRequest(`${this.getPath("news",e)}${s}`,void 0,(a,h)=>{let c=this.parseResponse(a,h);if(this.debug(`[${t}] HTTP status = ${h}, response type = ${c.type}`),c.type==="error"){let u=this.getError(c.response,void 0,t);(e.error||this.error).call(this,u)||r.call(this,u)}else{this.news=c.response;for(let u of this.news)u.image=new b(u.image);n.call(this,this.news)}},a=>{a=this.getError(a,void 0,t),(e.error||this.error).call(this,a)||r.call(this,a)})})}async indexSearch(e,t,n){let r="Session.indexSearch";return n=n||{},new Promise((s,o)=>{let a=`&request=${encodeURIComponent(e||"")}`;t&&(a+=`&object=${encodeURIComponent(t)}`),n.metadata===!0&&(a+="&_md=true"),n.context&&(a+=`&context=${encodeURIComponent(n.context)}`),this.sendRequest(`${this.getPath("indexsearch",n)}${a}`,void 0,(h,c)=>{let u=this.parseResponse(h,c);if(this.debug(`[${r}] HTTP status = ${c}, response type = ${u.type}`),u.type==="error"){let p=this.getError(u.response,void 0,r);(n.error||this.error).call(this,p)||o.call(this,p)}else s.call(this,u.response)},h=>{h=this.getError(h,void 0,r),(n.error||this.error).call(this,h)||o.call(this,h)})})}getBusinessObject(e,t){let n=this.getBusinessObjectCacheKey(e,t),r=this.businessObjectCache[n];return r||(r=new _(this,e,t),this.businessObjectCache[n]=r),r}getExternalObject(e){return new O(this,e)}getResourceURL(e,t,n,r){return this.parameters.url+this.parameters.respath+"?code="+encodeURIComponent(e)+"&type="+encodeURIComponent(t||"IMG")+(n?"&object="+encodeURIComponent(n):"")+(r?"&objid="+encodeURIComponent(r):"")+(this.authtoken?"_x_simplicite_authorization_="+encodeURIComponent(this.authtoken):"")}};var ut=i=>new M(i),Vt={constants:E,session:ut,Session:M,Doc:b,Grant:C,BusinessObjectMetadata:A,BusinessObject:_,ExternalObjectMetadata:$,ExternalObject:O};export{Vt as default};
/**
 * Simplicite(R) platform Javascript API client module (for node.js and browser).
 * @module simplicite
 * @version 3.1.2
 * @license Apache-2.0
 */
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
//# sourceMappingURL=simplicite.min.mjs.map
